[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "LI-6800 和 LI-6400 光合数据分析指南",
    "section": "",
    "text": "欢迎\n本文是希望介绍一套完整的 LI-6800 和 LI-6400 数据分析的流程，期望涵盖的工具有 R, Python, CLI(command line interface) 等。本书目前还在创作中（最新更新日期： 2021-12-14，预期 202x 年能够初步完工），最初以 R 代码为主。\n\n\n\n\n\n\n注意\n\n\n\n本文面向的对象是具有最基本 R 和 Python 基础的人，意即本文不介绍基本的语法知识，如果没有任何基础，建议首先找一本入门材料，例如 153 分钟学会 R。本文尽量少用太多的软件包依赖来完成，这样尽可能降低刚入门使用相关代码的难度。\n\n\n\n\n\n\n\n\n友情提醒\n\n\n\n由于万恶的 Windows 编码问题，交叉引用所使用的语言暂时是英文，如果更换为中文就会出现乱码，目前我尚未有时间解决这个问题，作为暂时使用的方案，如引起您的不适请谅解。"
  },
  {
    "objectID": "thanks.html",
    "href": "thanks.html",
    "title": "致谢",
    "section": "",
    "text": "需要致谢的人和事情比较多，但因为这是未完工作品，所以只能不断补充。\n首先需要感谢公司技术部和前技术部同事（转岗），他们对于其中的很多内容在工作之余进行了测试，提出来很多建议，例如焦阳在转岗之前拿着厚厚的一本叶绿素荧光方面的书（不在公司，记不起名字来了，后面补充），查找了 jiptest 这个包里大部分计算的公式并手敲成了 R 代码，刘美玲、徐粒指出了 jiptest 初代版本的明显错误，张启尧测试了大量 ACi 拟合部分的代码、检查了公式的错误，贾子毅在自己有大量文档要写的前提下指出来第一版写作中的明显的错误，朱晓伟曾经在我决定进行第二版迁移的时候曾经说有能帮忙的地方就说一声，刘晓迪指出来 jiptest 的一些问题（但我暂时没时间处理，只能十分抱歉）等等，当然这只是其中我这健忘的记性中能记得的一些事情，他们做的远不止于此。其他同事（到目前为止）：王昭、谢智、高红艳、武海月、王军、许燕、武洪敏、李蓉、赖挺、张云飞等都做了相关代码的测试，提供过一些反馈或者贡献了一些测试数据，这些都是他们本职工作之外的事情，虽然落笔于我，但仅仅是我一个人也做不到这么快的完成这些内容（离完善还有一定距离，但至少作为一个参考资料能勉强合格）。\n其他提供帮助的人有（希望没有遗漏，如果因为我事情繁杂，忘记了请多包涵，请提醒我补充，这里是按时间先后顺序）：\n网名“汪友尽”的朋友指出了直角双曲线修正模型补偿点计算公式写错了。\n南农王永琳博士指出非直角双曲线公式写错了。\n网名 Wang Zhe 的朋友指出来 SMATR 官方 C++ 版本的地址（我毕业后官方换了网址，但我找不到一以为没有了）：SMATR 官方版"
  },
  {
    "objectID": "preface.html",
    "href": "preface.html",
    "title": "序言",
    "section": "",
    "text": "姑且算这是一本书吧，毕竟这是按照一本书的格式进行排版的。但他离我的要求差距有点大，所以我不太情愿这么称呼它。这算是本书的序言，我的目的主要是讲清楚一些历史渊源。\n这本书的前身是 使用 R 语言分析 LI-6400 和 LI-6800 光合仪的数据，而更早的起源大约是 2017 年7,8月份的样子。那时候我刚刚结束在基因的实习期没多久，在学习 LI-6400 的响应曲线过程中，需要分析点做测试的数据，然后再 plantecophys 的基础上做了一些笔记。之后的培训时间里，发现遇到的一些客户有相关的需求，于是我慢慢整理为上面的内容。再后来不断的填补一些内容，所以上面这个链接看上去很乱，而因为这是业余爱好，我的工作越来越忙的原因，我有心无力，一直没有时间，也下不了决心从头整理一下。\n直到最近（2021.11）我下了决心整理，但并不是我有时间了，只是不动手开始，那恐怕永远还是没时间，千里之行，始于足下。再者近期疫情（2021.11）在国内又有零星爆发，我暂时能节省大量的通勤时间，所以希望每天能有半个小时到一个小时的时间用在这件事情上。具体能达到什么样的效果我并不清楚，因为有些事情可能超出了我的能力范围，我只能保证现在尽力去做。\n这里需要说明几件事情：\n\n本文的写作纯属个人行为，与我所在单位无关。如果对您使用 LI-6800 和 LI-6400 进行实验数据的处理有帮助，那么您认为这属于基因公司的功劳也无不可，毕竟有些内容也是我工作中所接触和学习到的。但如果对您造成了伤害，请一定记住，这是个人行为。我所在单位和现在的同事对此没有任何义务和责任。\n既然是个人行为，这些相关的分析工作并非我所在单位有义务提供的服务内容，请不要与正常的仪器售后工作混为一谈。\n所有引用他人的内容我都会添加引用或者注释。但我决定保留对这本书的一切权利。虽然如此，如果您发表文章中使用了相关的代码或内容，即使是我原创的内容，我对此并不介意，但用于商业目的行为请提前与我沟通。我的个人邮箱为：`zhujiedong@yeah.net`，这也是我喜欢的联系方式。\n\n对写作这件事情，始于我的业余爱好，最初写这些东西是打发出差晚上无聊时间用的（那时候刚入职现在的公司，并没有很多的售后之外的工作让我去做，所以出差晚上很闲，现在不同了），根本原因是我喜欢在学习的时候做笔记，所以后来为这些东西还专门开了一个公众号：\n\n\n\n分享用的公众号\n\n\n初心就是这么简单，这样一个平台能够既让我写笔记，又能与同行交流而已。到现在虽然我已经不需要用爱好来打发时间，晚上处理白天积攒的工作已经让我很忙（没办法，培训的时候不能做其他工作），但是我一直把这个爱好坚持下来，可能也是习惯了吧，但还是给一些人造成了误解。这里必须说明：\n\n这个公众号是我个人的，目的是分享，并不是提供数据相关咨询，更不提供任何数据分析服务，所以如果您使用了基因公司的仪器，可以把这些内容作为参考，有问题我欢迎交流，但我不能保证一定会回复，这不是我的工作，我时间上优先保证我拿工资的那部分工作的内容，其他时间以我个人的生活为重。\n列出上面的微信二维码，主要目的也是方便一些用户，最近这两年 github 被墙的厉害，我会将一些基本的内容发到微信公众号内，微信不管在哪里都是可以用的，这样我能接到一些反馈，我不回复一些问题多数情况是没时间，但并不表明我没看到，一些有代表性的问题我可能会后面统一回复，一些建议我后面有时间的时候也会采纳和做相应的处理。我倾向于在 github 和 gitee 上收到一些反馈，但是如果不会用 git，微信将是一个很好的平台。\n由第 2 点引出了第 3 点，微信最好是文章下面留言，这样有时候我会回复，也避免一些共性的问题反复有人提问。请不要私信，微信私信进行 问题讨论 是我深恶痛绝的，一是很多人对一个售后微信留言多的程度可能不了解，对售后在生长季节出差的强度也没有体会，有一搭没一搭的回复问题真让人感觉把自己复制个十几个才够用的。二是看了来不及处理的问题，很容易忘，而因为要搞设备的安装、调试和售后很容易看一眼之后没时间回复。\n怎么提问题才能提升效率。以仪器问题为例，需要注明几点：仪器型号、症状描述、报错提示、出问题之前所做的操作、同往常相比，有什么异常出现，自己解决问题所做的努力。有了这些信息，我们基本很快就能判断原因，而不是这些问题由我们来问，这样子用微信留言是不方便的。代码问题同样如此，就说某行报错是得不到多少有用信息的，至少要看到代码提示才好。\n\n最后，希望这些内容能够帮助到有需要的人。\n\n祝介东\n于 2021.11.13 日夜"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "介绍",
    "section": "",
    "text": "LI-6400 光合仪自面世以来，在相关的领域得到了广泛的应用。毕竟在植物学领域，专门光合相关的研究或其他研究很多时候都需要光合相关的参数来比较不同处理或者验证某些假设。尽管是一个经典的设备，目前在每年的生长季节使用量也十分巨大（这个作为一个售后的感受是最直观的），但它不可避免的落伍于这个时代，并最终停止生产了，取而代之的是 LI-6800 光合仪。对于这个变化而言，一个很直观的例子可以解释为什么在 LI-6400 仍然能胜任多数光合测量任务的情况下，却难逃被淘汰的命运。这就是手机从功能机向智能机的转变，并不是直板诺基亚不好了，只是时代对手机提出来更高的要求。 LI-6800 的诞生意味着光合仪从功能机时代转向了智能机的时代，无限的可能被创造力出来。\n不论仪器怎么转变，他们可能会节省我们很多劳动力，让我们少去操心一些琐碎的问题，但最终的数据处理则是科研工作者核心的工作的主题，时代进步可能会减轻我们的工作量，例如最近这十几年来，大数据的兴起使得我们对数据分析的难度大大降低。新方法新工具不断出现，这对我们是一个好的事情，但同时对我们的学习要求也不断提高，因为不能悲哀的发现分析结果出来，我们却读不懂吧。当然，更多的情况是我们受制于怎么实现某些分析，怎么利用程序能够自动化的处理一些工作，好让我们把精力更多的放在对数据结果的分析和讨论上。\n基于此，也基于我个人这几年对相关方面的兴趣，我这里将我所知道关于对光合数据分析相关的内容做一个整理，不管水平如何，我只是期望能给未入门或者初入门尚未找到合适资料的同志们一些参考。我努力保证不出错，但不能保证我所使用的代码是最简单、最合理，最有效率的，当然，这是我的目标，但作为一个有不相关工作的业余人士来讲，这很难，所以老师和同学们（不是我没礼貌，只是年纪在这，可能某些同学的老师是我的同学，我只能这么喊了）口下留情，请多多指正，多多分享。\n我对这块工作，目前期望的框架大致为（基于 使用 R 语言分析 LI-6400 和 LI-6800 光合仪的数据 得到的一些总结和反馈）：\n\n介绍基本工具安装和初步的使用，这里目前准备先介绍一下 R，Rtools 及 Rstudio 的安装和基本使用，因为作为初学者这是最基本的工具，所谓工欲善其事，必先利其器，掌握了 Rstudio 之后再写代码就是事倍功半的效果了，添加这部分内容是因为看到不少人给我截图，都是直接用的 R gui，这个真的很费事的，我就刚学 R 的时候用过这种方式，后来一路到 Rstudio 成立，就再也没换过写 R 代码的工具。\n介绍专门的光合作用软件包，因为光合数据处理，特别是一些曲线拟合的部分相对比较麻烦，有一些特有的软件包进行使用，例如 plantecophys 等。\n数据的准备工作，最基本的数据导入，批量导入和处理。\n响应曲线部分与叶片导度部分，这里主要介绍气孔导度相关模型与叶肉导度的计算。\n其他统计常用方法。这里准备介绍基本的统计方法。\n\n\n\n\n\n\n\n注意\n\n\n\n我对 tidyverse 的管道符号并不感冒，而且我又有一定程度的强迫症，不喜欢使用太多依赖，所以代码我基本会尽量使用 R base 的语法来进行示例,这样初学者不用安装太多依赖包来运行示例程序，这是个人习惯的问题。"
  },
  {
    "objectID": "basics.html",
    "href": "basics.html",
    "title": "必备工具",
    "section": "",
    "text": "本书计划使用的工具有 R 软件 (R Core Team 2021)，Python 软件 以及一款支持 bash 的终端。这其中前两款是可以直接免费下载安装的，而 bash 只是 shell 语言 1 的一种，如果使用 Mac 或 linux，那么天然自带，如果使用 Windows，那么我推荐使用 WSL2。\n对于编程来讲，一款好的 IDE 能够节省我们大量的时间，并且节省很多配置的繁琐步骤。对于 R 的 IDE，我还是强烈推荐使用 Rstudio，我后面会介绍入门所必须的一些操作。对于 Python，新手尤其是做数据科学的新手，我推荐使用 Anaconda，当然了，这并不是一个 IDE，二是针对数据科学的一揽子解决方案，对初学者来讲，比较省心，会让我们跨过所有的系统变量，常用数据分析软件包的安装等的配置，让我们直接进入实战阶段。Python 的 IDE 比较有名的事 Pycharm，但是它是收费的，虽然听说功能很强大，但我也不清楚，我主要用 VScode，这个是微软自家的王牌产品，直接在引用商店搜索即可。但实际上 Rstudio 也越来越重视对 Python 的支持，可以无缝切换两种语言 reticulate。\n本部分的内容主要介绍相关软件的安装和基本使用。\n\n\n\n\nR Core Team. 2021. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nFootnotes\n\n\nhttps://searchdatacenter.techtarget.com/definition/shell↩︎"
  },
  {
    "objectID": "rbasics.html#r-install",
    "href": "rbasics.html#r-install",
    "title": "1  R 相关的准备",
    "section": "1.1 安装 R",
    "text": "1.1 安装 R\nR 的安装主要是需要有一下几点需要注意：\n\n首先不要着急下载，要先选择一个国内镜像，简单来说，默认的软件存放地址在国外的服务器上，那样下载会比较慢，所以我们先找一个国内的服务。从上面链接的镜像网址中的 China 列表内，找到距离所在地最近的服务器，例如北方东部地区，清华 的开源镜像服务一般是一个比较好的选择。这样在网速一般的情况下，我们相对快速的完成几十兆文件的下载。\n下载哪个文件的问题。按照上面的方式进入镜像后，会在最上方看到下载系统相关软件的链接，可能多数人都是使用 Windows。直接点开后又面临了好多个下载的选择，如果你对他这几个选择毫无概念，那么不要犹豫，base 就是你最好的选择。\n安装过程本身很普通，但是为避免一些莫名其妙的问题，我建议安装路径需要满足两点：路径最好是英文字符；路径中不要带空格，多数情况下不按照这两点做是不影响使用的，但是少数情况下莫名其妙的报错很有可能来源于不按照这两点来操作。\n\n做好上面几点，应该不至于再出一些与安装相关的问题。安装好后我们多数时间是无需再打开 R 来操作了。所以这里我压根不准备给它留一张放图的空间，偶尔有需要在这里升级软件包或 R 的操作，也是几行代码的问题，实在没必要了解太多。"
  },
  {
    "objectID": "rbasics.html#rtool-install",
    "href": "rbasics.html#rtool-install",
    "title": "1  R 相关的准备",
    "section": "1.2 安装 Rtools",
    "text": "1.2 安装 Rtools\n在 R 下载页面，有一个 Rtools 下载页面。这个工具在某些情况下是需要的。它本身的用途异常单一，用于编译 C/C++/Fortran 代码用的。但这并不意味着我们不需要，哪怕我们没有写自己的软件包的需求，在有些情况下，有些软件包是需要从源代码进行编译的，所以为避免以后出问题了不知道原因，不如直接装上，不知道什么原因软件包就工作了好。它的安装只有一个注意事项: 不要更改安装路径！不要更改安装路径！！不要更改安装路径！！！"
  },
  {
    "objectID": "rbasics.html#use-rstudio",
    "href": "rbasics.html#use-rstudio",
    "title": "1  R 相关的准备",
    "section": "1.3 使用 Rstudio",
    "text": "1.3 使用 Rstudio\nR 虽好，原生的 GUI 着实简陋了一些。因此，用户对使用一个方便的编辑器的追求从未停止过。在我的印象里，最初我用 notepad++ 和 gedit，这个相对简单易操作一些。大神们喜欢使用 vim 或 emacs（印象里谢益辉有一次报告还介绍了使用 emacs 来写代码），功能确实强大，但不论编辑器之神还是神之编辑器，入门门槛着实高了一些。直到 Rstudio 的横空出世，彻底解决了平凡人等写代码没有顺手工具的难题，这里用了这么多话来引出 Rstudio，着实是用户的生产力得到了极大的解放。本节的大部分笔墨将介绍它最基本的使用。\n\n1.3.1 基本使用\n安装也没太多可以介绍的，但我还是建议和 R 一样，安装路径最好是没有空格的英文。安装好后直接打开，就能看到一个界面 ：\n\n\n\nFigure 1.1: Rsutdio 界面\n\n\n我修改了默认主题，因为我喜欢黑色背景，感觉注意力很容易被吸引到屏幕上，而且不刺眼。这个开始屏幕是什么也做不了的，我们至少需要打开或新建一个脚本文件来写代码：\n\n\n\nFigure 1.2: 新建一个脚本文件并运行\n\n\nR 的代码文件称为脚本（script），这里我们新建一个脚本文件用于我们写代码，我们看到在打字的过程中，响应的函数会有提示，这样有些比较长的名字或变量，其实我们不用输完，即使记不清楚函数的名字，也可以尝试在这里输入，那么说不定我们看到 Rstudio 给的提示就记起来了，如果要运行当前行或者选中行的代码，有一个快捷键为 Ctr+Enter，我这里就是这么做的，运行完成后。我们会在 plot 那个窗口看到图形，而 plot 的出现也使得 Console 窗口缩小，实际上 Console 就是 Rstudio 调用 R 的窗口。这里需要在下面的菜单里设定：\nTools –> Global Options… –> General –> R version:\n例如我的设置为：\n\n\n\nFigure 1.3: R 的安装路径\n\n\n这里主要为说明另一个问题，正常我们安装的顺序为先安装 R，再安装 Rstudio，一般这里不会出现找不到 R 之类的报错提示，但是我还是遇到过有人反馈这个问题，如果出现了这种情况，就看一下这个位置是不是安装 R 的路径没有找到，只要你按照上面讲的方式安装了，那么即使遇到这种问题了，也可以手动在这里指定安装路径。\n正常我们新建完成之后是保存这个脚本文件的，R 的脚本文件就是以 .R 结尾的，我们可以直接利用快捷键 CTR+S 保存，这是我们所熟悉的操作，就不浪费时间解释和演示了。"
  },
  {
    "objectID": "rbasics.html#rstudio-project",
    "href": "rbasics.html#rstudio-project",
    "title": "1  R 相关的准备",
    "section": "1.4 新建项目文件",
    "text": "1.4 新建项目文件\n即使是日常练习，我们一般也不会随便创建一个文件，通常会把相关数据和脚本文件放在一个文件夹内，这是避免自己电脑太乱的好方法，但是对 Rstudio 来讲，这并不是最佳方案，因为一旦我们文件夹路径稍微复杂一些，那么使用起来并不方便。使用 setwd 固然可以设置当前路径，但终归不是很方便，Rstudio 给出了新的方案，创建新的项目来解决这个问题：\n\n\n\n新建一个项目文件\n\n\n新建项目有三个选项，如果是刚入门的话，通常只会用到前面两个，例如上面我们选择第一项的目的是在选中的路径下，创建一个 test 文件夹，点击 Create Project 后就会完成相关创建，在这个文件夹内就会生成一个 test.Rproj 文件，我们每次要在这个目录内工作，双击打开这个文件即可，那时候的目录就可以使用相对路径的方式，相对路径的含义我解释一下：\n例如我上面创建的路径是 D:/test，数据里有一个文件夹是 data，存放了一个数据文件叫做 aci-test.csv，即数据文件的路径为：D:/test/data/aci-test.csv，那么我要读取他通过相对路径的方式为：\n\n\nCode\nread.csv(\"data/acitest.csv\")\n\n\n而绝对路径则麻烦一些：\n\n\nCode\nread.csv(\"D:/test/data/aci-test.csv\")\n\n\n而且如果我们的目录下有多个代码文件，我们完全可以通过另一个窗口来查看并直接打开，根本无需进入文件夹操作：\n\n\n\n项目所在文件夹的所有文件"
  },
  {
    "objectID": "rbasics.html#rstudio-hotkeys",
    "href": "rbasics.html#rstudio-hotkeys",
    "title": "1  R 相关的准备",
    "section": "1.5 一些基本操作",
    "text": "1.5 一些基本操作\n\n脚本文件里的代码提示：我们每次输入相关代码，例如函数名字，变量名字，Rstudio 会自动弹出提示，这就是所谓的代码补全，我们看到下面一长串字符的时候，其实不用着急用方向键来选择，我们继续输入字母就好了，例如我们要输入 plot.funcition 之后与其输入完 plot. 之后按方向键在那一长串函数下选择，不如继续输入 plot.f，这样子我们需要的 plot.function 就自动跑到第一个候选项来了，这时候只要按 Tab 或 Enter 那么自动输入的字符为 plot.function()，连括号都给写了。\n友好一点的帮助文档查看方式，Rstudio 好是好，但有些窗口对于笔记本电脑着实小了一些，例如查看帮助文档，笔记本都要看不清楚了，那么可以这么操作:\n\n\n\n\n查看帮助文档\n\n\n\n<- 可以通过 Alt + - 来快速输入。\nCtr + Enter 来运行当前行或选中行的代码。\nCtr + A + Enter 来运行所有代码。\nCtr + Shift + F10 来重启 R，这对于程序运行错乱时非常有用，跟安装软件出现莫名其妙不起作用的时候重启电脑一样好用。\nCtr + Shift + C 来批量注释或者去掉注释代码。"
  },
  {
    "objectID": "python-basics.html",
    "href": "python-basics.html",
    "title": "2  其他工具",
    "section": "",
    "text": "到目前为止，Python 还没有好用的工具，因而只能作为辅助工具介绍。\n\n2.0.1 todo"
  },
  {
    "objectID": "packages.html",
    "href": "packages.html",
    "title": "光合相关的软件包",
    "section": "",
    "text": "Liu et al. (2021) 对光合模型研究中使用的 R 包做了一个汇总，如下表：\n\n\n\n光合模型中使用的软件包{#tbl-packages-photo}\n\n\n\n\n\n\nModel.description\nRepesentative.R.packages\n\n\n\n\nFvCB/von Caemmerer model\nAgricolae (S), flux(S), hsdar (S), photosynthesis (S), plantecophys (S), rpmodel(S), YplantQMC(S)\n\n\nTemperature response of parameters of photosynthesis model\nAgricolae (S), flux(S), hsdar (S), photosynthesis (S), plantecophys (S), rpmodel (S), YplantQMC (S)\n\n\nIrradiance response of parameters of photosynthesis model\nPhotosynthesis (S), plantecophys (S)\n\n\nStomatal/mesophyll conductance models\nAgricolae (S), gunit (S), hsdar (S), plantecophys (S), photosynthesis (S), SuessR (S), YplantQMC (S)\n\n\nSensitivity analysis models\nAgricolae (S), photosynthesis (S), plantecophys (S)\n\n\nLight environment and energy balance models\nAquaEnv (S), tealeaves (S), plantecophys (S), VICmodel (S)\n\n\nLarge-scale vegetation models\nFluxnetLSM (S), plantecophys (S), vegan\n\n\nHydraulic models\nAgricolae (S), photosynthesis (S), plantecophys (S), YplantQMC (S)\n\n\nSpectral dynamics analysis models\nAgricolae (S), hsdar(S), plantecophys (S), timp (S)\n\n\nPhylogenetic and evolutionary analysis models\nApe (E), Caper (E), exp2flux (E), geiger (E), HyPhy (E), Phangorn (E), phyloch (E), phytools (E)\n\n\n\n\n\n表内将其功能有了一个简单的分类，有一些是光合专用包，有一些实际上是包含了一部分功能在里面。本章内容主要是对上述软件包以及一些上面表格没有列出的软件包进行相关介绍。其中专用于光合的软件包我会单独介绍，而普适性的或者只有部分功能用于此的则只是简单介绍部分功能。\n\n\n\n\nLiu, Yasi, Xiangping Wang, Dayong Fan, Jiangshan Lai, Alonso Zavafer, Yasi Liu, Xiangping Wang, Dayong Fan, Jiangshan Lai, and Alonso Zavafer. 2021. “The Use of R in Photosynthesis Research.” Functional Plant Biology, October. https://doi.org/10.1071/FP21102."
  },
  {
    "objectID": "phtosyn-pacakges.html#plantecophys",
    "href": "phtosyn-pacakges.html#plantecophys",
    "title": "3  光合专用软件包",
    "section": "3.1 plantecophys 介绍",
    "text": "3.1 plantecophys 介绍\ntodo"
  },
  {
    "objectID": "phtosyn-pacakges.html#plantecowraps",
    "href": "phtosyn-pacakges.html#plantecowraps",
    "title": "3  光合专用软件包",
    "section": "3.2 plantecowrap 介绍",
    "text": "3.2 plantecowrap 介绍\ntodo"
  },
  {
    "objectID": "phtosyn-pacakges.html#photosynthesis",
    "href": "phtosyn-pacakges.html#photosynthesis",
    "title": "3  光合专用软件包",
    "section": "3.3 photosynthesis 介绍",
    "text": "3.3 photosynthesis 介绍\ntodo"
  },
  {
    "objectID": "general-packages.html",
    "href": "general-packages.html",
    "title": "4  生态学通用软件包",
    "section": "",
    "text": "todo"
  },
  {
    "objectID": "data-prepare.html",
    "href": "data-prepare.html",
    "title": "数据准备",
    "section": "",
    "text": "对于数据的基本处理，我还是建议先将 Excel 转为 csv之后，再做相关处理。因为相比 Excel 数据，csv 格式在读取的时候速度还是非常快的，优势比较明显，因为光合仪的数据有许多不需要读入的仪器相关信息，以及大量的公式，普通的 Excel 处理相关的软件包并不支持，而复杂一点的软件包依赖多，一次批量处理为 csv 格式后再处理，对于整个分析是比较有利的，因为很多分析我们并不是一次读入就完成了，可能需要反复调试代码。本部分的内容主要介绍怎么处理光合仪的 Excel 格式转为 csv 格式。"
  },
  {
    "objectID": "data-import.html#sec-6400-excel",
    "href": "data-import.html#sec-6400-excel",
    "title": "5  Excel 转为 csv 格式",
    "section": "5.1 LI-6400 Excel 的处理",
    "text": "5.1 LI-6400 Excel 的处理\ntodo，解决之前请临时参考原始文件的处理：\n\n5.1.1 安装\n暂时只有我的 github repo 中的版本：\n\n\nCode\nremotes::install_github(\"zhujiedong/readphoto\")\n# 或\nremotes::install_git(\"https://gitee.com/zhu_jie_dong/readphoto\")\n\n\n\n\n5.1.2 LI-6400 数据的整合\n将所有 LI-6400 的 原始数据文件 放置于一个文件夹下，例如下面代码放在了名为 6400 的文件夹内，基本参数如下：\n\n\nCode\nlibrary(readphoto)\ndf64  <- read_bat_6400(\"data/6400\", header_line = 17, data_start = 27)\n\n\n其中 header_line 是表头所在行，即 obs 开始的那一行的行号，data_start 也就是我们实际测量数据开始的行号，数据输出如下所示(仅显示前8列数据)：\n\n\n\nLI-6400 批量整合数据{#tbl-6400-importkable}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfiles\nObs\nHHMMSS\nFTime\nEBal.\nPhoto\nCond\nCi\nTrmmol\nVpdL\nCTleaf\nArea\nBLC_1\nStmRat\nBLCond\nTair\nTleaf\nTBlk\nCO2R\nCO2S\nH2OR\nH2OS\nRH_R\nRH_S\nFlow\nPARi\nPARo\nPress\nCsMch\nHsMch\nCsMchSD\nHsMchSD\nCrMchSD\nHrMchSD\nStableF\nBLCslope\nBLCoffst\nf_parin\nf_parout\nalphaK\nStatus\n\n\n\n\n1\naci\n1\n10:55:14\n483.0\n0\n6.990\n0.0831\n251.0\n0.456\n0.501\n21.35\n6\n1.42\n1\n2.84\n20.52\n21.35\n20.08\n400.11\n391.51\n22.012\n22.547\n82.53\n84.54\n500.2\n800\n0\n90.88\n1.820\n-0.305\n0.03860\n0.001870\n0.01340\n0.001280\n1\n-0.22\n2.74\n1\n0\n0.16\n111115\n\n\n4\naci\n2\n10:57:35\n623.5\n0\n5.160\n0.0853\n192.0\n0.465\n0.497\n21.36\n6\n1.42\n1\n2.84\n20.53\n21.36\n20.08\n299.93\n293.58\n22.066\n22.611\n82.70\n84.74\n500.2\n800\n0\n90.88\n1.680\n-0.307\n0.03440\n0.001150\n0.03040\n0.000986\n1\n-0.22\n2.74\n1\n0\n0.16\n111115\n\n\n7\naci\n3\n10:59:55\n763.5\n0\n3.140\n0.0881\n136.0\n0.476\n0.494\n21.36\n6\n1.42\n1\n2.84\n20.53\n21.36\n20.08\n200.16\n196.28\n22.095\n22.653\n82.81\n84.90\n500.2\n800\n0\n90.88\n1.480\n-0.309\n0.01280\n0.001140\n0.01150\n0.000535\n1\n-0.22\n2.74\n1\n0\n0.16\n111115\n\n\n10\naci\n4\n11:02:26\n914.5\n0\n0.910\n0.0927\n81.9\n0.496\n0.490\n21.36\n6\n1.42\n1\n2.84\n20.53\n21.36\n20.08\n99.98\n98.83\n22.108\n22.690\n82.85\n85.03\n500.2\n800\n0\n90.88\n1.050\n-0.309\n0.03030\n0.000609\n0.01740\n0.001070\n1\n-0.22\n2.74\n1\n0\n0.16\n111115\n\n\n13\naci\n5\n11:04:46\n1055.0\n0\n-0.167\n0.0966\n52.7\n0.514\n0.487\n21.36\n6\n1.42\n1\n2.84\n20.53\n21.36\n20.08\n50.16\n50.33\n22.109\n22.712\n82.87\n85.13\n500.2\n800\n0\n90.87\n0.782\n-0.312\n0.00765\n0.001010\n0.00661\n0.001080\n1\n-0.22\n2.74\n1\n0\n0.16\n111115\n\n\n16\naci\n6\n11:07:23\n1211.5\n0\n5.240\n0.1010\n305.0\n0.532\n0.484\n21.35\n6\n1.42\n1\n2.84\n20.53\n21.35\n20.08\n400.05\n393.50\n22.117\n22.740\n82.91\n85.24\n500.2\n800\n0\n90.87\n1.790\n-0.308\n0.07960\n0.001280\n0.05430\n0.000927\n1\n-0.22\n2.74\n1\n0\n0.16\n111115\n\n\n\n\n\n如果想另存为 csv 格式：\n\n\nCode\nwrite.csv(df64, \"./combined.csv\")\n\n\nheader_line 表示你数据表头所在行，data_start 表示你数据起始行，Obs = 1 时所在行，不含表头。这个也要确认好了，不同的测量不能放在一起（务必不要混淆，不然所有数据会放在一个文件夹内），不同的测量可能起始行不同，这样就会报错。\n其中，数据的来源在表格中第一列，叫做 files，是数据来源的文件名（即你起的名字）,例如本例中你看到的 aci 是我之前数据里面 aci 响应曲线的数据。\n这些数据可以用于后文相关的分析中，尤其是像 fitacis 这样的函数，因为本质上他们都是符合 tidyverse 样式的数据。\n\n\n5.1.3 LI-6400 数据重计算\n参数的重计算函数为 recomp_6400, 其参数除了 read_bat_6400 所包含的参数外，还有叶面积 S, 以及叶片正反面的气孔比例，默认值分别为 6 和 0.5。\n\n\nCode\nlibrary(readphoto)\nx1 <- read_bat_6400(\"./data/6400\")\ny1 <- recomp_6400(\"./data/6400\", header_line = 17, data_start = 27, S = 6, K = 0.5)\n\nx1$Photo - y1$Photo\n\n\n [1] -0.0008873753  0.0026900500 -0.0012036469  0.0003483414  0.0006122641\n [6] -0.0113872639 -0.0020986076  0.0004962787  0.0188727482 -0.0294595908\n[11] -0.0436611445 -0.0339083408  0.0046772165  0.0036653298  0.0030397988\n[16] -0.0105901673  0.0040624956  0.0017317049 -0.0073252290  0.0054977377\n[21]  0.0039736503  0.0021704065  0.0046772165  0.0036653298  0.0030397988\n[26] -0.0105901673  0.0040624956  0.0017317049 -0.0073252290  0.0054977377\n[31]  0.0039736503  0.0021704065\n\n\nCode\nx1$Trmmol - y1$Trmmol\n\n\n [1] -2.998596e-04  1.407338e-04  3.189451e-05 -4.586467e-04 -3.836822e-04\n [6]  5.402725e-04 -2.344852e-04 -7.684772e-05  5.979599e-04 -6.534341e-04\n[11] -6.779145e-04  2.469749e-04  3.812201e-04  2.313957e-04  3.508312e-04\n[16] -2.794358e-04 -5.406530e-04  5.230606e-04 -9.183370e-04  7.638850e-04\n[21] -2.578893e-04  2.203045e-04  3.812201e-04  2.313957e-04  3.508312e-04\n[26] -2.794358e-04 -5.406530e-04  5.230606e-04 -9.183370e-04  7.638850e-04\n[31] -2.578893e-04  2.203045e-04\n\n\nCode\nx1$Cond - y1$Cond\n\n\n [1] -1.974217e-04 -3.594216e-04 -3.779119e-04 -3.806675e-04 -3.201411e-04\n [6] -1.483324e-04 -7.803345e-04 -2.671018e-04  1.028977e-04 -3.966192e-04\n[11] -3.190769e-04 -2.314266e-04 -2.746300e-04  1.094050e-05 -4.584791e-05\n[16] -1.084094e-04 -1.827768e-04 -1.344969e-04 -1.714096e-04 -8.180257e-05\n[21] -4.687906e-05 -1.000424e-04 -2.746300e-04  1.094050e-05 -4.584791e-05\n[26] -1.084094e-04 -1.827768e-04 -1.344969e-04 -1.714096e-04 -8.180257e-05\n[31] -4.687906e-05 -1.000424e-04\n\n\nCode\nx1$Ci-y1$Ci\n\n\n [1]  0.434643936 -0.297820404 -0.308200950 -0.007847373 -0.035490198\n [6]  0.433706824 -0.416734067 -0.052089770  0.147655545 -0.315797917\n[11] -0.271335987 -0.228968795  0.356519198  0.311487646  0.052196075\n[16]  0.557128947  0.058563406  0.300198435  0.052607786  0.339000061\n[21] -0.252622980 -0.494554616  0.356519198  0.311487646  0.052196075\n[26]  0.557128947  0.058563406  0.300198435  0.052607786  0.339000061\n[31] -0.252622980 -0.494554616\n\n\nCode\n# half of original the area\ny1 <- recomp_6400(\"./data/6400\",  header_line = 17, data_start = 27, S = 3, K = 0.5)\ny1$Photo/x1$Photo\n\n\n [1] 2.000254 1.998957 2.000767 1.999234 2.007333 2.004346 2.000635 1.999893\n [9] 1.996299 2.005611 2.008161 2.006110 1.998550 1.998863 1.998980 2.003671\n[17] 1.998391 1.999240 2.003866 1.995584 1.994199 2.010360 1.998550 1.998863\n[25] 1.998980 2.003671 1.998391 1.999240 2.003866 1.995584 1.994199 2.010360\n\n\nCode\n# test with random area less than six\narea <- 6 - runif(32, 1, 3)\ny1 <- recomp_6400(\"./data/6400\",  header_line = 17, data_start = 27, S = area, K = 0.5)\ny1$Photo/x1$Photo\n\n\n [1] 1.627716 1.551756 1.272660 1.707664 1.639888 1.294716 1.398209 1.374437\n [9] 1.912166 1.289344 1.251334 1.905400 1.396962 1.265807 1.315987 1.977437\n[17] 1.588661 1.499787 1.340914 1.572989 1.965234 1.222896 1.271408 1.293049\n[25] 1.421131 1.489311 1.369676 1.365579 1.295853 1.318150 1.554089 1.507067\n\n\n我们看到各个值之差非常小，因为我们使用的是相同的叶面积，理论上这两次读数的差异应为 0， 但在实际计算过程中，有小数点位数的影响，所以某些值不完全为 0，但该差值足够小。我们将所有的数据叶面积减半后，二者比值也约等于 2."
  },
  {
    "objectID": "data-import.html#sec-6800-excel-data",
    "href": "data-import.html#sec-6800-excel-data",
    "title": "5  Excel 转为 csv 格式",
    "section": "5.2 LI-6800 Excel 的处理",
    "text": "5.2 LI-6800 Excel 的处理\nLI-6800 的数据我们可以直接处理 Excel 即可，我们分开来看两种方式：\n\n5.2.1 R 下 Excel 格式读取的重计算\nXLConnect 直接读取功能比较麻烦，为了节省时间，我将其写成了函数，放在了我的 readphoto 软件包里，软件包的安装参考 sec. 5.1.1 ：\n当然，最近连我自己安装 github 的软件包都经常出问题，如果大家同样遇到问题，可以按照下面的方式安装：\n它的参数很少，主要作用为：\n\npath 是 Excel 文件的路径；\nstart_row 是数据开始的行号；\nS 为修改的叶面积，默认值为 6，如果叶面积无需更改，则使用默认的 NULL。如果叶面积非默认值，该值必须输入一个长度和测量值数量完全一致的向量，例如，一共有三个测量值，只有第一个叶片没充满叶室，面积为 1.5，其他的为 2，则输入方式为 S = c(1.5, 2, 2)。\n\n我们直接使用下面的例子解释，导入的数据是 6 cm2 的默认面积：\n\n\nCode\nlibrary(readphoto)\n\ndf6 <- xlconnect_read(\"./data/aci-xlc.xlsx\")\ndf6$A\n\n\n [1] 24.7381184 18.1379358 10.8055345  3.0239340 -0.9144044 26.9519572\n [7] 27.5088717 40.9101889 50.1393342 55.3865984 58.0662751 59.3556428\n\n\nCode\ndf3 <- xlconnect_read(\"./data/aci-xlc.xlsx\", S = rep(3, 12))\ndf6$A/df3$A\n\n\n [1] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5\n\n\nCode\ndf_random <- xlconnect_read(\"./data/aci-xlc.xlsx\", S = rnorm(12, 3, 0.1))\ndf6$A/df_random$A\n\n\n [1] 0.5211940 0.4824420 0.4935206 0.5123068 0.4757073 0.5183378 0.4973584\n [8] 0.5036629 0.5173251 0.5002952 0.5031616 0.4965824\n\n\n光合速率的倍数的变化在预期之内。\n\n\n5.2.2 使用 Python 来处理\n目前版本的使用非常简单，首先选择 excel 数据文件所在的文件夹，通过点击 Choose the data folder 来实现，然后点击 Run LI-6800 Excel Converter 来运行整个转换过程即可，最后转换的 csv 文件存放于数据文件夹内新生成的一个叫做 final-csv-data 的文件夹内，当前版本无需指定表头所在的行号，直接运行即可。程序很简单，如果不是要整理为图形界面，那么没有几行，已经上传 github：\npython 源代码\n如果不嫌弃图形界面打开需要等待 1 min 左右的时间，那么可以从下面的链接下周 exe 程序双击直接运行即可。\nLI6800_excel2csv\n\n\n5.2.3 批量处理 csv 文件\n如果还是比习惯用 R，我们来处理上面的 csv 文件即可 (期望后面添加到软件包里，成为一个函数，rSys.Date()` 尚未有时间修改)：\n\n\nCode\nfiles_csv <- list.files(\"./data/csvdata\", full.names = TRUE)\nfiles_csv\n\n\n[1] \"./data/csvdata/racirtest1.csv\" \"./data/csvdata/rcirtest3.csv\" \n\n\nCode\nadd_remark <- function(path){\n  df <- read.csv(path)\n  df$remarks <- gsub(\".csv\", \"\", basename(path))\n  return(df)\n}\n\nlist_csv <- lapply(files_csv, add_remark)\n\ndf_remark <- do.call(rbind, list_csv)\n\nn <- ncol(df_remark)\n\n\n会在数据的添加 remarks，在最后一列，按照上面的代码，产生的内容是 csv 文件的文件名：\n\n\n\n\n\n\n到此为止已经整理为所谓的 tidy data 了，用 tidyverse 也好，用 base 语法也好，总之是比较容易处理的数据了，例如上面其实是 RACiR 数据了，有两个，那么当然可以使用 plantecophys::fitacis 来一条命令搞定所有数据的拟合了。\n这里需要注意的是使用 xlconnect_read 也可以使用类似的操作，但我觉得不如这种方法省事，故而只列出来这一种，有需要的也可以按照类似方法处理即可。"
  },
  {
    "objectID": "batch-method.html",
    "href": "batch-method.html",
    "title": "6  数据的基本处理",
    "section": "",
    "text": "本部分内容介绍数据的基本处理方式。 todo"
  },
  {
    "objectID": "light-response.html#sec-traditional-aq",
    "href": "light-response.html#sec-traditional-aq",
    "title": "光响应曲线简介",
    "section": "传统的光响应曲线测量",
    "text": "传统的光响应曲线测量\n如果严格按上面描述的光响应曲线的发生步骤，从黑暗到达超过饱和光强的测量光来测量，那么耗时将会非常久，因为气孔调节的时间比较长，故而多数文献都采用了从高光强开始下降，直到黑暗阶段的逆向测量过程，例如 ZiPiao (2010)。该方式测量曲线与由黑暗到强光的变化过程的曲线重合度比较高。但仍需要注意保证各个测量过程测量点的数量足够。\n2021-12-14 待完善内容。"
  },
  {
    "objectID": "light-response.html#sec-dat-aq",
    "href": "light-response.html#sec-dat-aq",
    "title": "光响应曲线简介",
    "section": "DAT 测量光响应曲线",
    "text": "DAT 测量光响应曲线\nSaathoff and Welles (2021) 介绍了使用 LI-6800 的 DAT 方式测量光响应曲线的方法：\n {#fig-wiley-data-img} 该方法测量在测量时间和拟合结果上与传统的方法并无显著差异：\n\n\n\nFigure 1: DAT 与传统方式的光响应曲线相关数据的差异\n\n\n因为本质上传统方式的光响应曲线和 DAT 方式并无显著差异，叶室环境一致，只是将光强的骤降变为缓慢下降。但他的优势在于拟合用的数据点量非常高，这样可以有效降低非线性拟合参数估计的不确定性，同时测量时无需提前预实验确定测量光强数据点的分布情况，因为相对而言，可以人为 DAT 方式测量的结果数据点是连续的。不存在有可能数据点分布不均匀，导致确实某段信息的可能。\n\n\n\n\nKok, Bessel. 1956. “On the Inhibition of Photosynthesis by Intense Light.” Biochimica Et Biophysica Acta 21 (2): 234–44. https://doi.org/10.1016/0006-3002(56)90003-8.\n\n\nLobo, F. A. de, M. P. de Barros, H. J. Dalmagro, Â. C. Dalmolin, W. E. Pereira, É. C. de Souza, G. L. Vourlitis, and C. E. Ortíz. 2013. “Fitting Net Photosynthetic Light-Response Curves with Microsoft Excel - a Critical Look at the Models.” Photosynthetica 51 (3): 445–56. https://doi.org/10.1007/s11099-013-0045-y.\n\n\nOgren, E. 1993. “Convexity of the Photosynthetic Light-Response Curve in Relation to Intensity and Direction of Light During Growth.” Plant Physiology 101 (3): 1013–19. https://www.ncbi.nlm.nih.gov/pmc/articles/PMC158720/.\n\n\nSaathoff, Aaron J., and Jon Welles. 2021. “Gas Exchange Measurements in the Unsteady State.” Plant, Cell & Environment 44 (11): 3509–23. https://doi.org/10.1111/pce.14178.\n\n\nZiPiao, YE. 2010. “A Review on Modeling of Responses of Photosynthesis to Light and CO_2.” Chinese Journal of Plant Ecology, no. 06."
  },
  {
    "objectID": "nls-start.html#sec-nlslm",
    "href": "nls-start.html#sec-nlslm",
    "title": "7  非线性拟合初值确定",
    "section": "7.1 nlsLM 解决方案",
    "text": "7.1 nlsLM 解决方案\nnlsLM 来自于 Elzhov et al. (2016) 的 minpack.lm，利用 C 语言的 MINPACK 库，修改了 Levenberg-Marquardt 算法，在实际操作中，很多时候并不准确的输入初值，它也能得出比较好的拟合结果。结果未必完美，但出现下面让人烦恼的报错：\n\nsingular gradient matrix at initial parameter estimates\n\n的概率会大大降低，而且尽管有可能结果不如意，我们也可以利用他的结果缩小初值的范围，继续尝试其他初值。\n例如下面的例子中，非直角双曲线 (sec. 9) 的 Rd 的初值我们可以利用暗呼吸的实测值大致估计，同理最大光合速率也是如此，剩下的分别为非直角双曲线曲率，我们暂定为 1，alpha 也暂定为 0.1，使用 nlsLM 进行拟合，结果如下： ::: {.cell}\n\nCode\nlibrary(minpack.lm)\n\nlrcnls_lm <- nlsLM(lrc_A ~ (1/(2*theta))*\n        (alpha*lrc_Q+Am-sqrt((alpha*lrc_Q+Am)^2 - \n        4*alpha*theta*Am*lrc_Q))- \n        Rd, start=list(Am=(max(lrc_A)-min(lrc_A)),\n        alpha=0.1,Rd=-min(lrc_A),theta=0.8)) \n\n:::\n结果没有报错，看上去没有问题，那我们观察一下具体的拟合结果：\n\n\nCode\nsummary(lrcnls_lm)\n\n\n\nFormula: lrc_A ~ (1/(2 * theta)) * (alpha * lrc_Q + Am - sqrt((alpha * \n    lrc_Q + Am)^2 - 4 * alpha * theta * Am * lrc_Q)) - Rd\n\nParameters:\n       Estimate Std. Error t value Pr(>|t|)    \nAm    12.307570   0.406739  30.259 2.30e-10 ***\nalpha  0.045706   0.003423  13.352 3.09e-07 ***\nRd     0.656638   0.132646   4.950 0.000791 ***\ntheta  0.707522   0.079738   8.873 9.59e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1852 on 9 degrees of freedom\n\nNumber of iterations to convergence: 8 \nAchieved convergence tolerance: 1.49e-08\n\n\n结果看上去还可以，不过有的时候结果并不理想，该方法并不是万无一失，也就是初值设置也不能太离谱，还是要接近正常值。"
  },
  {
    "objectID": "nls-start.html#sec-plot_comp",
    "href": "nls-start.html#sec-plot_comp",
    "title": "7  非线性拟合初值确定",
    "section": "7.2 作图比对法",
    "text": "7.2 作图比对法\n模型很多参数可以用已有数据去估计，我们可以只分析难以判断的参数，流程如下：\n\nRd、Am等我们可以利用测量值来确定一个范围。\n剩余的参数，我们也可以根据经验或文献来有一个大致的判断。\n然后我们根据数学的方式来判断哪个参数对曲线形状影响最大（例如在分母上的参数，或者是乘以该参数，该参数可以显著改变计算结果，例如整体乘以或除以 0.1 还是 0.01，像 Rd 之类的参数本身就很小，多数公式中都是减去该值，对结果影响很小，我们通常直接使用实测值 ）。\n将该参数取一系列值带入模型来求解净光合速率。\n将计算的A值与光强进行作图，看我们计算的曲线与测量数据点的重合程度，必要时在修改其他参数，使曲线和散点重合度最好，重合程度最高的参数值即为我们需要的初始值。\n\n\n7.2.1 实现过程\n\n\nCode\n# 我们选择的模型，将其写为一个函数，用于计算净光合速率\nexpfct <- function(x, Am, alpha, Rd, theta) {\n  (1/(2 * theta)) * (alpha * x + Am - sqrt((alpha * x + \n  Am)^2 - 4 * alpha * theta * Am * x)) - Rd\n}\n\n# 我们的数据\ntest <- data.frame(x = lrc_Q, y = lrc_A)\n\n\n\n\nCode\n# 先做实测数据的散点图\nplot(y ~ x, data = test)\n\n# 利用上面的函数，假定 alpha 的值为0.8，看计算值与测量值重合程度\ncurve(expfct(x, Am = (max(lrc_A)-min(lrc_A)),\n     alpha=0.8, Rd=-min(lrc_A), theta=0.8), add = TRUE\n             )\n\n\n\n\n\nFigure 7.1: 初步判断 alpha 的初始值\n\n\n\n\n观察 fig. 7.1 的结果可以看到，曲线在 0-600 的范围内，拟合值明显偏大，观察模型的方程式，以及其他起始值的设定方式，我们初步判断 alpha 的值偏大，于是乎我们将其改小观察，但曲线和测量点的重合仍然不是很好，我们尝试修改 theta 值与 alpha 值（也即曲线高于测量点，则需要减小纵坐标的值，低于测量点，则需要增加该值，该过程省略，我大概设置了五分钟完成），最终得出的结果如下：\n\n\nCode\nplot(y ~ x, data = test)\ncurve(expfct(x, Am = (max(lrc_A)-min(lrc_A)),\n     alpha=0.06, Rd=-min(lrc_A), theta=0.82), add = TRUE)\n\n\n\n\n\nFigure 7.2: 初修正后断 alpha 的初始值\n\n\n\n\nfig. 7.2 尽管看上去效果仍然不满意，但我们可试着进行拟合，看能否得到显著差异的结果：\n\n\nCode\nlrcnls_manual <- nls(lrc_A ~ \n        (1/(2*theta))*\n        (alpha*lrc_Q+Am-sqrt((alpha*lrc_Q+Am)^2 - \n         4*alpha*theta*Am*lrc_Q))- Rd, \n        start=list(Am=(max(lrc_A)-min(lrc_A)),\n        alpha=0.03,Rd=-min(lrc_A),theta=0.6))\nsummary(lrcnls_manual)\n\n\n\nFormula: lrc_A ~ (1/(2 * theta)) * (alpha * lrc_Q + Am - sqrt((alpha * \n    lrc_Q + Am)^2 - 4 * alpha * theta * Am * lrc_Q)) - Rd\n\nParameters:\n       Estimate Std. Error t value Pr(>|t|)    \nAm    12.307585   0.406741  30.259 2.30e-10 ***\nalpha  0.045706   0.003423  13.352 3.09e-07 ***\nRd     0.656642   0.132646   4.950 0.000791 ***\ntheta  0.707518   0.079739   8.873 9.59e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1852 on 9 degrees of freedom\n\nNumber of iterations to convergence: 7 \nAchieved convergence tolerance: 4.601e-06\n\n\n\n\nCode\n# 对拟合之后的结果作图，观察使用我们的估计值，\n# 迭代的最终值与元数据的重合程度\nplot(y ~ x, data = test, ylim = c(-2, 14))\ncurve(expfct(x, Am = 12.307586,\n     alpha=0.045706, Rd= 0.656643, theta=0.707518), add = TRUE)\n\n\n\n\n\nFigure 7.3: 检验作图法的初始值判断\n\n\n\n\n从 fig. 7.3 的呈现以及 F 检验的 p 值来讲，图形已经比较完美了。也就是说尽管我们作图的时候看到重合度并不高，但是非线性拟合本来就是一个迭代的过程，只要我们的数据与真实值相差不大，还是能够得到完美结果的。\n\n\n7.2.2 直观展示\n上面的表述太啰嗦，直接用下面的图形说明一下，其中 alhpa 的取值在此处选择从 0.01 到 0.07，每次增加 0.05，其他值分别为 Am = 12.31, Rd= 0.66, theta=0.71 （此处为展示效果和方便，将这些值直接按照拟合结果设定了，实际差别不大）\n\n\nCode\nlibrary(ggplot2)\nlibrary(purrr)\n\nlrc <- read.csv(\"data/nlstest.csv\")\n\n# 光响应曲线比较简单，我们将需要的数据直接提取，方便后面操作\nlrc_Q <- lrc$Qin\nlrc_A <- lrc$A\nn <- length(lrc_A)\n\n\nalp <- paste0(\"a=\", seq(0.01, 0.07, by = 0.005))\nalpn <- rep(alp, each = n)\n\nexpfct <-\n  function(x, Am, alpha, Rd, theta) {\n    (1 / (2 * theta)) * (alpha * x + Am - \n    sqrt((alpha * x + Am) ^ 2 - 4 * alpha * \n    theta * Am * x)) - Rd\n  }\n\nparas <-\n  data.frame(\n    alpha = rep(seq(0.01, 0.07, by = 0.005), each = n),\n    x = rep(lrc_Q, n),\n    Am = rep(12.31, n),\n    Rd = rep(0.66, n),\n    theta = rep(0.71, n)\n  )\ny = unlist(pmap(paras, expfct))\n\nshow <- data.frame(\n  x = rep(lrc_Q, 14),\n  y = c(lrc_A, y),\n  a = factor(c(rep(\"measured\", n), alpn),\n             level = c(\"measured\", alp))\n)\n\nggplot(data = show, aes(x, y, group = a, color = a)) +\n  geom_point() +\n  geom_smooth(se = FALSE) \n\n\n\n\n\nFigure 7.4: 多个 alpha 取值的差异\n\n\n\n\n从 fig. 7.4 我们我们可以看到，实测值在 alpha =0.04 和 alpha = 0.05 两条曲线之间，在 0.045 时最接近测量点，也就是我们把初始值设为 0.04 和 0.05 之间最接近，本例中可认为是0.045，实际这三个值均可。"
  },
  {
    "objectID": "nls-start.html#sec-mult_try",
    "href": "nls-start.html#sec-mult_try",
    "title": "7  非线性拟合初值确定",
    "section": "7.3 自动多次尝试法",
    "text": "7.3 自动多次尝试法\n该方法实际为使用 nls2 来实现，具体方法参考 Bouvier and Huet (1994) 的文章，可简单概括为使用一系列的起始值梯度（例如下面的代码中， alpha 的取值在 0.01 到 0.08 之间 ），然后软件循序使用不同的起始值，即排列组合所有的起始值序列，最终找到合适的值，具体实现如下：\n\n\nCode\nlibrary(nls2)\n\ngrid.test <- expand.grid(list(\n  Am=c(12),\n  alpha = seq(0.01, 0.08, by =0.01),\n  Rd = seq(0, 3),\n  theta=seq(0.1, 1, by = 0.1)\n  ))\n\nlrcnls2 <- nls2(lrc_A ~ \n        (1/(2*theta))*\n        (alpha*lrc_Q+Am-sqrt((alpha*lrc_Q+Am)^2 - \n                               4*alpha*theta*Am*lrc_Q))- \n        Rd, start = grid.test, algorithm = \"brute-force\")\n\n\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\nError in numericDeriv(form[[3L]], names(ind), env, central = nDcentral) : \n  Missing value or an infinity produced when evaluating the model\n\n\nCode\nsummary(lrcnls2)\n\n\n\nFormula: lrc_A ~ (1/(2 * theta)) * (alpha * lrc_Q + Am - sqrt((alpha * \n    lrc_Q + Am)^2 - 4 * alpha * theta * Am * lrc_Q)) - Rd\n\nParameters:\n       Estimate Std. Error t value Pr(>|t|)    \nAm    12.000000   0.623023  19.261 1.27e-08 ***\nalpha  0.050000   0.006414   7.795 2.72e-05 ***\nRd     1.000000   0.260153   3.844  0.00394 ** \ntheta  0.800000   0.102143   7.832 2.62e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3663 on 9 degrees of freedom\n\nNumber of iterations to convergence: 320 \nAchieved convergence tolerance: NA\n\n\n通过结果可以看到，虽然和之前采用手动方法判定的结果比较接近，但还是略有差异，可以看一下他们各自的结果同测量值的重合程度：\n\n\nCode\nplot(lrc_Q, lrc_A)\nlines(lrc_Q,  predict(lrcnls2), col=\"red\")\nlines(lrc_Q,  predict(lrcnls_manual), col=\"blue\")\n\n\n\n\n\nFigure 7.5: 两种方法结果的对比展示\n\n\n\n\nfig. 7.5 表明使用 nls2 的拟合结果似乎和测量值更匹配，当然这只是第一印象，后续的判断还要进一步通过 F 检验、 AIC、BIC 等统计方式才能判定 (sec. 12)。"
  },
  {
    "objectID": "nls-start.html#sec-sum_start",
    "href": "nls-start.html#sec-sum_start",
    "title": "7  非线性拟合初值确定",
    "section": "7.4 小结",
    "text": "7.4 小结\n采用如上三种方式都可以有效的解决起值的问题，nlsLM 操作上更易实现，对初值的大小不敏感，但设置不能太离谱，否则仍然会报错。作图比对法操作上更麻烦一些，但是这种方式一定能得出合理的初始值设置。采用 nls2 类似于将手动作图方式自动化，类似于 SPSS 中非线性拟合中需要给出一个初始值的范围，且该范围不能过大。如有一定的经验，操作起来将非常迅速。\n需要注意的是，这三种方法结合起来使用会更好，例如，即使用 nlsLM 的结果不合理，也可以参考他们参数的范围（部分结果也可能是差异显著），然后将这些结果用于手动作图判定参数或者 nls2 中判定参数范围，或者使用作图法确定大致的范围，将该范围输入到 nls2 中，这样会节省时间，也更加方便。\n\n\n\n\nBouvier, Annie, and Sylvie Huet. 1994. “Nls2 Nonlinear Regression by s PLUS Functions.” Computational Statistics & Data Analysis 18 (1): 187–90.\n\n\nElzhov, Timur V., Katharine M. Mullen, Andrej Nikolai Spiess, and Ben Bolker. 2016. “Minpack.lm: R Interface to the Levenberg-Marquardt Nonlinear Least-Squares Algorithm Found in MINPACK, Plus Support for Bounds.”"
  },
  {
    "objectID": "hyp.html#sec-rec_fit",
    "href": "hyp.html#sec-rec_fit",
    "title": "8  直角双曲线模型",
    "section": "8.1 直角双曲线模型的实现",
    "text": "8.1 直角双曲线模型的实现\n若没有安装 minpack.lm, 则需要首先：\ninstall.packages(\"minpack.lm\")\n具体实现过程如下：\n\n\nCode\n# 调用非线性拟合包minpack.lm，也可以直接使用nls\nlibrary(minpack.lm)\n# 读取数据，同fitaci数据格式\nlrc <- read.csv(\"data/lrc.csv\")\nlrc <- subset(lrc, Obs > 0)\n\n# 光响应曲线没有太多参数，\n# 直接调出相应的光强和光合速率\n# 方便后面调用\nlrc_Q <- lrc$PARi\nlrc_A <- lrc$Photo \n\n# 采用非线性拟合进行数据的拟合\nlrcnls <- nlsLM(lrc_A ~ (alpha * lrc_Q * Am) * \n                (1/(alpha * lrc_Q + Am)) - Rd,  \n              start=list(Am=(max(lrc_A)-min(lrc_A)),\n              alpha=0.05,Rd=-min(lrc_A))\n)\nfitlrc_rec <- summary(lrcnls)\n\n# 补偿点时净光合速率为0，\n# 据此利用uniroot求解方程的根\nIc <- function(Ic){(fitlrc_rec$coef[2,1] * Ic *\n    fitlrc_rec$coef[1,1]) * (1/(fitlrc_rec$coef[2,1] * \n    Ic + fitlrc_rec$coef[1,1])) - fitlrc_rec$coef[3,1] \n}\n\nuniroot(Ic, c(0,50))$root\n\n\n[1] 3.650053\n\n\nCode\n# 根据饱和点定义，0.75最大光合速率为饱和点，\n# 也可以是其他比例\n# 据此利用uniroot求解方程的根\n\nIsat <- function(Isat){(fitlrc_rec$coef[2,1] * \n        Isat * fitlrc_rec$coef[1,1]) * \n    (1/(fitlrc_rec$coef[2,1] * Isat + \n          fitlrc_rec$coef[1,1])) - fitlrc_rec$coef[3,1] -\n    0.75 * fitlrc_rec$coef[1,1]\n}\n# 求值区间根据具体实验确定\n\nuniroot(Isat, c(0,2500))$root\n\n\n[1] 700.0946\n\n\nCode\n# 使用ggplot2进行作图并拟合曲线\nlibrary(ggplot2)\n\nlight <- data.frame(lrc_Q = lrc$PARi, lrc_A = lrc$Photo)\n\nrec_form <- y ~ (alpha * x * Am) * (1/(alpha * x + Am)) - Rd\n\n\nggplot(light, aes(x = lrc_Q, y = lrc_A)) + \n  geom_point(shape = 16, size = 3, color = \"green\") + \n  geom_smooth(method=\"nls\", formula = rec_form, se = FALSE,\n  method.args = list(start = c(\n  Am = (max(lrc_A) - min(lrc_A)),\n  alpha = 0.05,\n  Rd = -min(lrc_A)),\n  aes(x =lrc_Q, y = lrc_A, \n  color='blue', size = 1.2))\n  ) +\n  labs(y=expression(paste(\"photosynthetic rate  \", \n       \"(\", mu, mol%.%m^-2%.%s^-1, \")\")), \n       x=expression(paste(\"PAR \", \n       \"(\", mu, mol%.%m^-2%.%s^-1, \")\"))\n       )+\n  theme_light()\n\n\n\n\n\nFigure 8.1: 直角双曲线模型拟合\n\n\n\n\n代码目的见注释，其实现过程主要分三步：\n\n光响应曲线的拟合，使用到了非线性模型 nlsLM，也可以使用 nls，具体实现方法请查看参考文档。\n求饱和点和补偿点，补偿点的计算根据其定义，净光合速率为 0，求解模型在一定区间的根来计算，而饱和点则较为麻烦，若使用 eq. 8.2 计算，那么饱和点远远低于我们实际需求的，因此，我们使用了 0.75P_{nmax} 来计算，求得目标区间的根。当然也可以采用其他比例来作为饱和点光合速率。\n\n\n\n\n\nTable 8.1: 直角双曲线计算参数 \n\n\n\nEstimate\nStd. Error\nt value\nPr(>|t|)\n\n\n\n\nAm\n16.6721752\n0.1522849\n109.480151\n0.0000000\n\n\nalpha\n0.0783312\n0.0026774\n29.256870\n0.0000000\n\n\nRd\n0.2810926\n0.0789338\n3.561117\n0.0051716\n\n\n\n\n\n\n最终的数据拟结果如 fig. 8.1 所示，拟合的参数及结果见 tbl. 8.1。\n\n\n\n\nBaly, EC. 1935. “The Kinetics of Photosynthesis.” Proceedings of the Royal Society of London Series B (Biological Sciences), no. 117: 218–39.\n\n\nHuang, HY, XY Dou, PY Sun, B Deng, GJ Wu, and CL Peng. 2009. “Comparison of Photosynthetic Characteristics in Two Ecotypes of Jatropha Curcas in Summer.” Acta Ecologica Sinica, no. 29: 2861–67.\n\n\nZhang, XS, SH Shen, and J Song. 2009. “The Vertical Distribution of Cotton Leaf Nitrogen Content and Photosynthetic Characteristics in the North China Plain.” Acta Ecologica Sinica, no. 29: 1893–98.\n\n\nZiPiao, YE. 2010. “A Review on Modeling of Responses of Photosynthesis to Light and CO_2.” Chinese Journal of Plant Ecology, no. 06."
  },
  {
    "objectID": "non-hypo.html#sec-nonrec_mode_exam",
    "href": "non-hypo.html#sec-nonrec_mode_exam",
    "title": "9  非直角双曲线模型",
    "section": "9.1 非直角双曲线模型的实现",
    "text": "9.1 非直角双曲线模型的实现\n\n\nCode\nlibrary(minpack.lm)\n\n# 读取数据，同fitaci数据格式\nlrc <- read.csv(\"data/lrc.csv\")\nlrc <- subset(lrc, Obs > 0)\n\n# 光响应曲线没有太多参数，\n# 直接调出相应的光强和光合速率\n# 方便后面调用\nlrc_Q <- lrc$PARi\nlrc_A <- lrc$Photo \n\n# 非直角双曲线模型的拟合\nlrcnls <- nlsLM(lrc_A ~ \n                (1/(2*theta))*\n                (alpha*lrc_Q+Am-sqrt((alpha*lrc_Q+Am)^2 - \n                4*alpha*theta*Am*lrc_Q))- Rd,\n                start=list(Am=(max(lrc_A)-min(lrc_A)),\n                alpha=0.05,Rd=-min(lrc_A),theta=1)) \n\nfitlrc_nrec <- summary(lrcnls)\n\n# 光补偿点\nIc <- function(Ic){\n  (1/(2 * fitlrc_nrec$coef[4,1])) * \n    (fitlrc_nrec$coef[2,1] * Ic + fitlrc_nrec$coef[1,1] - \n    sqrt((fitlrc_nrec$coef[2,1] * Ic + fitlrc_nrec$coef[1,1]\n    )^2 -  4 * fitlrc_nrec$coef[2,1] * \n    fitlrc_nrec$coef[4,1] * fitlrc_nrec$coef[1,1] * Ic)) -\n    fitlrc_nrec$coef[3,1]\n}\n\nuniroot(Ic, c(0,50))$root  \n\n\n[1] 2.234292\n\n\nCode\n# 光饱和点\nIsat <- function(Isat){\n  (1/(2 * fitlrc_nrec$coef[4,1])) * (fitlrc_nrec$coef[2,1] * \n  Isat + fitlrc_nrec$coef[1,1] - sqrt(\n  (fitlrc_nrec$coef[2,1] * Isat +fitlrc_nrec$coef[1,1])^2 - \n  4*fitlrc_nrec$coef[2,1] * fitlrc_nrec$coef[4,1] * \n  fitlrc_nrec$coef[1,1] * Isat)) - \n  fitlrc_nrec$coef[3,1] - (0.9*fitlrc_nrec$coef[1,1])}\n\nuniroot(Isat, c(0,2000))$root\n\n\n[1] 1596.286\n\n\nCode\n# 使用ggplot2进行作图并拟合曲线\nlibrary(ggplot2)\nlight <- data.frame(lrc_Q = lrc$PARi, lrc_A = lrc$Photo)\n\nnonrec_form <- y ~ \n  (1/(2*theta))*(alpha*x+Am-sqrt((alpha*x+Am)^2 - \n   4*alpha*theta*Am*x))- Rd\n\nggplot(light, aes(x = lrc_Q, y = lrc_A)) + \n  geom_point(shape = 16, size = 3, color = \"green\") + \n  geom_smooth(method=\"nls\", formula = nonrec_form, se = FALSE,\n  method.args = list(start = c(Am=(max(lrc_A)-min(lrc_A)), \n  alpha=0.05, Rd=-min(lrc_A), theta=1), \n  aes(color='blue', size = 1.2))) +\n  labs(y=expression(paste(\"photosynthetic rate  \", \n          \"(\", mu, mol%.%m^-2%.%s^-1, \")\")), \n       x=expression(paste(\"PAR \", \n           \"(\", mu, mol%.%m^-2%.%s^-1, \")\"))) +\n  theme_light()\n\n\n\n\n\nFigure 9.1: 非直角双曲线模型拟合\n\n\n\n\n\n\n\n\nTable 9.1: 非直角双曲线计算参数 \n\n\n\nEstimate\nStd. Error\nt value\nPr(>|t|)\n\n\n\n\nAm\n15.8017296\n0.1513064\n104.435285\n0.0000000\n\n\nalpha\n0.0658067\n0.0020216\n32.551422\n0.0000000\n\n\nRd\n0.1461717\n0.0420800\n3.473659\n0.0070082\n\n\ntheta\n0.3700908\n0.0493403\n7.500783\n0.0000369\n\n\n\n\n\n\n最终的数据拟结果如图 fig. 9.1 所示，拟合的参数及结果见表 ?tbl-nrectable-。单纯从作图来看，本例数据使用非直角双曲线与散点图重合程度更高。"
  },
  {
    "objectID": "non-hypo.html#sec-fitqa-quick",
    "href": "non-hypo.html#sec-fitqa-quick",
    "title": "9  非直角双曲线模型",
    "section": "9.2 利用函数来拟合",
    "text": "9.2 利用函数来拟合\n上面的方式是手动实现，也并不复杂，phtosynthesis 和 FitAQ 软件包提供了非直角双曲线模型的相应的函数，可以让我们方便的进行处理。\n\n9.2.1 使用 photosynthesis 处理\n安装可以通过 CRAN:\n\n\nCode\ninstall.packages('photosynthesis')\n\n\n我们看一下 LI-6400 数据的使用：\n\n\nCode\nlibrary(photosynthesis)\nfit6400 <- fit_aq_response(lrc, varnames = list(A_net = \"Photo\", PPFD = \"PARi\"))\n\n\n他的拟合结果的查看方式为：\n\n\nCode\nsummary(fit6400[[1]])\n\n\n\nFormula: A_net ~ aq_response(k_sat, phi_J, Q_abs = data$Q_abs, theta_J) - \n    Rd\n\nParameters:\n                Estimate Std. Error t value Pr(>|t|)    \nk_sat          15.801730   0.151307 104.435 3.43e-15 ***\nphi_J.Q_abs     0.065807   0.002022  32.551 1.20e-10 ***\ntheta_J         0.370091   0.049340   7.501 3.69e-05 ***\nRd.(Intercept)  0.146172   0.042080   3.474  0.00701 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.06845 on 9 degrees of freedom\n\nNumber of iterations to convergence: 6 \nAchieved convergence tolerance: 1.49e-08\n\n\n除此以外，它还提供了只看拟合结果的方式：\n\n\nCode\nfit6400[[2]]\n\n\n         A_sat      phi_J   theta_J        Rd      LCP  resid_SSs\nk_sat 15.80173 0.06580667 0.3700908 0.1461717 2.234292 0.04216531\n\n\n他们的意义按顺序为：\n\n饱和光下的净光合速率 (A_sat)，\n表观量子效率 (phi_J),\n曲线的弯曲程度 (theta_J),\n暗呼吸速率 (Rd),\n光补偿点 (LCP),\n残差的平方和 (resid_SS)。\n\n也可以直接输出图形，只不过要想定制化，还要自己做：\n\n\nCode\nfit6400[[3]]\n\n\n\n\n\nphotosynthesis 软件包的非直角双曲线拟合图形查看\n\n\n\n\n如果是 LI-6800，稍微修改一下参数即可，这里不再进行一步一步的演示：\n\n\nCode\naq6800 <- read.csv(\"data/lrc6800.csv\")\nfit6800 <-\n  fit_aq_response(aq6800, varnames = list(A_net = \"A\", PPFD = \"Qin\"))\n\n\n\n\n9.2.2 使用 FitAQ 处理\n安装必须是从 github 安装，当然，如果你和我遇到一样登录 github 困难的话，我把他 fork 到 gitee 上去了：\n\nremotes::install_git(\"https://gitee.com/zhu_jie_dong/FitAQ\")\n#或\nremotes::install_github(\"MarkusLoew/FitAQ\")\n使用也比较方便，默认这样操作就行了：\n\n\nCode\nlibrary(FitAQ)\nFitAQ(data = lrc, A = Photo, Q = PARi)\n\n\n         Amax        phi        Rd     theta\nAmax 15.80173 0.06580667 0.1461717 0.3700908\n\n\n如果觉得不满意，还可以手动调整初值，作者考虑的比较周到：\n\n\nCode\nfit1 <- FitAQ(\n  data = lrc,\n  A = Photo,\n  Q = PARi,\n  provide.model = TRUE,\n  nlscontrol = c(maxiter = 500),\n  start = list(\n    Amax = 15,\n    phi = 0.06,\n    Rd = 0.14,\n    theta = 0.3\n  ),\n  lower = c(12, 0, 0, 0),\n  upper = c(17, 0.1, 3, 0.5),\n  trace = TRUE\n)\n\n\n  0:     2.6244459:  15.0000 0.0600000 0.140000 0.300000\n  1:   0.021848654:  15.7837 0.0658725 0.146820 0.377608\n  2:   0.021082662:  15.8019 0.0658089 0.146186 0.370045\n  3:   0.021082654:  15.8017 0.0658067 0.146172 0.370090\n  4:   0.021082654:  15.8017 0.0658067 0.146172 0.370091\n\n\nCode\nsummary(fit1)\n\n\n\nFormula: A ~ ((phi * Q + Amax - sqrt((phi * Q + Amax)^2 - 4 * theta * \n    phi * Q * Amax)))/(2 * theta) - Rd\n\nParameters:\n       Estimate Std. Error t value Pr(>|t|)    \nAmax  15.801730   0.151306 104.435 3.43e-15 ***\nphi    0.065807   0.002022  32.551 1.20e-10 ***\nRd     0.146172   0.042080   3.474  0.00701 ** \ntheta  0.370091   0.049340   7.501 3.69e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.06845 on 9 degrees of freedom\n\nAlgorithm \"port\", convergence message: relative convergence (4)\n\n\nCode\npredict_range <- data.frame(Q = seq(from = 0, to = 3000, by = 20))\n\naddline <-\n  within(predict_range, A <-\n           predict(fit1, newdata = predict_range))\nplot(\n  Photo ~ PARi,\n  data = lrc,\n  xlim = c(0, 3000),\n  ylim = c(0, 16)\n)\nlines(A ~ Q, data = addline, col = \"blue\", lwd = 3.2)\n\n\n\n\n\nFitAQ 的非直角双曲线拟合\n\n\n\n\n这里需要说明，FitAQ 作者使用的 base R 的语法，而 photosynthesis 则喜欢 ggplot2，这两个谈不上优劣，只是相比而言，photosynthesis 把一些细节都做了，出结果比较省事，但是要做一些定制化图形的时候没有接口，而 FitAQ 则把细节美化留给用户自己来操作，但出基本结果的时候代码量会大一些。定制程度更高一些。\n\n\n\n\n\n\n提醒\n\n\n\n这里做拟合曲线图形的时候用了一个小技巧，与我 fig. 9.1 所采用的方式完全不同，我的作图实际上是强行把非线性拟合放到 ggplot2 内，而这里不需要拟合过程，只需要参数带入模型，得出数据点来，只要数据点足够密集，我们用线连接所有数据点后，看上去就是一条平滑的曲线，这种方式虽然是欺骗，但是并没有错误，数据点足够密集，我们根本看不出是点还是线来。\n\n\n饱和点和补偿点的计算也提供了方便的函数：\n\n\nCode\nFitLCP(fit1)\n\n\n     LCP \n2.234293 \n\n\nCode\nFitSat(fit1)\n\n\n     LSP \n1455.489 \n\n\nCode\nFitSat(fit1, sat.fac = 0.95, range = c(0, 3200))\n\n\n     LSP \n2986.574 \n\n\n饱和点也是使用了达到最大饱和光强多少比例时候的值，带入模型求的光强而得到，例如这里修改后使用了 0.95，看上去结果就不不正常了。\n至于 LI-6800 的分析，也是一样，修改光合速率和光合有效辐射两个参数的名称即可：\n\n\nCode\naq6800 <- read.csv(\"data/lrc6800.csv\")\nFitAQ(data = aq6800, A = A, Q = Qin)\n\n\n         Amax      phi       Rd     theta\nAmax 39.05857 0.063463 3.243814 0.7451511\n\n\n为了减少篇幅，不在展开做过多的介绍，使用方式和上面演示的 LI-6400 一致。\n\n\n\n\nThornley, J H M. 1976. “Mathematical Models in Plant Physiology.” London: Academic Press."
  },
  {
    "objectID": "exp.html#sec-lrc_exp_exam",
    "href": "exp.html#sec-lrc_exp_exam",
    "title": "10  指数模型",
    "section": "10.1 指数模型的实现",
    "text": "10.1 指数模型的实现\n\n\nCode\nlibrary(minpack.lm)\n\n# 读取数据，同fitaci数据格式\nlrc <- read.csv(\"data/lrc.csv\")\nlrc <- subset(lrc, Obs > 0)\n\n# 光响应曲线没有太多参数，\n# 直接调出相应的光强和光合速率\n# 方便后面调用\nlrc_Q <- lrc$PARi\nlrc_A <- lrc$Photo \n\n# 模型的拟合\nlrcnls <- nlsLM(lrc_A ~ Am*(1-exp((-b)*(lrc_Q-Ic))),\n                start=list(Am=(max(lrc_A)-min(lrc_A)),\n                           Ic=5, b=1)\n                )\nfitlrc_exp <- summary(lrcnls)\n\n# 光饱和点\nIsat <- function(Isat){fitlrc_exp$coef[1,1]*\n    (1-exp((-fitlrc_exp$coef[3,1])*(Isat-\n    fitlrc_exp$coef[2,1])))-0.9*fitlrc_exp$coef[1,1]}\n\nuniroot(Isat, c(0,2000))$root\n\n\n[1] 558.6038\n\n\nCode\n## 拟合图形\nlibrary(ggplot2)\nlight <- data.frame(lrc_Q = lrc$PARi, lrc_A = lrc$Photo)\n\nexp_form <- y ~ Am*(1-exp((-b)*(x -Ic)))\n\nggplot(light, aes(x = lrc_Q, y = lrc_A)) + \n  geom_point(shape = 16, size = 3, color = \"green\") + \n  geom_smooth(method=\"nls\", formula = exp_form, \n    se = FALSE, method.args = list(\n    start = c(Am=(max(lrc_A)-min(lrc_A)),\n    Ic=5, b=0.002), aes(x =lrc_Q, y = lrc_A, \n    color='blue', size = 1.2))\n  )  +\n  labs(y=expression(paste(\"photosynthetic rate  \", \n          \"(\", mu, mol%.%m^-2%.%s^-1, \")\")), \n       x=expression(paste(\"PAR \", \n           \"(\", mu, mol%.%m^-2%.%s^-1, \")\"))) +\n  theme_light()\n\n\n\n\n\nFigure 10.1: 指数模型拟合\n\n\n\n\n\n\n\n\nTable 10.1: 指数模型计算参数 \n\n\n\nEstimate\nStd. Error\nt value\nPr(>|t|)\n\n\n\n\nAm\n13.6547568\n0.1723363\n79.233185\n0.0000000\n\n\nIc\n-0.5133438\n2.3370250\n-0.219657\n0.8305573\n\n\nb\n0.0041183\n0.0002012\n20.467032\n0.0000000\n\n\n\n\n\n\n最终的数据拟结果如图 fig. 10.1 所示，拟合的参数及结果见表 tbl. 10.1。\n\n\n\n\nPrado, C. H., and J. A. P. V. De Moraes. 1997. “Photosynthetic Capacity and Specific Leaf Mass in Twenty Woody Species of Cerrado Vegetation Under Field Conditions.” Photosynthetica 33 (1): 103–12."
  },
  {
    "objectID": "hyp-rev.html#sec-rev_rec_exam",
    "href": "hyp-rev.html#sec-rev_rec_exam",
    "title": "11  直角双曲线的修正模型",
    "section": "11.1 直角双曲线修正模型的实现",
    "text": "11.1 直角双曲线修正模型的实现\n\n\nCode\nlibrary(minpack.lm)\n\n# 读取数据，同fitaci数据格式\nlrc <- read.csv(\"data/lrc.csv\")\nlrc <- subset(lrc, Obs > 0)\n\n# 光响应曲线没有太多参数，\n# 直接调出相应的光强和光合速率\n# 方便后面调用\nlrc_Q <- lrc$PARi\nlrc_A <- lrc$Photo \n\n# 模型的拟合\nlrcnls <- nlsLM(lrc_A ~ alpha * ((1 - \n              beta*lrc_Q)/(1 + gamma * lrc_Q)) * lrc_Q - Rd,\n                start=list(alpha = 0.07, beta = 0.00005,\n                           gamma=0.004, Rd = 0.2)\n                )\nfitlrc_mrec <- summary(lrcnls)\n\n# 饱和点计算\nIsat <-  (sqrt((fitlrc_mrec$coef[2,1] + fitlrc_mrec$coef[3,1])/\n              fitlrc_mrec$coef[2,1]) -1)/fitlrc_mrec$coef[3,1]\n# 补偿点计算\nIc <- (\n  -(fitlrc_mrec$coef[3, 1] * fitlrc_mrec$coef[4, 1] - \n  fitlrc_mrec$coef[1, 1]) - sqrt((fitlrc_mrec$coef[3, 1] * \n  fitlrc_mrec$coef[4, 1] - fitlrc_mrec$coef[1, 1])^2- \n  (4 * fitlrc_mrec$coef[1, 1] * fitlrc_mrec$coef[2, 1] * \n  fitlrc_mrec$coef[4, 1])))/\n  (2*fitlrc_mrec$coef[1,1]*fitlrc_mrec$coef[2,1])\n\n## 拟合图形\nlibrary(ggplot2)\nlight <- data.frame(lrc_Q = lrc$PARi, lrc_A = lrc$Photo)\n\nmod_rec_form <-  y ~ \n  alpha * ((1 - beta*x)/(1 + gamma * x)) * x - Rd\n\nggplot(light, aes(x = lrc_Q, y = lrc_A)) + \n  geom_smooth(method=\"nls\", \n    formula = mod_rec_form, \n    se = FALSE, method.args = list(\n    start = c(alpha = 0.07, beta = 0.00005,\n              gamma=0.004, Rd = 0.2), \n    aes(x =lrc_Q, y = lrc_A, \n    color='blue', size = 1.2))\n  )+\n  labs(y=expression(paste(\"photosynthetic rate  \", \n          \"(\", mu, mol%.%m^-2%.%s^-1, \")\")), \n       x=expression(paste(\"PAR \", \n           \"(\", mu, mol%.%m^-2%.%s^-1, \")\")))+\n  theme_light()\n\n\n\n\n\n直角双曲线修正模型拟合\n\n\n\n\n\n\n\n\nTable 11.1: 直角双曲线修正模型计算参数 \n\n\n\nEstimate\nStd. Error\nt value\nPr(>|t|)\n\n\n\n\nalpha\n0.0730858\n0.0021209\n34.460183\n0.0000000\n\n\nbeta\n0.0000501\n0.0000133\n3.776115\n0.0043751\n\n\ngamma\n0.0040622\n0.0001955\n20.773916\n0.0000000\n\n\nRd\n0.2156186\n0.0543505\n3.967190\n0.0032685\n\n\n\n\n\n\n尽管修正模型可以方便的计算饱和点和补偿点，但如同 Lobo et al. (2013) 所指出，双曲线模型对其结果的计算常有超出生态学意义范围的值1，因此对模型的选择不能一概而论，需根据实际情况而选择。\n\n\n\n\nLobo, F. De A., M. P. De Barros, H. J. Dalmagro, Â. C. Dalmolin, W. E. Pereira, É. C. de Souza, G. L. Vourlitis, and C. E. Rodríguez Ortíz. 2013. “Fitting Net Photosynthetic Light-Response Curves with Microsoft Excel a Critical Look at the Models.” Photosynthetica 51 (3): 445–56.\n\n\nZiPiao, YE. 2010. “A Review on Modeling of Responses of Photosynthesis to Light and CO_2.” Chinese Journal of Plant Ecology, no. 06."
  },
  {
    "objectID": "aq-choose.html#sec-aic-bic",
    "href": "aq-choose.html#sec-aic-bic",
    "title": "12  如何选择合适的模型",
    "section": "12.1 AIC 与 BIC",
    "text": "12.1 AIC 与 BIC\nAIC 和 BIC 都是用于模型选择的标准1， 其中他们主要的差别是：\n\n其中 AIC 主要应用目的是，对于给定数据集的多个模型，判定哪个模型对该数据集最合适，该值越小越合适。\n\n\n而 BIC 的主要目的是对于不同数量拟合参数的模型来选择。同样，该值是越小越好。\n\n但需要注意，如果样本数量过低，那么就需要使用修正的 AIC 指数 (Fabozzi et al. 2014)，即 AICc，这个函数不在 base 中，需要第三方的软件包，例如 AICcmodavg。\ninstall.packages('AICcmodavg')\n为方便，我们使用 nlsLM 来进行四种模型的比较：\n\n\nCode\nlibrary(minpack.lm)\nlibrary(AICcmodavg)\n\n# 读取数据，同fitaci数据格式\nlrc <- read.csv(\"data/lrc.csv\")\nlrc <- subset(lrc, Obs > 0)\n\n# 光响应曲线没有太多参数，\n# 直接调出相应的光强和光合速率\n# 方便后面调用\nlrc_Q <- lrc$PARi\nlrc_A <- lrc$Photo \n\n# 非直角双曲线模型的拟合\nnon_rec_aq <- nlsLM(lrc_A ~ \n                (1/(2*theta))*\n                (alpha*lrc_Q+Am-sqrt((alpha*lrc_Q+Am)^2 - \n                4*alpha*theta*Am*lrc_Q))- Rd,\n                start=list(Am=(max(lrc_A)-min(lrc_A)),\n                alpha=0.05,Rd=-min(lrc_A),theta=1)) \n# 直角双曲线\nrec_aq <- nlsLM(lrc_A ~ (alpha * lrc_Q * Am) * \n                (1/(alpha * lrc_Q + Am)) - Rd,  \n              start=list(Am=(max(lrc_A)-min(lrc_A)),\n              alpha=0.05,Rd=-min(lrc_A))\n)\n\n# 指数模型的拟合\nexp_aq <- nlsLM(lrc_A ~ Am*(1-exp((-b)*(lrc_Q-Ic))),\n                start=list(Am=(max(lrc_A)-min(lrc_A)),\n                           Ic=5, b=1)\n                )\n\n# 直角双曲线修正模型的拟合\nmod_rec_aq <- nlsLM(lrc_A ~ alpha * ((1 - \n              beta*lrc_Q)/(1 + gamma * lrc_Q)) * lrc_Q - Rd,\n                start=list(alpha = 0.07, beta = 0.00005,\n                           gamma=0.004, Rd = 0.2)\n                )\n\nAIC(rec_aq, non_rec_aq, exp_aq, mod_rec_aq)\n\n\n           df        AIC\nrec_aq      4  -9.142650\nnon_rec_aq  5 -27.611987\nexp_aq      4   7.099285\nmod_rec_aq  5 -19.268459\n\n\nCode\nBIC(rec_aq, non_rec_aq, exp_aq, mod_rec_aq)\n\n\n           df        BIC\nrec_aq      4  -6.882852\nnon_rec_aq  5 -24.787240\nexp_aq      4   9.359083\nmod_rec_aq  5 -16.443712\n\n\n对于 AICc 使用则略微麻烦，因为它没有直接支持向量化操作：\n\n\nCode\nlapply(list(rec_aq, non_rec_aq, exp_aq, mod_rec_aq), AICc)\n\n\n[[1]]\n[1] -4.14265\n\n[[2]]\n[1] -19.04056\n\n[[3]]\n[1] 12.09929\n\n[[4]]\n[1] -10.69703\n\n\n我们可以看到，结果里出现了负数，这是合理的，我们所讲的越小越好，没有说必须是正直，负值是合理的，而且是常见的。"
  },
  {
    "objectID": "aq-choose.html#sec-f-test",
    "href": "aq-choose.html#sec-f-test",
    "title": "12  如何选择合适的模型",
    "section": "12.2 方差分析",
    "text": "12.2 方差分析\n这个经典方法常常因为就在眼前而让人忽视，实际上他也是可以的，看看 R 是怎么描述 anova 的：\n\nCompute analysis of variance (or deviance) tables for one or more fitted model objects.\n\n当然了，过程很简单:\n\n\nCode\nanova(rec_aq, non_rec_aq, exp_aq, mod_rec_aq)\n\n\nAnalysis of Variance Table\n\nModel 1: lrc_A ~ (alpha * lrc_Q * Am) * (1/(alpha * lrc_Q + Am)) - Rd\nModel 2: lrc_A ~ (1/(2 * theta)) * (alpha * lrc_Q + Am - sqrt((alpha * lrc_Q + Am)^2 - 4 * alpha * theta * Am * lrc_Q)) - Rd\nModel 3: lrc_A ~ Am * (1 - exp((-b) * (lrc_Q - Ic)))\nModel 4: lrc_A ~ alpha * ((1 - beta * lrc_Q)/(1 + gamma * lrc_Q)) * lrc_Q - Rd\n  Res.Df Res.Sum Sq Df   Sum Sq F value    Pr(>F)    \n1     10    0.20360                                  \n2      9    0.04217  1  0.16144  34.458 0.0002377 ***\n3     10    0.71020 -1 -0.66803 142.588 8.030e-07 ***\n4      9    0.08011  1  0.63009  70.787 1.477e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n不管是从残差的平方和还是 p 值上看，都与 AIC 和 BIC 结果一致。"
  },
  {
    "objectID": "aq-choose.html#sec-aq-eye",
    "href": "aq-choose.html#sec-aq-eye",
    "title": "12  如何选择合适的模型",
    "section": "12.3 肉眼判断",
    "text": "12.3 肉眼判断\n标题有点搞笑，但其实是可以快速筛选判断的，只不过文章里面或附录里面才需要上面的方法来提供数据支持。例如我们把前面几个方程作图的代码整合在一起看一下数据的情况：\n\n\nCode\nlibrary(ggplot2)\n\n# 直角双曲线\nrectangular <- y ~ (alpha * x * Am) * (1/(alpha * x + Am)) - Rd\n# 非直角双曲线\nnon_rectangular <- y ~ \n  (1/(2*theta))*(alpha*x+Am-sqrt((alpha*x+Am)^2 - \n   4*alpha*theta*Am*x))- Rd\n\n# 指数模型\nexponential <- y ~ Am*(1-exp((-b)*(x -Ic)))\n\n# 修改模型\n\nrectangular_revised <-  y ~ \n  alpha * ((1 - beta*x)/(1 + gamma * x)) * x - Rd\n\nggplot(lrc, aes(x = lrc_Q, y = lrc_A)) + \n  geom_point(shape = 16, size = 3, color = \"gray\")+\n  \n  geom_smooth(method=\"nls\", formula = rectangular, \n              se = FALSE, color='black',\n  method.args = list(start = c(\n  Am = (max(lrc_A) - min(lrc_A)),\n  alpha = 0.05,\n  Rd = -min(lrc_A)),\n  aes(x =lrc_Q, y = lrc_A, \n   size = 0.9))\n  )  +\n  \n  geom_smooth(method=\"nls\", formula = non_rectangular, \n              se = FALSE, color='red', \n  method.args = list(start = c(Am=(max(lrc_A)-min(lrc_A)), \n  alpha=0.05, Rd=-min(lrc_A), theta=1), \n  aes(x =lrc_Q, y = lrc_A, size = 1.2))) +\n                \n  geom_smooth(method=\"nls\", formula = exponential, \n    se = FALSE,  color='green',\n    method.args = list(\n    start = c(Am=(max(lrc_A)-min(lrc_A)),\n    Ic=5, b=0.002), aes(x =lrc_Q, y = lrc_A, \n    size = 0.9))\n  )+\n      \n  geom_smooth(method=\"nls\", \n    formula = rectangular_revised,  color='blue',\n    se = FALSE, method.args = list(\n    start = c(alpha = 0.07, beta = 0.00005,\n              gamma=0.004, Rd = 0.2), \n    aes(x =lrc_Q, y = lrc_A, \n    size = 0.9))\n  ) + \n  labs(y=expression(paste(\"photosynthetic rate  \", \n          \"(\", mu, mol%.%m^-2%.%s^-1, \")\")), \n       x=expression(paste(\"PAR \", \n           \"(\", mu, mol%.%m^-2%.%s^-1, \")\")))+\n  theme_light()\n\n\n\n\n\nFigure 12.1: 可以明显淘汰一种模型的例子\n\n\n\n\n该例子并不是特别典型，但结果上来看，红线和蓝线，也就是非直角双曲线和直角双曲线修改模型，看上去比较符合变化趋势。\n\n\n\n\nFabozzi, Frank J., Sergio M. Focardi, Svetlozar T. Rachev, and Bala G. Arshanapalli. 2014. The Basics of Financial Econometrics: Tools, Concepts, and Asset Management Applications. 1st edition. Wiley."
  },
  {
    "objectID": "big-leaf.html#sec-leaf-scale-meas",
    "href": "big-leaf.html#sec-leaf-scale-meas",
    "title": "13  大叶模型",
    "section": "13.1 叶片尺度测量",
    "text": "13.1 叶片尺度测量\n文章中所使用的是 LI-6400，但毫无疑问，LI-6800 可以更好的胜任该工作，具体测量方法为：\n\n从 4 月中旬到 10 月，除 6 月因为洪水有中断外，每周进行一次光响应曲线的测量。\n为最小化几个优势种测量时样本之间的变异性，考虑了枝条的差异、枝条不同叶片之间的年龄、以及环境的随机效应的影响。测量选取的是一系列相邻的枝条或草丛。在特定的日期，每个植株选择两个枝条上的，在完全展开的成熟叶片中选择最 2-4 最年轻的叶片进行测量（2片或4片，由物种而定）。\n测量的不为距离叶片顶端约 3/4，选择的都是冠层顶部的叶片。\n测量过程是标准的光响应曲线的测量流程，不同的是在光强设置为 0 时，额外等待 4 min，用于测量暗呼吸速率。\n该实验测量的时间是欧洲中部时间的 7-11 点。"
  },
  {
    "objectID": "big-leaf.html#sec-big-leaf-data",
    "href": "big-leaf.html#sec-big-leaf-data",
    "title": "13  大叶模型",
    "section": "13.2 数据的处理",
    "text": "13.2 数据的处理\n\n13.2.1 单个测量数据的处理\n\n单个测量的数据使用的是非线性拟合，选取的为非直角双曲线模型，使用了 nls2 作为非线性拟合的工具。\n暗呼吸速率的值是拟合模型曲线与纵坐标的交点。\n\n3.不同物种、不同测量日期和不同生育期的参数各自拟合。\n\n\n13.2.2 大叶模型的数据处理\n\n在不同季节，使用 LI-3100C 测量了不同物种的叶面积指数。\n计算单个植株的 LAI 占不同时期以及整个生长季 LAI 的比例，以此作为该植株拟合参数的权重。而整个大叶模型的参数则是对这些权重数据进行求和。然后将这些参数带入所用的非直角双曲线模型。\n\n\n\n\nFigure 13.1: 根据 LAI 权重求和来计算大叶模型的参数\n\n\n光响应曲线的拟合可以参考 ?sec-nonrec-mod。部分实验结果如下：\n\n\n\nFigure 13.2: 假定不同物种组成下的模型结果\n\n\n\n\n\n\nKnauer, Jürgen, Tarek S. El-Madany, Sönke Zaehle, and Mirco Migliavacca. 2018. “Bigleaf—An R Package for the Calculation of Physical and Physiological Ecosystem Properties from Eddy Covariance Data.” PLOS ONE 13 (8): e0201114. https://doi.org/10.1371/journal.pone.0201114.\n\n\nMejdová, Markéta, Jiří Dušek, Lenka Foltýnová, Lenka Macálková, and Hana Čížková. 2021. “Photosynthetic Parameters of a Sedge-Grass Marsh as a Big-Leaf: Effect of Plant Species Composition.” Scientific Reports 11 (1): 3723. https://doi.org/10.1038/s41598-021-82382-2."
  },
  {
    "objectID": "aci-curve.html#sec-aci-vs-racir",
    "href": "aci-curve.html#sec-aci-vs-racir",
    "title": "二氧化碳响应曲线概述",
    "section": "ACi VS RACiR",
    "text": "ACi VS RACiR\n在评估作物性状时，V_{cmax} 及 J_{max}时非常有用，传统的 A–Ci 曲线测量要求植物叶片要在一定浓度 CO_{2} 下适应几分钟后完成测量，这样的测量有几个缺点：\n\n测量时间长，一条曲线至少需要 20 – 30 min，样本量多，重复多时，这种方法几乎没有可行性。\n整个测量过程中，时间长，酶的激活状态会有变化，叶绿体会移动，气孔的开度也会发生变化。\n\n而 LI-6800 独有的 auto control 功能在算法上允许用户自定义 CO_{2} 的起始浓度和种植浓度、变化方式（线性或其他）、所花费的时间，再加上其 IRGAs 极快的响应频率，使得短时间内的 A–Ci 的测量成为现实，即快速 CO_{2} 响应曲线 RACiR 测量实验 (J. R. Stinziano et al. 2017)，该功能使得 5 min 内测量 A–Ci 曲线成为可能。该方法的实现可参考 J. R. Stinziano et al. (2017) 的文章。\nJoseph R. Stinziano et al. (2018) 针对 RACiR技术的疑问做了解答并提出了准确测量的建议，概括如下：\n\n首先，采用 100 ppm/min 的变化速率是与标准方法重合度最高的测量。\n其次，明确研究问题，目前已有研究表明Vcmax 与 Jmax 的计算结果与标准测量方法结果无显著差异。\n任何条件的改变，都需要做空叶室校准，例如：流速，气体浓度变化方向、温度，斜率等。\n空叶室校准与叶片测量采用严格的同一次校准，因为 IRGA 的漂移，需要再次匹配时，或者环境条件改变时，需要重新做空叶室校准。是否需要匹配，可通过不加叶片的最初状态查看，此时 A 值应接近为0，reference 和 sample 气体浓度读数接近相等。\nIRGA 分析器使用 5 此多项式进行校准，推荐使用 1 次到 5 次多项式进行拟合，然后根据 BIC 指数来确定最合适的空叶室校准系数（即非参数拟合的模型选择的问题）。 确定最合适的浓度变化范围。通常需要去掉最初和最后 30 s的数据。\n最小化校准和测量值之间的水分摩尔分数差异。甚至有可能需要控制 reference 或 sample 的水的摩尔分数而不是 Vpdleaf。 通过预实验来确定最合适的 CO_2 变化范围和随时间的斜率。\n\n而 Coursolle et al. (2019) 测量了簇状叶黑云杉和香脂冷杉两种簇状叶植物的 RACiR，实验方法在 J. R. Stinziano et al. (2017) 的基础上做了轻微的改进，其方法和结论值得在测量时借鉴，测量方法上：\n\n簇状叶室体积远大于荧光叶室和其他叶室，使用的 CO_2 的变化为： 15 min 内从 20 ppm 到 1520 ppm 的变化，即变化的速率为 100 ppm \\cdot min^{-1}。但也测试了 200 - 800 ppm的部分曲线。\n拟合使用了测量的 Rd，测量方法为：控制 reference 气路在 420 ppm 的 CO_2 和 22 mmol \\cdot mol^{-1} 的 H2O 浓度，控制温度为 25 C，诱导后测量 Rd。\n\n得到了一些有帮助的结论：\n\n使用更大的叶室测量 RACiR 是可行的（36 cm^2），叶室环境的控制需要通过预实验来确定。\n该实验使用的 ACi 曲线测量时间在 30 到 36 min，而 RACiR 使用的完整的二氧化碳的浓度范围时，曲线耗时最大的时间接近 22 min。但使用 200 - 800 ppm 范围的变化，则时间可以下降 50%，这些部分范围的测量则可以应用于植物胁迫和表型平台的研究。\n实验结果证明只要 match 的调整值保持不变即无需进行空叶室校准（也就是无需匹配的意思，实际的时间间隔取决于仪器的状态），但最新的 range match 功能可有效的增加空叶室校准的时间间隔（新功能，作者试验时尚未推出该功能）。\n作者建议最好测量暗呼吸的速率，以获得最佳的 Vcmax 和 Jmax 计算结果。如果有第二台光合仪来测量则可有效的缩短测量时间。\n\nRACiR 方法在测量方式上是一种动态的方法，而传统 ACi 曲线则是一种静态的测量方式，但植物叶片在 2 s 内能够对外界 CO2 的变化做出响应，并能达到准稳态状态，这使得该方法测量时有理论依据的 (J. R. Stinziano et al. 2017)，而且使用不同的 CO2 变化速率，有助于进一步了解植物光合的特性。Joseph R., Rachael K., and David T. (2019) 最新的研究给出一系列结论：\n\n扩散限制（CO_2 总导度） 和光呼吸导致了表观上的标准 ACi 曲线和 RACiR 测量之间的偏差，表明他们的差异是由生物因子引起，而非仪器导致的人为误差。\n上述原因导致的二者之间的偏差，如果不进行修正，那么将显著的低估 \\Gamma^*, 除非使用多个速率的 RACiR 来修正。\n较高速率的 RACiR 曲线会增大其与标准曲线之间的偏差，但这个差距在无光呼吸的条件下会减小。\n因为光呼吸和气体扩散限制与物种相关，结合以上结论，可以使用多个速率的 RACiR 来估算对 CO_2 的总导度以及相对量的光呼吸速率。\n\n一些可能的方向：\n\n扩散限制影响 Cc 速率的变化，说明对具有较高总阻力与 CO_2 比值的物种，例如针叶物种，C4 植物，较高的阻力导致 RACiR 与 标准 ACi 测量斜率更大的差异，或者测量的前提假设被破坏。\nRACiR 可检测到代谢中 CO_2 的滞后性，各种滞后性的检测对标准 ACi 测量也具有指示性。\n\n由此来看，RACiR 测量具有进一步深入研究的意义。\n\n使用 DAT 做快速 ACi\nRACiR 测量相比普通测量来讲，需要进行叶室修正，在大批量测量的情况下，无疑会使得后期数据处理比较繁琐。Saathoff and Welles (2021) 根据 LI-6800 的新特性，开创性的使用 DAT（dynamic assimilation technique）技术来进行测量。使得光合测量进入了动态测量的新时代，而在 LI-6800 系统 BLUE \\ge 1.5.02 版本之后，因为快速变化导致两个分析器浓度响应速度不同的问题在仪器内部可以直接修正，无需再测量结束后进行额外的校准。这使得快速 ACi 的 测量更加容易和方便。\n\n\n\nFigure 2: DATvsRACiR\n\n\n需要指出的是 Joseph R. Stinziano et al. (2018) 的修正是建议采用多项式拟合因分析器响应速度的差异导致的误差，而 DAT 则是从根本上解决该问题，简单来讲，DAT 是基于叶室物质平衡计算的光合速率，与稳态测量计算采取的策略一致。考虑了参比气路和样品气路体积差异，时间差异的基础上，通过与时间相关的斜率来修正动态数据，但二者目的均为修正在变化的 CO2 浓度下两个分析器响应时间不一致的问题，在使用 RACiR 建议的 100 ppm 变化率时，二者接近完美的重合 fig. 2：\n而且在 LI-6800 BP 界面直接有相关自动测量程序供使用，可以通过设置完相关参数后，一键自动运行来完成测量。这也是我们目前建议测量快速 ACi 曲线的方式。\n\n关于 DAT 或 RACiR 来应对过参数化的问题\nAlan McClain 关于 DAT 来帮助 ACi 曲线拟合过参数化 1 有一个讨论，我们可以看一下。首先 FvCB 模型是一个过参数化的方程，这是毋庸置疑的：\n 一个典型的 ACi 曲线数据点一般不会超过 16 个（不是不能超过，是测量时间太久），而即使使用整体拟合，也要有 7 个拟合参数，至于分段拟合的话，甚至有可能只有 3 个数据点来拟合的情况发生，这在数学上无疑是典型的过参数化。而数据点比较少也是导致不同拟合方式结果差异较大的原因之一：\n\n\n\nFigure 3: 相同数据集不同拟合方式的结果差异\n\n\n而 DAT 或 RACiR 数据量一般都在几百个，这样不管是整体拟合还是分段拟合，相比拟合的参数来讲，拟合数据点的量足够大，在很大程度上能够避免过参数化带来的影响。\n\n\n\nFigure 4: 几百个数据无疑降低了过参数化的可能\n\n\n\n\n\n\nAganchich, B, S Wahbi, F Loreto, and M Centritto. 2009. “Partial Root Zone Drying: Regulation of Photosynthetic Limitations and Antioxidant Enzymatic Activities in Young Olive (Olea Europaea) Saplings.” Tree Physiology 29 (5): 685.\n\n\nCentritto, M, F Loreto, and K Chartzoulakis. 2003. “The Use of Low Co2 to Estimate Diffusional and Non-Diffusional Limitations of Photosynthetic Capacity of Salt-Stressed Olive Saplings.” Plant Cell and Environment 26 (4): 585–94.\n\n\nCoursolle, Carole, Guillaume O. Prud’homme, Manuel Lamothe1, and Nathalie Isabel1. 2019. “Measuring Rapid a–Ci Curves in Boreal Conifers: Black Spruce and Balsam Fir.” Frontiers in Plant Science. https://doi.org/10.3389/fpls.2019.01276.\n\n\nEllsworth, David S, Kristine Y Crous, Hans Lambers, and Julia Cooke. 2015. “Phosphorus Recycling in Photorespiration Maintains High Photosynthetic Capacity in Woody Species.” Plant Cell and Environment 38 (6): 1142–56.\n\n\nFarquhar, G. D., S. Von Caemmerer, and J. A. Berry. 1980. “A Biochemical Model of Photosynthetic CO_2 Assimilation in Leaves of C3 Species.” Planta 149 (1): 78–90.\n\n\nFlexas J, Azespejo A, and Berry J A. 2007. “Analysis of Leakage in IRGA’s Leaf Chambers of Open Gas Exchange Systems: Quantification and Its Effects in Photosynthesis Parameterization.” Journal of Experimental Botany 58 (6): 1533.\n\n\nHaworth, Matthew, Dilek Killi, Alessandro Materassi, and Antonio Raschi. 2015. “Coordination of Stomatal Physiological Behavior and Morphology with Carbon Dioxide Determines Stomatal Control.” American Journal of Botany 102 (5): 677–88.\n\n\nHaworth, Matthew, Giovanni Marino, and Mauro Centritto. 2018. “An Introductory Guide to Gas Exchange Analysis of Photosynthesis and Its Application to Plant Phenotyping and Precision Irrigation to Enhance Water Use Efficiency.” Journal of Water and Climate Change. https://doi.org/https://doi.org/10.2166/wcc.2018.152.\n\n\nHeath, James R, Edward Ayres, Malcolm Possell, Richard D Bardgett, Helaina I J Black, Helen Grant, Phil Ineson, and Gerhard Kerstiens. 2005. “Rising Atmospheric Co2 Reduces Sequestration of Root-Derived Soil Carbon.” Science 309 (5741): 1711–13.\n\n\nHikosaka, K, K Ishikawa, A Borjigidai, O Muller, and Y Onoda. 2006. “Temperature Acclimation of Photosynthesis: Mechanisms Involved in the Changes in Temperature Dependence of Photosynthetic Rate.” Journal of Experimental Botany 57 (2): 291.\n\n\nJoseph R., Stinziano, Adamson Rachael K., and Hanson David T. 2019. “Using Multirate Rapid ACi Curves as a Tool to Explore New Questions in the Photosynthetic Physiology of Plants.” New Phytologist. https://doi.org/10.1111/nph.15657.\n\n\nLauteri, Marco, Matthew Haworth, Rachid Serraj, Maria Cristina Monteverdi, and Mauro Centritto. 2014. “Photosynthetic Diffusional Constraints Affect Yield in Drought Stressed Rice Cultivars During Flowering.” PLOS ONE 9 (10).\n\n\nLong, S. P., and C. J. Bernacchi. 2003. “Gas Exchange Measurements, What Can They Tell Us about the Underlying Limitations to Photosynthesis? Procedures and Sources of Error.” Journal of Experimental Botany 54 (392): 2393.\n\n\nMarshall, B, and P V Biscoe. 1980. “A Model for C3 Leaves Describing the Dependence of Net Photosynthesis on Irradiance.” Journal of Experimental Botany 31 (1): 29–39.\n\n\nSaathoff, Aaron J., and Jon Welles. 2021. “Gas Exchange Measurements in the Unsteady State.” Plant, Cell & Environment 44 (11): 3509–23. https://doi.org/10.1111/pce.14178.\n\n\nStinziano, J. R., P. B. Morgan, D. J. Lynch, A. J. Saathoff, D. K. Mcdermitt, and D. T. Hanson. 2017. “The Rapid a-Ci Response: Photosynthesis in the Phenomic Era.” Plant Cell & Environment 40.\n\n\nStinziano, Joseph R, Dayle K Mcdermitt, Douglas J Lynch, Aaron J Saathoff, Patrick B Morgan, and David T Hanson. 2018. “The Rapid a/Ci Response: A Guide to Best Practices.” New Phytologist.\n\n\nWullschleger, Stan D. 1993. “Biochemical Limitations to Carbon Assimilation in C3 Plants—a Retrospective Analysis of the a-Ci Curves from 109 Species.” Journal of Experimental Botany 44 (262): 907–20.\n\n\nYin, Xinyou, P C Struik, Pascual Romero, Jeremy Harbinson, Jochem B Evers, Peter E L Van Der Putten, and J Vos. 2009. “Using Combined Measurements of Gas Exchange and Chlorophyll Fluorescence to Estimate Parameters of a Biochemical C3 Photosynthesis Model: A Critical Appraisal and a New Integrated Approach Applied to Leaves in a Wheat (Triticum Aestivum) Canopy.” Plant Cell and Environment 32 (5): 448–64."
  },
  {
    "objectID": "aci.html#sec-fitaci",
    "href": "aci.html#sec-fitaci",
    "title": "14  Aci 曲线拟合相关",
    "section": "14.1 plantecophys 拟合",
    "text": "14.1 plantecophys 拟合\nplantecophys (sec. 3) 里拟合二氧化碳的函数本质上只有一个 fitaci，只不过为了一次拟合多个处理的数据，在其基础上将 fitaci 扩展为了 fitacis。\n\n14.1.1 fitaci 函数介绍\nfitaci 的用法如下1：\n\n\nCode\nfitaci(data, varnames = list(ALEAF = \"Photo\", \n  Tleaf = \"Tleaf\", Ci = \"Ci\", PPFD = \"PARi\", \n  Rd = \"Rd\"), Tcorrect = TRUE, Patm = 100, \n  citransition = NULL, quiet = FALSE, \n  startValgrid = TRUE, fitmethod = \n  c(\"default\", \"bilinear\", \"onepoint\"), \n  algorithm = \"default\", fitTPU = FALSE, \n  useRd = FALSE, PPFD = NULL, Tleaf = NULL, \n  alpha = 0.24, theta = 0.85, gmeso = NULL, \n  EaV = 82620.87, EdVC = 0, delsC = 645.1013,\n  EaJ = 39676.89, EdVJ = 2e+05, \n  delsJ = 641.3615, GammaStar = NULL, \n  Km = NULL, id = NULL, ...)\n\n## S3 method for class 'acifit'\nplot(x, what = c(\"data\", \"model\", \"none\"),\n     xlim = NULL, ylim = NULL, whichA = c(\n       \"Ac\", \"Aj\", \"Amin\", \"Ap\"), add = FALSE,\npch = 19, addzeroline = TRUE, addlegend = \n  !add, legendbty = \"o\",transitionpoint = TRUE, \nlinecols = c(\"black\", \"blue\", \"red\"), lwd = c(1,\n2), ...)\n\n\n主要参数注释：\n\ndata：需要分析的数据，必须为 .data.frame。 格式。\nvarnames：数据的表头，此处函数默认的表头为 LI-6400 的表头，分析 LI-6400 的数据时可以不用填写，直接使用默认的参数即可2。\nTcorrect：如果为 TRUE，那么 J_{max}、V_{cmax} 的结果为温度校正结果，若 Tcorrect = FALSE，则为测量温度下的结果。\nPatm：为外界大气压。\ncitransition：参见详，若提供该选项，则 J_{max}、V_{cmax} 的区域则分别拟合3。\nfitmethod：参见详解。\nfitTPU：是否拟合 TPU 限制，默认为 FALSE，参见详解。\nx：对于plot.acifit，x 为fitaci返回的对象，简单理解为 将 fitaci 函数拟合结果赋值给一个变量，此处plot函数实际上为plot.acifit。\nwhat：利用基础做图工具，默认为对数据和模型进行作图。\nwhichA：默认为对所有的光合速率进行作图（Aj=Jmax-limited (蓝色), Ac=Vcmax- limited (红色), Hyperbolic minimum (黑色)), TPU-limited rate (Ap, 如果模型有计算结果）。\n\n其余参数请参考 FvCB 模型 Farquhar, Caemmerer, and Berry (1980) 及查看 plantecophys 的帮助文档。\n\nfitaci函数详解\n\n默认为非线性拟合，详见 Duursma (2015)。\nbilinear 方法使用两次线性拟合方法首先拟合 V_{cmax} 和 R_{d}，然后再拟合J_{max}，过渡点的选择为对所有数据拟合最适的点，类似 Gu et al. (2010) 的方法。该方法的优势时无论如何，都会返回拟合结果，尤其是非线性拟合失败时使用该方法，但若默认方法失败时，需首先检查是否数据存在问题。两种拟合方法的结果有轻微的差别4。\nonepoint 参考 De Kauwe et al. (2016)。该方法不同于前面所提到的 ACi 曲线测量，有一系列的前提，但测量比较快。\ncitransition 使用时，数据将被区分为 V_{cmax} 限制（Ci < citransition ）区域，以及 J_{max} 限制 (Ci > citransition) 区域。\nfitTPU：如果要计算TPU，要设置 fitTPU = TRUE，并且 fittingmethod = “bilinear”。但需要注意，当 TPU 被计算时，没有 J_{max} 限制的点的存在是可能的。TPU限制的发生是在A值不随 CO_{2} 的增加而增加时发生的，因此计算 TPU 是否有返回值，取决于测量数据是否有此情况出现。\n\n\n\n\n14.1.2 fitaci 的使用\n首先安装 plantecophys:\n\n\nCode\ninstall.packages(\"plantecophys\", dependencies = TRUE)\n\n\n如果使用 LI-6800，为方便起见，可以使用我修改后的 plantecophys2:\n\n\nCode\nremotes::install_git(\"https://gitee.com/zhu_jie_dong/plantecophys2\")\n\n\n我们先看一个使用 LI-6400 的例子：\n\n\nCode\nlibrary(\"plantecophys\")\n\n# 利用read.csv读取数据文件，\n# 我的路径为当前工作路径的data文件夹内\naci <- read.csv(\"data/aci.csv\")\n\n# 防止可能出现的NA值\naci <- subset(aci, Obs > 0)\n\n# 不修改默认参数对数据进行拟合\nacifit <- fitaci(aci)\n\n# 查看拟合结果\nsummary(acifit)\n\n\nResult of fitaci.\n\nData and predictions:\n           Ci      Ameas     Amodel         Ac        Aj   Ap       Rd VPD\n5    53.47985 -0.6575974 -0.5146882 -0.3552036  0.000000 1000 0.159449 1.5\n4    85.82530  1.7971569  1.9292621  2.0888575  5.068534 1000 0.159449 1.5\n3   150.67623  6.4525814  6.4176037  6.5777528 12.755502 1000 0.159449 1.5\n2   217.32002 10.6562220 10.5354626 10.6965875 17.519644 1000 0.159449 1.5\n1   286.39751 14.2848912 14.3365887 14.4993980 20.749310 1000 0.159449 1.5\n6   292.56161 15.4296572 14.9749157 15.1383702 20.852616 1000 0.159449 1.5\n7   292.96456 15.7134791 15.0564801 15.2200522 20.831098 1000 0.159449 1.5\n8   450.64285 22.2659015 23.0115187 23.1975997 25.186939 3000 0.159449 1.5\n9   622.03873 26.5135040 27.6485003 30.4281393 27.837462 3000 0.159449 1.5\n10  992.08737 30.3898585 30.6300461 42.3998173 30.797660 3000 0.159449 1.5\n11 1558.96968 33.6267056 32.6638021 54.9948264 32.828110 3000 0.159449 1.5\n12 1756.16396 33.3152783 33.0981490 58.5844507 33.261965 3000 0.159449 1.5\n      Tleaf         Cc     PPFD Patm Ci_original\n5  31.12332   53.47934 1800.490  100    53.47985\n4  30.99093   85.82723 1800.558  100    85.82530\n3  30.82872  150.68265 1800.140  100   150.67623\n2  30.63983  217.33057 1800.524  100   217.32002\n1  30.46890  286.41186 1800.701  100   286.39751\n6  31.26338  292.57660 1799.923  100   292.56161\n7  31.41866  292.97963 1799.975  100   292.96456\n8  31.54122  450.66588 1799.826  100   450.64285\n9  31.63493  622.06640 1799.578  100   622.03873\n10 31.73910  992.11803 1800.055  100   992.08737\n11 31.86938 1559.00238 1800.022  100  1558.96968\n12 31.96654 1756.19709 1799.585  100  1756.16396\n\nRoot mean squared error:  1.889701 \n\nEstimated parameters:\n        Estimate Std. Error\nVcmax  49.261616  1.5152405\nJmax  126.620537  2.2816267\nRd      0.159449  0.4001302\nNote: Vcmax, Jmax are at 25C, Rd is at measurement T.\n\nCurve was fit using method:  default \n\nParameter settings:\nPatm = 100\n alpha = 0.24\n theta = 0.85\n EaV = 82620.87\n EdVC = 0\n delsC = 645.1013\n EaJ = 39676.89\n EdVJ = 2e+05\n delsJ = 641.3615\n\nEstimated from Tleaf (shown at mean Tleaf):\nGammaStar =  58.61138 \nKm =  1223.279 \n\n\nCode\nacifit_linear <- fitaci(aci,  fitmethod = \"bilinear\", quiet = TRUE)\nsummary(acifit_linear)\n\n\nResult of fitaci.\n\nData and predictions:\n           Ci      Ameas     Amodel         Ac        Aj   Ap        Rd VPD\n5    53.47985 -0.6575974 -0.7389447 -0.3560483  0.000000 1000 0.3828608 1.5\n4    85.82530  1.7971569  1.7108198  2.0938246  5.138366 1000 0.3828608 1.5\n3   150.67623  6.4525814  6.2098476  6.5933940 12.931333 1000 0.3828608 1.5\n2   217.32002 10.6562220 10.3375299 10.7220229 17.761317 1000 0.3828608 1.5\n1   286.39751 14.2848912 14.1477696 14.5338762 21.035722 1000 0.3828608 1.5\n6   292.56161 15.4296572 14.7876514 15.1743678 21.139657 1000 0.3828608 1.5\n7   292.96456 15.7134791 14.8694171 15.2562440 21.117718 1000 0.3828608 1.5\n8   450.64285 22.2659015 22.8464806 23.2527613 25.533374 3000 0.3828608 1.5\n9   622.03873 26.5135040 27.8030690 30.5004944 28.220254 3000 0.3828608 1.5\n10  992.08737 30.3898585 30.8295808 42.5006398 31.221072 3000 0.3828608 1.5\n11 1558.96968 33.6267056 32.8913778 55.1255986 33.279305 3000 0.3828608 1.5\n12 1756.16396 33.3152783 33.3316070 58.7237587 33.719013 3000 0.3828608 1.5\n      Tleaf         Cc     PPFD Patm Ci_original\n5  31.12332   53.47911 1800.490  100    53.47985\n4  30.99093   85.82701 1800.558  100    85.82530\n3  30.82872  150.68244 1800.140  100   150.67623\n2  30.63983  217.33037 1800.524  100   217.32002\n1  30.46890  286.41167 1800.701  100   286.39751\n6  31.26338  292.57641 1799.923  100   292.56161\n7  31.41866  292.97944 1799.975  100   292.96456\n8  31.54122  450.66572 1799.826  100   450.64285\n9  31.63493  622.06656 1799.578  100   622.03873\n10 31.73910  992.11823 1800.055  100   992.08737\n11 31.86938 1559.00260 1800.022  100  1558.96968\n12 31.96654 1756.19733 1799.585  100  1756.16396\n\nRoot mean squared error:  2.013045 \n\nEstimated parameters:\n         Estimate Std. Error\nVcmax  49.3787547  3.4815555\nJmax  128.5546403         NA\nRd      0.3828608  0.4697008\nNote: Vcmax, Jmax are at 25C, Rd is at measurement T.\n\nCurve was fit using method:  bilinear \n\nParameter settings:\nPatm = 100\n alpha = 0.24\n theta = 0.85\n EaV = 82620.87\n EdVC = 0\n delsC = 645.1013\n EaJ = 39676.89\n EdVJ = 2e+05\n delsJ = 641.3615\n\nEstimated from Tleaf (shown at mean Tleaf):\nGammaStar =  58.61138 \nKm =  1223.279 \n\n\nCode\n# 仅查看拟合参数, 比较两种拟合参数的差异\ncoef(acifit_linear)\n\n\n      Vcmax        Jmax          Rd \n 49.3787547 128.5546403   0.3828608 \n\n\nCode\ncoef(acifit)\n\n\n     Vcmax       Jmax         Rd \n 49.261616 126.620537   0.159449 \n\n\n需要注意，plantecophys 的 Rd 不需要带负号，即上面的仅仅表示呼吸速率的值。\n\n\nCode\n# 设置作图参数，图形的边距及分为1行两列输出图形\nop <- par(no.readonly = TRUE)\npar(mar = c(4.5, 4.5, 2, 2))\npar(mfrow = c(1, 2))\n# 对两种拟合参数的结果作图，查看模型拟合是否正常\nplot(acifit, addlegend = FALSE)\nlegend(x = 500, y = 10, \n       legend = c(expression(paste(A[c])), \n                expression(paste(A[j])),\n                \"Limiting rate\"),\n       lty = c(1, 1, 1),\n       col =c(\"red\", \"blue\", \"black\") \n         )\nmtext(\" fitmethod = 'default' \")\n\nplot(acifit_linear, addlegend = FALSE)\nlegend(x = 500, y = 10, \n       legend = c(expression(paste(A[c])), \n                  expression(paste(A[j])),\n                  \"Limiting rate\"),\n       lty = c(1, 1, 1),\n       col =c(\"red\", \"blue\", \"black\") \n)\nmtext(\"fitmethod = 'bilinear' \")\npar <- op\n\n\n\n\n\nFigure 14.1: fitmethod 为非线性和线性拟合的差异\n\n\n\n\n如果需要导出数据做他用，使用 Rstudio 的话，其自动补全的功能在选择数据上更方便 (即输入拟合的名称 + $ 符号后，自动补全会弹出提示)。例如导出预测值和系数分别使用如下方式：\n\n\nCode\n# 将模型拟合结果中df（即计算数据）赋给predictaci，\n# 并用write.csv导出\npredictaci <- acifit$df\nwrite.csv(acifit$df, file = \"acipredict.csv\")\nwrite.csv(coef(acifit), file = \"coefaci.csv\")\n\n\n需要注意的是，因为非线性拟合需要一个初值，因此，使用默认方式（非线性拟合）的时候，会存在可能的拟合失败现象，此时可以使用 fitmethod = \"bilinear\"，二者结果略有差别。\n\n一次拟合多条 ACi 曲线\nfitacis 函数实际上是 fitaci 函数的扩展，方便一次拟合多条曲线5。函数的参数如下：\n\n\nCode\nfitacis(data, group, fitmethod = c(\"default\", \n        \"bilinear\"),progressbar = TRUE, \n        quiet = FALSE, id = NULL, ...)\n\n## S3 method for class 'acifits'\nplot(x, how = c(\"manyplots\", \"oneplot\"), \n     highlight = NULL, ylim = NULL, \n     xlim = NULL, add = FALSE, what = c(\"model\",\n     \"data\", \"none\"), ...)\n\n\n主要参数详解：\n实际上 fitacis 与 fitaci 模型算法完全一致，只不过增加了一个 group 参数，用于区分不同测量的数据，具体请参考举例内容。\n\n\nfitacis 函数应用举例\n下文代码根据 plantecophys 中的示例代码修改，进行演示，原代码请参考其帮助文档。\n\n\nCode\nlibrary(plantecophys)\n# 只提取前10个不同测量的数据，节省时间进行举例\nmanyacidat2 <- droplevels(manyacidat[manyacidat$Curve %in% \n                                       levels(manyacidat$Curve)[1:10],])\n\n# 对多条曲线进行拟合，使用bilinear方法，\n# 仅仅因为其比非线性拟合节省时间\nfits <- fitacis(manyacidat2, group = \"Curve\", fitmethod=\"bilinear\", quiet = TRUE)\n\n# 拟合结果为list，我们可以只提取第一个的拟合结果\nfits[[1]]\n\n\nResult of fitaci.\n\nData and predictions:\n           Ci      Ameas     Amodel         Ac        Aj   Ap        Rd VPD\n2    53.23129 -0.4401082  0.1014381  0.9601119  2.548123 1000 0.8586158 1.5\n3    79.47367  2.4824630  2.1937702  3.0526198  7.036734 1000 0.8586158 1.5\n4   116.74688  5.4531712  4.9419337  5.8011511 11.392394 1000 0.8586158 1.5\n5   188.00801  9.7099879  9.5705964 10.4310194 16.447715 1000 0.8586158 1.5\n6   278.44662 14.8225766 14.4261545 15.2897486 19.977583 1000 0.8586158 1.5\n7   343.03259 17.7982155 17.4602014 18.3289218 21.639847 1000 0.8586158 1.5\n1   344.72152 17.9244012 17.3165146 18.1849643 21.534276 1000 0.8586158 1.5\n14  344.74839 16.7933747 17.6853306 18.5545917 21.774261 1000 0.8586158 1.5\n8   588.08078 23.8925326 24.1309683 27.0327638 25.020148 3000 0.8586158 1.5\n9   833.25547 26.5674409 25.7783026 33.0856065 26.647921 3000 0.8586158 1.5\n10 1136.99222 25.9787890 26.8108335 38.1296944 27.676768 3000 0.8586158 1.5\n11 1436.86370 26.6110657 27.5409345 42.0628463 28.405453 3000 0.8586158 1.5\n12 1536.46772 27.4018784 27.7965881 43.3773689 28.660781 3000 0.8586158 1.5\n13 1731.76400 28.6752069 28.0952804 45.2475932 28.959041 3000 0.8586158 1.5\n      Tleaf         Cc     PPFD Patm Ci_original\n2  24.55873   53.23139 1799.959  100    53.23129\n3  24.58292   79.47586 1799.590  100    79.47367\n4  24.71278  116.75183 1799.819  100   116.74688\n5  24.73687  188.01759 1800.371  100   188.00801\n6  24.67508  278.46106 1800.233  100   278.44662\n7  24.76596  343.05006 1799.575  100   343.03259\n1  24.51593  344.73886 1800.356  100   344.72152\n14 24.94098  344.76609 1799.964  100   344.74839\n8  24.83785  588.10494 1799.477  100   588.08078\n9  24.91185  833.28127 1799.969  100   833.25547\n10 24.87314 1137.01906 1799.525  100  1136.99222\n11 24.95914 1436.89126 1799.615  100  1436.86370\n12 25.04542 1536.49554 1799.784  100  1536.46772\n13 25.07566 1731.79212 1799.160  100  1731.76400\n\nRoot mean squared error:  2.196037 \n\nEstimated parameters:\n         Estimate Std. Error\nVcmax  65.0009909  1.3720635\nJmax  131.7980133         NA\nRd      0.8586158  0.2876248\nNote: Vcmax, Jmax are at 25C, Rd is at measurement T.\n\nCurve was fit using method:  bilinear \n\nParameter settings:\nPatm = 100\n alpha = 0.24\n theta = 0.85\n EaV = 82620.87\n EdVC = 0\n delsC = 645.1013\n EaJ = 39676.89\n EdVJ = 2e+05\n delsJ = 641.3615\n\nEstimated from Tleaf (shown at mean Tleaf):\nGammaStar =  42.31453 \nKm =  698.2084 \n\n\nCode\n# 使用sapply提取拟合结果的RMSE(均方根误差)\nrmses <- sapply(fits, \"[[\", \"RMSE\")\nplot(rmses, type='h', ylab=\"RMSE\", xlab=\"Curve nr\")\n# 对最差的拟合结果进行作图\nplot(fits[[which.max(rmses)]])\n\n\n\n\n\nFigure 14.2: fitacis作图结果\n\n\n\n\n\n\n\nFigure 14.3: fitacis作图结果\n\n\n\n\n可以看出，fitaci 和 fitacis 用法基本一致，各行代码均已经注释，更详细用法请参函数考帮助。\n\n\n\n14.1.3 fitmethod = “onepoint” 介绍\nDe Kauwe et al. (2016) 发表了关于 one point 方法计算 V_{cmax} 和 J_{max} 的文章，在 2017 年 11 月的更新中，plantecophys 将对应的 python 代码移植到了 plantecophys， 该方法并非使用一个点计算 V_{cmax} 和 J_{max}，而是对数据集中的每一个点的值进行估计，使用的方法为逆向了光合作用方程。输出则是将原始数据中加入了 V_{cmax} 和 J_{max} 的计算结果，当然一如既往的可以使用温度校准的方法。为提升测量的准确性，最佳方案是有测量的 Rd 值。也就是 useRd 被默认启用。它的假设是在外部环境 CO2 浓度和饱和光下。\n基于上面的描述，他们的模型如下：\n\n\\hat{V}_{cmax} = (A_{sat} + R_{day}) \\frac{C_i + K_m}{C_i - \\Gamma^*} \n \\qquad(14.1)\n其中：Km 为米氏常数，其计算为：\n$$ K_m = K_c (1 + )\n$$ {#eq-km}\n未知参数均由文献中的方法进行计算，具体可参考 De Kauwe et al. (2016) 的原文,但上述方法的缺陷是还需要 Rday，因此作者使用了1.5% Vcmax 作为 Rday，因此公式 ?eq-inversea 可变换为：\n\n\\hat{V}_{cmax} = A_{sat} (\\frac{C_i + K_m}{C_i - \\Gamma^*} - 0.015)\n \\qquad(14.2)\n另一个重要的模型的假设为 Jmax 与 Vcmax 是成比例的， Jmax 的计算是通过 Ci transition point 来实现的，文章中的比值均值为 1.9，范围在 1.68 ~ 2.14 之间。\n\n\n14.1.4 使用 ‘onepoint’ 单独计算 Vcmax 和 Jmax\n目前我手头没有相应数据，仅有使用 LI-6400 测试 auto log 2 时的一个数据，我们用这个来示范该方法的使用：\n\n\nCode\none_data <- read.csv(\"data/onepoint.csv\")\n\n\n\n\n\n\nTable 14.1: onepoint 使用的数据 \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nObs\nHHMMSS\nFTime\nEBal.\nPhoto\nCond\nCi\nTrmmol\nVpdL\nCTleaf\nArea\nBLC_1\nStmRat\nBLCond\nTair\nTleaf\nTBlk\nCO2R\nCO2S\nH2OR\nH2OS\nRH_R\nRH_S\nFlow\nPARi\nPARo\nPress\nCsMch\nHsMch\nCsMchSD\nHsMchSD\nCrMchSD\nHrMchSD\nStableF\nBLCslope\nBLCoffst\nf_parin\nf_parout\nalphaK\nStatus\nfda\nTrans\nTair_K\nTwall_K\nR.W.m2.\nTl.Ta\nSVTleaf\nh2o_i\nh20diff\nCTair\nSVTair\nCndTotal\nvp_kPa\nVpdA\nCndCO2\nCi_Pa\nCi.Ca\nRHsfc\nC2sfc\nAHs.Cs\n\n\n\n\n1\n14:12:43\n347.0\n0\n10.519216\n0.1369336\n263.0905\n1.963046\n1.445782\n25.89411\n6\n1.42\n1\n2.84\n25.86572\n25.89411\n25.86697\n412.5374\n398.9832\n16.98853\n19.29724\n50.16200\n56.97891\n500.3231\n1198.761\n7.497697\n98.84273\n2.011996\n-0.3824501\n0.1618589\n0.0039255\n0.1864786\n0.0030409\n1.0000000\n-0.2195652\n2.737392\n1\n0\n0.16\n111115\n0.8338718\n0.0019630\n299.0441\n299.0157\n191.8018\n1.191025\n3.353173\n33.92433\n14.62709\n25.87991\n3.350355\n0.1306349\n1.907392\n1.442964\n0.0821903\n26.00458\n0.6594024\n57.74196\n393.9829\n0.0154169\n\n\n2\n14:13:04\n369.0\n0\n10.361122\n0.1357092\n264.1135\n1.946022\n1.445559\n25.89542\n6\n1.42\n1\n2.84\n25.86854\n25.89542\n25.86977\n412.5459\n399.1890\n17.01363\n19.30231\n50.22723\n56.98380\n500.3223\n1198.748\n7.486364\n98.84175\n2.018435\n-0.3787848\n0.2174792\n0.0025482\n0.2455426\n0.0025012\n1.0000000\n-0.2195652\n2.737392\n1\n0\n0.16\n111115\n0.8338705\n0.0019460\n299.0454\n299.0185\n191.7997\n1.199722\n3.353433\n33.92729\n14.62498\n25.88198\n3.350765\n0.1295200\n1.907874\n1.442891\n0.0814842\n26.10544\n0.6616252\n57.73418\n394.2638\n0.0151724\n\n\n3\n14:13:25\n373.0\n0\n10.207166\n0.1342114\n264.8348\n1.925734\n1.445717\n25.89660\n6\n1.42\n1\n2.84\n25.87186\n25.89660\n25.87317\n412.5393\n399.3762\n17.03833\n19.30316\n50.29006\n56.97489\n500.3188\n1198.737\n7.489428\n98.84142\n2.018435\n-0.3787848\n0.2174792\n0.0025482\n0.2455426\n0.0025012\n1.0000000\n-0.2195652\n2.737392\n1\n0\n0.16\n111115\n0.8338647\n0.0019257\n299.0466\n299.0219\n191.7980\n1.210137\n3.353668\n33.92979\n14.62663\n25.88423\n3.351212\n0.1281551\n1.907951\n1.443261\n0.0806199\n26.17665\n0.6631213\n57.71117\n394.5242\n0.0149311\n\n\n4\n14:13:41\n389.5\n0\n9.547416\n0.1281947\n269.6337\n1.854272\n1.454248\n25.94020\n6\n1.42\n1\n2.84\n25.91845\n25.94020\n25.92104\n413.8090\n401.4666\n17.12559\n19.30638\n50.40359\n56.82203\n500.3162\n1199.245\n7.449210\n98.83208\n2.018435\n-0.3787848\n0.2174792\n0.0025482\n0.2455426\n0.0025012\n1.0000000\n-0.2195652\n2.737392\n1\n0\n0.16\n111115\n0.8338604\n0.0018543\n299.0902\n299.0684\n191.8792\n1.247158\n3.362337\n34.02071\n14.71433\n25.92933\n3.360173\n0.1226580\n1.908089\n1.452084\n0.0771402\n26.64846\n0.6716216\n57.48324\n396.9282\n0.0138266\n\n\n5\n14:16:16\n540.0\n0\n10.288968\n0.1376602\n267.9198\n2.009217\n1.471788\n26.01813\n6\n1.42\n1\n2.84\n26.01478\n26.01813\n26.02164\n413.9044\n400.5999\n16.92567\n19.28878\n49.53554\n56.44850\n500.3043\n1200.785\n7.497018\n98.81870\n2.018435\n-0.3787848\n0.2174792\n0.0025482\n0.2455426\n0.0025012\n0.6666667\n-0.2195652\n2.737392\n1\n0\n0.16\n111115\n0.8338405\n0.0020092\n299.1681\n299.1648\n192.1257\n1.174669\n3.377880\n34.18260\n14.89382\n26.01646\n3.377546\n0.1312960\n1.906093\n1.471453\n0.0826090\n26.47549\n0.6687965\n57.30143\n395.7090\n0.0148991\n\n\n6\n14:16:32\n555.5\n0\n10.178603\n0.1381995\n269.5898\n2.016100\n1.471138\n26.01657\n6\n1.42\n1\n2.84\n26.02212\n26.01657\n26.02939\n413.6639\n400.4885\n16.92345\n19.29468\n49.49181\n56.42595\n500.2979\n1200.879\n7.569045\n98.80596\n2.018435\n-0.3787848\n0.2174792\n0.0025482\n0.2455426\n0.0025012\n0.6666667\n-0.2195652\n2.737392\n1\n0\n0.16\n111115\n0.8338298\n0.0020161\n299.1666\n299.1721\n192.1406\n1.172561\n3.377567\n34.18384\n14.88916\n26.01934\n3.378122\n0.1317865\n1.906429\n1.471693\n0.0829197\n26.63708\n0.6731525\n57.32389\n395.6501\n0.0147473\n\n\n\n\n\n\ntbl. 14.1 数据为同一个叶片连续记录数据，故所有的光合速率十分接近。\n使用方法：\n\n\nCode\nlibrary(plantecophys)\n\none_data <- subset(one_data, Obs > 0)\none_data$Rd <- 0.5\naci_fit <- fitaci(one_data, fitmethod = \"onepoint\")\n\n\n\n\n\n\nTable 14.2: onepoint 法计算的结果 \n\n\naci_fit.Photo\naci_fit.Vcmax\naci_fit.Jmax\n\n\n\n\n10.519216\n47.06893\n71.73759\n\n\n10.361122\n46.22091\n70.51059\n\n\n10.207166\n45.44617\n69.35838\n\n\n9.547416\n41.86217\n64.24400\n\n\n10.288968\n45.09335\n69.36954\n\n\n10.178603\n44.37360\n68.41628\n\n\n10.348184\n45.61262\n69.98563\n\n\n10.088908\n43.96870\n67.78267\n\n\n10.382970\n45.83416\n70.28272\n\n\n10.314660\n45.32629\n69.64235\n\n\n10.249137\n44.86035\n69.04578\n\n\n10.263942\n45.03290\n69.23316\n\n\n10.276372\n45.06777\n69.30476\n\n\n10.310315\n45.41163\n69.69375\n\n\n10.257607\n45.10509\n69.26665\n\n\n10.268318\n45.10636\n69.30563\n\n\n10.249136\n45.08506\n69.22086\n\n\n10.286432\n45.23213\n69.46825\n\n\n10.304019\n45.40981\n69.66987\n\n\n10.232778\n44.93236\n69.04323\n\n\n10.211444\n44.87301\n68.92133\n\n\n10.261779\n45.27150\n69.41197\n\n\n10.372243\n45.88799\n70.28733\n\n\n9.865629\n42.90010\n66.16012\n\n\n10.494170\n46.74011\n71.39036\n\n\n10.218001\n45.02652\n69.06497\n\n\n10.059445\n44.09354\n67.77443\n\n\n10.428858\n46.47593\n70.95132\n\n\n10.250793\n45.30113\n69.39661\n\n\n9.912939\n43.36453\n66.68832\n\n\n10.199344\n45.25700\n69.18076\n\n\n10.391926\n46.39390\n70.75653\n\n\n10.160686\n44.88657\n68.75316\n\n\n10.024682\n44.18376\n67.72287\n\n\n10.129775\n44.92784\n68.67708\n\n\n10.141083\n45.00936\n68.78099\n\n\n10.001353\n44.25706\n67.69872\n\n\n10.292306\n45.99487\n70.09022\n\n\n10.107537\n44.81090\n68.50677\n\n\n10.045704\n44.52225\n68.06286\n\n\n10.020921\n44.45621\n67.92429\n\n\n10.110870\n45.11312\n68.75747\n\n\n10.002926\n44.42129\n67.83392\n\n\n10.084427\n45.05038\n68.61609\n\n\n9.997523\n44.53516\n67.90526\n\n\n10.031004\n44.79683\n68.22931\n\n\n10.067866\n45.01510\n68.53037\n\n\n9.913409\n44.05520\n67.23265\n\n\n10.021746\n44.87409\n68.25803\n\n\n9.913314\n44.20530\n67.35073\n\n\n9.993697\n44.80203\n68.10315\n\n\n9.851695\n44.01827\n66.98918\n\n\n9.736275\n43.13847\n65.89470\n\n\n9.797319\n43.98036\n66.76973\n\n\n9.626554\n42.91998\n65.34117\n\n\n9.471773\n41.68336\n63.83331\n\n\n9.646700\n42.87917\n65.37916\n\n\n9.644842\n42.99673\n65.46524\n\n\n9.758413\n43.70607\n66.41972\n\n\n9.553852\n42.50445\n64.76295\n\n\n9.662671\n43.28157\n65.75264\n\n\n9.563656\n42.70328\n64.95411\n\n\n9.672595\n43.52788\n65.98331\n\n\n9.548987\n42.64583\n64.85665\n\n\n9.597028\n43.06762\n65.35629\n\n\n9.564234\n42.91240\n65.11967\n\n\n9.528271\n42.77665\n64.88887\n\n\n9.516492\n42.83815\n64.89806\n\n\n9.473123\n42.62617\n64.58091\n\n\n9.448475\n42.51675\n64.41002\n\n\n9.456234\n42.55351\n64.46375\n\n\n9.480095\n42.94755\n64.86062\n\n\n9.363030\n42.21889\n63.88107\n\n\n9.311755\n41.93995\n63.48342\n\n\n9.459983\n43.05099\n64.87112\n\n\n9.483853\n43.30531\n65.15723\n\n\n9.027537\n40.30433\n61.22108\n\n\n9.476729\n43.44072\n65.23563\n\n\n9.280183\n42.12853\n63.52291\n\n\n9.261344\n42.17840\n63.49744\n\n\n9.334307\n42.85683\n64.28533\n\n\n9.051123\n41.06857\n61.90318\n\n\n9.270810\n42.51712\n63.79523\n\n\n9.330762\n43.01265\n64.39291\n\n\n9.218163\n42.26923\n63.41804\n\n\n9.085934\n41.60645\n62.44411\n\n\n9.083060\n41.74496\n62.54482\n\n\n9.132510\n42.02581\n62.93301\n\n\n9.131158\n42.10676\n62.99170\n\n\n9.145548\n42.35821\n63.24067\n\n\n9.059605\n41.85986\n62.55140\n\n\n9.091451\n42.25809\n62.97554\n\n\n9.070366\n42.19632\n62.85631\n\n\n8.943521\n41.35936\n61.76031\n\n\n8.975535\n41.65581\n62.10145\n\n\n8.973756\n41.81212\n62.22232\n\n\n8.962861\n41.76093\n62.14239\n\n\n8.904978\n41.49087\n61.73147\n\n\n8.918707\n41.60684\n61.86895\n\n\n8.968677\n42.07851\n62.41156\n\n\n8.759890\n40.74396\n60.64875\n\n\n8.821386\n41.29744\n61.29504\n\n\n8.896446\n41.92053\n62.04190\n\n\n8.847126\n41.57371\n61.60003\n\n\n8.841565\n41.74028\n61.71268\n\n\n8.832967\n41.80729\n61.73844\n\n\n8.847937\n41.85192\n61.82163\n\n\n8.728196\n40.98872\n60.72970\n\n\n8.789579\n41.72098\n61.52023\n\n\n8.720803\n41.30092\n60.95505\n\n\n8.793964\n41.82089\n61.60873\n\n\n8.740789\n41.45169\n61.13431\n\n\n8.912781\n42.54266\n62.58591\n\n\n8.641433\n41.15567\n60.56410\n\n\n8.716064\n41.68926\n61.24072\n\n\n8.826706\n42.15912\n61.99019\n\n\n8.835380\n42.38866\n62.20246\n\n\n8.795586\n42.17302\n61.89721\n\n\n8.791231\n42.11367\n61.83223\n\n\n\n\n\n\n需要注意，为保证结果的精确，如果不设定 Rd, 也即文献中的 Rday， 模型是无法计算的，因此 tbl. 14.2 的示例中虚构了一个。\n\n\n14.1.5 findCiTransition 函数\n对于计算不同 ACi 限制阶段过渡点的方式，可以使用 CiTransition 的函数，第一点为 Ac ~ Aj，第二点为 Aj ~ Ap，并且仅在计算 TPU 的前提下才会有第二点出现。\n\n\nCode\nfindCiTransition(object, ...)\n\n\n参数使用，object 为 fitaci 函数对象，或者整个的 Photosyn 函数。 … 为使用 Photosyn 时可传递的参数。默认的 fitaci 对象作图会标记该点，如图 fig. 14.1。 数据的计算也非常简单：\n\n\nCode\nfindCiTransition(acifit)\n\n\n   Ac_Aj    Aj_Ap \n538.0701       NA"
  },
  {
    "objectID": "aci.html#sec-photosynthesis-aci",
    "href": "aci.html#sec-photosynthesis-aci",
    "title": "14  Aci 曲线拟合相关",
    "section": "14.2 photosynthesis 拟合",
    "text": "14.2 photosynthesis 拟合\n相比plantecophys， photosynthesis (sec. 3) 做了一些改进，但基本使用非常相似。我们使用和 plantecophys 相同的数据集进行演示。\n这里官方文档说是温度使用的摄氏度，但是 vignette 使用的是 K，经过验证，应该是 K 才能拟合。。\n\n\nCode\nlibrary(photosynthesis)\n\naci$TLEAF <- aci$Tleaf + 273.15\nfit <-\n  fit_aci_response(aci,\n                   varnames = list(\n                     A_net = \"Photo\",\n                     T_leaf = \"TLEAF\",\n                     C_i = \"Ci\",\n                     PPFD = \"PARi\"\n                   ))\n\n\n我们先观察拟合结果：\n\n\nCode\nreshape2::melt(fit[[1]])\n\n\n\n\n\n\nTable 14.3: 使用 photosynthesis 来拟合 ACi 曲线的结果 \n\n\nvariable\nvalue\n\n\n\n\nNum\n0.0000000\n\n\nV_cmax\n98.7962878\n\n\nV_cmax_se\n2.1338711\n\n\nJ_max\n157.4297453\n\n\nJ\n146.2105728\n\n\nJ_se\n0.5587627\n\n\nV_TPU\n1000.0000000\n\n\nV_TPU_se\nNA\n\n\nR_d\n-0.1030324\n\n\nR_d_se\n0.2816426\n\n\ncost\n1.9502380\n\n\ncitransition1\n536.3407882\n\n\ncitransition2\n1757.1639630\n\n\nV_cmax_pts\n8.0000000\n\n\nJ_max_pts\n4.0000000\n\n\nV_TPU_pts\n0.0000000\n\n\nalpha\n0.2400000\n\n\nalpha_g\n0.0000000\n\n\ngamma_star25\n42.7500000\n\n\nEa_gamma_star\n37830.0000000\n\n\nK_M25\n718.4000000\n\n\nEa_K_M\n65508.2800000\n\n\ng_mc25\n0.0870100\n\n\nEa_g_mc\n0.0000000\n\n\nOconc\n21.0000000\n\n\ntheta_J\n0.8500000\n\n\n\n\n\n\n上面使用 melt 纯粹是因为横排数据太长，并非必须。其实也能看出来它拟合 ACi 和非直角双曲线光响应模型是一样的展示结果的方式，图形查看为：\n\n\nCode\nfit[[2]]\n\n\n\n\n\n使用 photosynthesis 来拟合 ACi 曲线的图形查看\n\n\n\n\n此外，它也有 fit_many 函数用于多组数据的拟合，这个没太大变化，主要是注意分组参数 group，以及使用函数的参数 funct 为 fit_aci_response，此处不再展开介绍。\n\n\n\n\n\n\n关于 LI-6800 数据分析示例\n\n\n\n为减少单个单元的代码量，同时也为了方便，将 LI-6800 数据分析代码演示放在了 RACiR 单元内演示。\n\n\n\n\n\n\nDe Kauwe, Martin G, Yan Shih Lin, Ian J Wright, Belinda E Medlyn, Kristine Y Crous, David S Ellsworth, Vincent Maire, I Colin Prentice, Owen K Atkin, and Alistair Rogers. 2016. “A Test of the One Point Method for Estimating Maximum Carboxlation Capacity from Field Measured, Light Saturated Photosynthesis.” New Phytologist 210 (3): 1130.\n\n\nDuursma, Remko A. 2015. “Plantecophys-an r Package for Analysing and Modelling Leaf Gas Exchange Data.” Plos One 10 (11): e0143346.\n\n\nFarquhar, G. D., S. Von Caemmerer, and J. A. Berry. 1980. “A Biochemical Model of Photosynthetic CO_2 Assimilation in Leaves of C3 Species.” Planta 149 (1): 78–90.\n\n\nGu, Lianhong, Stephen G Pallardy, Kevin Tu, Beverly E Law, and Stan D Wullschleger. 2010. “Reliable Estimation of Biochemical Parameters from c-3 Leaf Photosynthesis-Intercellular Carbon Dioxide Response Curves.” Plant Cell & Environment 33 (11): 1852–74."
  },
  {
    "objectID": "DAT-vs-racir.html#sec-racir-dat-fitaci",
    "href": "DAT-vs-racir.html#sec-racir-dat-fitaci",
    "title": "15  快速ACi 曲线 (RACiR)",
    "section": "15.1 使用 plantecophys 来拟合",
    "text": "15.1 使用 plantecophys 来拟合\n我这里使用一个测量水稻的数据来进行演示，测量方式是使用的 DAT 技术的快速 ACi 曲线，正常情况下使用 plantecophys 分析 LI-6800 数据应该是这样：\n\n\nCode\nlibrary(\"plantecophys\")\n\ndat_aci <- read.csv('data/racir_adyn.csv')\n\ndat1 <- fitaci(\n  dat_aci,\n  varnames = list(\n    ALEAF = \"A\",\n    Tleaf = \"TleafCnd\",\n    Ci = \"Ci\",\n    PPFD = \"Qin\"\n  ),\n  alpha = 0.5,\n  theta = 1\n)\n\n\n计算参数为：\n\n\nCode\ndat1$pars\n\n\n\n\n\n\nTable 15.1: plantecophys 拟合 DAT 测量的参数 \n\n\n\nEstimate\nStd. Error\n\n\n\n\nVcmax\n26.994837\n0.1154895\n\n\nJmax\n46.638084\n0.1159879\n\n\nRd\n1.380359\n0.0214664\n\n\n\n\n\n\n作图查看为：\n\n\nCode\nplot(dat1)\n\n\n\n\n\nFigure 15.2: 使用 plantecophys 拟合 DAT 数据的图形\n\n\n\n\n但是 plantecophys 是专用于 LI-6400 的参数，使用 LI-6800 修改参数略微麻烦，我于是将其 fitaci 函数略做修改，使其方便用于 LI-6800 (sec. 14.1.2):\n\n\nCode\ndat2 <- plantecophys2::fitaci(\n  dat_aci,\n  varnames = list(\n    ALEAF = \"A\",\n    Tleaf = \"TleafCnd\",\n    Ci = \"Ci\",\n    PPFD = \"Qin\"\n  ),\n  alpha = 0.5,\n  theta = 1\n)\n\n\n\nFormula: ALEAF ~ acifun_wrap(Ci, PPFD = PPFD, Vcmax = Vcmax, Jmax = Jmax, \n    Rd = Rd, Tleaf = Tleaf, Patm = Patm, TcorrectVJ = Tcorrect, \n    alpha = alpha, theta = theta, gmeso = gmeso, EaV = EaV, EdVC = EdVC, \n    delsC = delsC, EaJ = EaJ, EdVJ = EdVJ, delsJ = delsJ, Km = Km, \n    GammaStar = GammaStar)\n\nParameters:\n      Estimate Std. Error t value Pr(>|t|)    \nVcmax 26.99484    0.11549   233.7   <2e-16 ***\nJmax  46.63808    0.11599   402.1   <2e-16 ***\nRd     1.38036    0.02147    64.3   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1347 on 295 degrees of freedom\n\nNumber of iterations to convergence: 6 \nAchieved convergence tolerance: 7.337e-06\n\n\n我们看一下结果：\n\n\nCode\ndat2$pars\n\n\n\n\n\n\nTable 15.2: plantecophys 拟合 DAT 测量的参数 \n\n\n\nEstimate\nStd. Error\n\n\n\n\nVcmax\n26.994837\n0.1154895\n\n\nJmax\n46.638084\n0.1159879\n\n\nRd\n1.380359\n0.0214664\n\n\n\n\n\n\n作图结果为：\n\n\nCode\nplot(dat2)\n\n\n\n\n\nFigure 15.3: 使用 plantecophys2 拟合 DAT 数据的图形\n\n\n\n\n主要区别是我让 plantecophys2 显示 summary 结果，这样对拟合效果的查看比较直观，再者稍微将图形的显示进行了修改，我感觉更符合我的审美一些。本质上没做改动，只是方便查看拟合结果和图形进行了微调。"
  },
  {
    "objectID": "DAT-vs-racir.html#sec-racir-dat-fit-aci",
    "href": "DAT-vs-racir.html#sec-racir-dat-fit-aci",
    "title": "15  快速ACi 曲线 (RACiR)",
    "section": "15.2 使用 photosynthesis 来拟合",
    "text": "15.2 使用 photosynthesis 来拟合\n\n\n\n\n\n\n未运行结束代码\n\n\n\n下面 photosynthesis 的代码，在我运行拟合过程中长时间不结束，估计是数据量大之后在某个算法上进行反复尝试的原因，为了避免卡在此处，下面的代码并没有运行结束。后面再进行测试 2021-12-14\n\n\n这里不再做过多介绍，具体细节可以参考 @#sec-photosynthesis-aci：\n\n\nCode\nlibrary(photosynthesis)\n\ndat_aci$TLEAF <-dat_aci$TleafCnd + 273.15\nfit <- fit_aci_response(dat_aci,\n                         varnames = list(\n                           A_net = \"A\",\n                           T_leaf = \"TLEAF\",\n                           C_i = \"Ci\",\n                           PPFD = \"Qin\"\n                         ))\n\n\n拟合结果：\n\n\nCode\nreshape2::melt(fit[[1]])\n\n\n使用相同的方式查看图形：\n\n\nCode\nfit[[2]]\n\n\n本质上是使用的参数是 LI-6800 还是 LI-6400 得问题，使用 RACiR 还是 DAT，只是增加了拟合的数据量，无路如何，拟合点数量级的增长对拟合是有利无害的 sec. 1.1.1。\n\n\n\n\nCoursolle, Carole, Guillaume O. Prud’homme, Manuel Lamothe1, and Nathalie Isabel1. 2019. “Measuring Rapid a–Ci Curves in Boreal Conifers: Black Spruce and Balsam Fir.” Frontiers in Plant Science. https://doi.org/10.3389/fpls.2019.01276.\n\n\nSaathoff, Aaron J., and Jon Welles. 2021. “Gas Exchange Measurements in the Unsteady State.” Plant, Cell & Environment 44 (11): 3509–23. https://doi.org/10.1111/pce.14178.\n\n\nStinziano, J. R., P. B. Morgan, D. J. Lynch, A. J. Saathoff, D. K. Mcdermitt, and D. T. Hanson. 2017. “The Rapid a-Ci Response: Photosynthesis in the Phenomic Era.” Plant Cell & Environment 40.\n\n\nStinziano, Joseph R, Dayle K Mcdermitt, Douglas J Lynch, Aaron J Saathoff, Patrick B Morgan, and David T Hanson. 2018. “The Rapid a/Ci Response: A Guide to Best Practices.” New Phytologist."
  },
  {
    "objectID": "plantecowraps.html#sec-plantecowrap-nogroup",
    "href": "plantecowraps.html#sec-plantecowrap-nogroup",
    "title": "16  plantecowrap 温度相关拟合",
    "section": "16.1 无分组数据的使用",
    "text": "16.1 无分组数据的使用\n软件包介绍参考 sec. 3，这里使用软件包自带的数据进行演示：\n\n\nCode\nlibrary(plantecowrap)\ndata <- read.csv(\n  system.file(\"extdata\", \"example_1.csv\",\n              package = \"plantecowrap\"),\n  stringsAsFactors = FALSE\n)\n\n\n\n\nCode\nhead(data)\n\n\n\n\n\nplantecowraps 自带的示例数据 #{tbl-plantecowraps}\n\n\nX\nA\nCi\nTleaf\nPress\nPPFD\nTreat\n\n\n\n\n1\n2.154595\n75\n10\n100\n2000\n10\n\n\n2\n2.733792\n100\n10\n100\n2000\n10\n\n\n3\n3.430289\n150\n10\n100\n2000\n10\n\n\n4\n3.834256\n200\n10\n100\n2000\n10\n\n\n5\n4.098002\n250\n10\n100\n2000\n10\n\n\n6\n4.283738\n300\n10\n100\n2000\n10\n\n\n\n\n\n这里使用的是示例数据。\n\n\nCode\nfits <- fitacis2(\n  data = data,\n  varnames = list(\n    ALEAF = \"A\",\n    Tleaf = \"Tleaf\",\n    Ci = \"Ci\",\n    PPFD = \"PPFD\",\n    Rd = \"Rd\",\n    Press = \"Press\"\n  ),\n  group1 = \"Treat\",\n  fitTPU = FALSE,\n  fitmethod = \"bilinear\",\n  gm25 = 10000,\n  #Allows fitting on an ACi rather than ACc-basis\n  Egm = 0\n)\noutputs <- acisummary(data, group1 = \"Treat\", fits = fits)\n\n\n到这里为止，如果熟悉 plantecophys 的话，一直没有什么新意，只是给 fitacis 改了个名字，然后给 25 摄氏度下的叶肉导度赋值了一个不可能的数据，这样是为了使用 Ci 的数据来进行拟合。下面是关键部分了：\n\n\nCode\ntresp <- fit_topt_VJ(outputs)\n\n\n这里使用这个函数 fit_topt_VJ 来拟合 Vcmax 和 Jmax 对温度响应的曲线，要查看拟合的参数：\n\n\nCode\ntresp[[2]]\n\n\n\n\n\n\nTable 16.1: plantecowrap 拟合的参数 \n\n\nParameter\nk25\nEa\nResidual\nBIC\n\n\n\n\nVcmax\n75.1461\n53.45129\n73.99293\n53.18597\n\n\nJmax\n148.6158\n78.94620\n60.95280\n52.36863\n\n\n\n\n\n\n这里是显示拟合参数，k25 是指 25 度时候的 Km，Ea 是活化能。响应图形的查看是：\n\n\nCode\ntresp[[3]]\n\n\n\n\n\nFigure 16.1: plantecowrap 的图形查看\n\n\n\n\n能直接看到 V_{cmax} 和 J_{max} 对温度的响应。"
  },
  {
    "objectID": "plantecowraps.html#sec-plantecowrap-group",
    "href": "plantecowraps.html#sec-plantecowrap-group",
    "title": "16  plantecowrap 温度相关拟合",
    "section": "16.2 多个分组数据的使用",
    "text": "16.2 多个分组数据的使用\n上面的示例是简单的演示，实际应用中肯定是要有很多分组的，分组代码如下，使用相似，为避免篇幅太长，这里的代码不再实际运行。\n\n\nCode\n# eval: false\ndata2 <- read.csv(\n  system.file(\"extdata\", \"example_2.csv\",\n              package = \"plantecowrap\"),\n  stringsAsFactors = FALSE\n)\n\nhead(data2)\n\n\n  X        A  Ci Tleaf Press PPFD Grouping\n1 1 2.154595  75    10   100 2000     10_a\n2 2 2.733792 100    10   100 2000     10_a\n3 3 3.430289 150    10   100 2000     10_a\n4 4 3.834256 200    10   100 2000     10_a\n5 5 4.098002 250    10   100 2000     10_a\n6 6 4.283738 300    10   100 2000     10_a\n\n\n数据根据 Groping 分为了 a,b两组。\nfits2 <- fitacis2(\n  data = data2,\n  varnames = list(\n    ALEAF = \"A\",\n    Tleaf = \"Tleaf\",\n    Ci = \"Ci\",\n    PPFD = \"PPFD\",\n    Rd = \"Rd\",\n    Press = \"Press\"\n  ),\n  group1 = \"Grouping\",\n  fitTPU = FALSE,\n  fitmethod = \"bilinear\",\n  gm25 = 10000,\n  Egm = 0\n)\n\noutputs <- acisummary(data2, group1 = \"Grouping\", fits = fits2)\n\noutputs <-\n  separate(\n    outputs,\n    col = \"ID\",\n    into = c(\"Treat\", \"Block\"),\n    sep = \"_\"\n  )\n\ntresps <- fit_topt_VJs(data = outputs,\n                       group = \"Block\")\n这里就是利用率分组信息来区分不同的数据组。和上面没太大区别。这里既然使用了多个分组，那么要获取对应的图形和参数，就麻烦一些，但是作者考虑了这一点，直接写好相关的函数，望文生义即可，就是代表字面意思：\npars <- get_t_pars(tresps)\npars\n\ngraphs <- get_t_graphs(tresps)\n\nprint_graphs(graphs, path = \"./exist_dir\")\n不过上面这段代码所有的内容实际上已经在 tresps 内了，这里仅仅是提取出来方便而已，需要注意，最后图形的导出看上去只是支持临时目录和当前目录，或者是已经存在的目录，即代码里没有做相关目录不存在就先创建目录的处理。\n\n\n\n\nBernacchi, Carl J., Archie R. Portis, Hiromi Nakano, Susanne von Caemmerer, and Stephen P. Long. 2002. “Temperature Response of Mesophyll Conductance. Implications for the Determination of Rubisco Enzyme Kinetics and for Limitations to Photosynthesis in Vivo.” Plant Physiology 130 (4): 1992–98. https://doi.org/10.1104/pp.008250.\n\n\nMedlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. “Temperature Response of Parameters of a Biochemically Based Model of Photosynthesis. II. A Review of Experimental Data.” Plant, Cell & Environment 25 (9): 1167–79. https://doi.org/https://doi.org/10.1046/j.1365-3040.2002.00891.x."
  },
  {
    "objectID": "Rd.html#sec-laisk-method",
    "href": "Rd.html#sec-laisk-method",
    "title": "17  Rd 呼吸 相关",
    "section": "17.1 Laisk 方法概述",
    "text": "17.1 Laisk 方法概述\nLaisk 方法参考的文献为 Brooks and Farquhar (1985)，基本实验方法和原则是：\n在不同的低光条件下测量 CO_2 响应曲线（例如该文采用了四个低光条件），这样寻找这几个响应曲线的交点，也就是四条曲线 A 值相同的点，然后采用该 A 值下的 C_i 值作为对 \\Gamma^* 的估计，而 A 值则作为对 -R_d 的估计。\n采用的 C_i 范围较小，此范围内响应曲线是近线性的，每个光强下的响应曲线采用的是线性拟合。他们的交点是通过计算获得，从而计算上面的 \\Gamma^* 和 -R_d。\n当然这篇文献里还提到的 R_n，这是和 R_d 相对的概念，是我们通常称为暗呼吸速率的参数。测量方式是当光源关闭后，呼吸速率快速下降，然后在 30-45 min 的黑暗处理后，该速率基本停止后作为暗呼吸速率。\nWalker and Ort (2015) 给出了上述方式的示意图：\n\n\n\nFigure 17.1: Laisk 方法示例\n\n\n上面的图形使用的是三项式拟合的结果。\n\n17.1.1 基本计算方法\nWalker and Ort (2015) 对于交点的判定给出了详细论述，如上图所示，这几条曲线（或最初的线性）并不是总会完全相交于一点。通常采用的方法是将所有曲线（或直线）的交点进行取均值。实践中，这些点很少收敛于单点，通常移除某交点或重新测量直到交点的标准差在某范围内。但总之会存在一定缺陷，因而 Walker and Ort (2015) 对上述方法做了一个改变：\n\nC_i^* = \\frac{b1-b2}{m_2 -m_1}\n \\qquad(17.1)\n其中 C_i^* 的意义为上文提到的计算的 \\Gamma^*, m 表示两条响应曲线线性部分的直线的斜率，b 表示截距。之后再进行计算：\n\nR_d = m C_i^* + b\n \\qquad(17.2)\n该方法的基本步骤是：\n\n将每条曲线的 m 值作为 x 轴，b 值作为 y 轴，那么对其做一个标准的线性回归，这条回归线的斜率为：\n\n\nm_{reg} = \\frac{b_2-b_1}{m_2 -m_1}\n \\qquad(17.3)\n将其乘以 -1，并整理方程，那么我们可以得到下面的公式：\n\nb=-C_i^* + b_{reg}\n \\qquad(17.4)\n那么：\n\nR_d = b_{reg}\n \\qquad(17.5)"
  },
  {
    "objectID": "Rd.html#sec-kok-method",
    "href": "Rd.html#sec-kok-method",
    "title": "17  Rd 呼吸 相关",
    "section": "17.2 Kok 方法",
    "text": "17.2 Kok 方法\n由于 Kok (1956) 的方法是基于氧气的测量，尽管原则一样，但我不想浪费精力学习现在基本抛弃的测量方式，所以下面的描述基于 Way et al. (2019)：\nKok 方法基于在弱光 ( \\lt 100 \\mu mol \\cdot m^{-2} \\cdot m^{-1} ) 下测量净光合速率。当光强从低到高渐变时，净光合速率增加，但这个增加的斜率通常存在一个中断。计算 R_d 通常是基于该中断代表了从 R_n 到光下对 R_n 的已知阶段。因此 R_d 可以通过拟合高于该断点的数据点并进行差值后与 y 轴的交点来表示。如下图作者测量了不同温度下的 R_d:\n\n\n\nFigure 17.2: Kok 方法示例\n\n\n当然该方法存在争论，但是他的测量比较简单，争论内容不在本文讨论之列。"
  },
  {
    "objectID": "Rd.html#sec-yin-method",
    "href": "Rd.html#sec-yin-method",
    "title": "17  Rd 呼吸 相关",
    "section": "17.3 Yin 方法",
    "text": "17.3 Yin 方法\nXinyou Yin et al. (2011) 使用 LI-6400 进行光合荧光同步测量来进行，光强的设置为：\n5,10,15,20,30,50,70,100,150,200 设置 Ca 的浓度为 370 \\mu mol \\cdot mol，但外界的 O_2 浓度为 2%。并且为验证光强设置的方向是否影响 R_d，单独进行了正向和反向的光强实验。荧光测量遵循了 LI-6400 的测量原则。\n\n\n\nFigure 17.3: Yin 方法测量 Rd 示例\n\n\nR_d 的计算使用了上图的方法，与 Kok 类似，不过横坐标的数值为 \\Phi PSII/4。该方法只适用于改进的 R_d 的计算。"
  },
  {
    "objectID": "Rd.html#sec-rd-func-intr",
    "href": "Rd.html#sec-rd-func-intr",
    "title": "17  Rd 呼吸 相关",
    "section": "17.4 函数简介",
    "text": "17.4 函数简介\n实际上有三个函数，但他们有共同的参数，道理很简单，他们基于的理论大部分相同：\n\n\nCode\nfit_r_light_kok(\n  data,\n  varnames = list(A_net = \"A_net\", PPFD = \"PPFD\"),\n  PPFD_lower = 40,\n  PPFD_upper = 100\n)\n\nfit_r_light_WalkerOrt(\n  data,\n  varnames = list(A_net = \"A_net\", C_i = \"C_i\", PPFD = \"PPFD\"),\n  P = 100,\n  C_i_threshold = 300\n)\n\nfit_r_light_yin(\n  data,\n  varnames = list(A_net = \"A_net\", PPFD = \"PPFD\", phi_PSII = \"phi_PSII\"),\n  PPFD_lower = 40,\n  PPFD_upper = 100\n)\n\n\n主要的参数，我们通过上面的介绍部分都能看明白，分别是适用于 LI-6400 或 LI-6800 的 varnames，以及最小光强或者最大光强，外界气压 P，以及部分方法中 C_i 的临界点 C_i_threshold。"
  },
  {
    "objectID": "Rd.html#sec-in-action",
    "href": "Rd.html#sec-in-action",
    "title": "17  Rd 呼吸 相关",
    "section": "17.5 实践",
    "text": "17.5 实践\n实践还是采用叶肉导度测试的数据，来自于软件包自带。代码来自于 vignette，主要对其中内容做相关解释。\n\n\nCode\nlibrary(photosynthesis)\ndata <- read.csv('data/A_Ci_Q_data_1.csv')\n\n\n加载软件包并读取示例数据。\n\n\nCode\nr_light <- fit_r_light_yin(\n  data = data,\n  varnames = list(\n    A_net = \"A\",\n    PPFD = \"Qin\",\n    phi_PSII = \"PhiPS2\"\n  ),\n  PPFD_lower = 20,\n  PPFD_upper = 250\n)\n\n\nR_d 为截距：\n\n\nCode\nr_light\n\n\n(Intercept) \n -0.7721399 \n\n\n当然，Kok 方法与之类似：\n\n\nCode\nr_light <- fit_r_light_kok(\n  data = data,\n  varnames = list(\n    A_net = \"A\",\n    PPFD = \"Qin\",\n    phi_PSII = \"PhiPS2\"\n  ),\n  PPFD_lower = 20,\n  PPFD_upper = 250\n)\nr_light\n\n\n(Intercept) \n -0.5237011 \n\n\n结果为负值当然表示这是呼吸的意思。\n示例程序还演示了不同分组的数据批量的处理，这里的分组是使用了 sample 气路的二氧化碳浓度，首先将其取整，然后转化为 factor 后处理，也就是前两行代码所做的处理。之后使用 Yin 的方法将所有分组的数据同时处理；\n\n\nCode\ndata$C_s <- (round(data$CO2_s, digits = 0))\ndata$C_s <- as.factor(round(data$C_s, digits = -1))\n\n\nr_lights <- fit_many(\n  data = data,\n  funct = fit_r_light_yin,\n  group = \"C_s\",\n  varnames = list(\n    A_net = \"A\",\n    PPFD = \"Qin\",\n    phi_PSII = \"PhiPS2\"\n  ),\n  PPFD_lower = 20,\n  PPFD_upper = 250\n)\n\n\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |======================================================================| 100%\n\n\n然后将数据整理一下：\n\n\nCode\ngroup <- names(r_lights)\nr_lights <- do.call(\"c\", r_lights)\nr_light_yin <- data.frame(x = group, y = r_lights, stringsAsFactors = FALSE)\nr_light_yin$x <- as.numeric(r_light_yin$x)\ncolnames(r_light_yin) <- c(\"C_s\", \"r_light\")\n\n\n首先提取不同的分组，这里是浓度的数据，然后将其转化为一个向量。最终将数据整理为一个数据框，第一列是分组名，第二列是对应的截距，或者说是 R_d。最后将数据框的表头修改为所需要的表头，结果为：\n\n\n\n\nTable 17.1: Yin 的方法测量的结果 \n\n\n\nC_s\nr_light\n\n\n\n\n50.(Intercept)\n50\n-0.4795729\n\n\n100.(Intercept)\n100\n-0.5840415\n\n\n200.(Intercept)\n200\n-0.6015973\n\n\n300.(Intercept)\n300\n-0.7388560\n\n\n410.(Intercept)\n410\n-0.7800892\n\n\n600.(Intercept)\n600\n-0.6269801\n\n\n820.(Intercept)\n820\n-0.7022602\n\n\n1200.(Intercept)\n1200\n-0.5198403\n\n\n1600.(Intercept)\n1600\n-0.3685110\n\n\n\n\n\n\nwalker 方法相比来说要复杂一些，因为多求了一个参数：\n\n\nCode\nwalker_ort <-\n  fit_r_light_WalkerOrt(data, varnames = list(A_net = \"A\", C_i = \"Ci\", PPFD = \"Qin\"))\n\nsummary(walker_ort[[1]])\n\n\n\nCall:\nlm(formula = Intercept ~ Slope, data = coefs)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.36114 -0.10958 -0.05553  0.08166  0.62016 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  -0.1526     0.1176  -1.297    0.224    \nSlope        -4.6004     0.4069 -11.307  5.1e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2513 on 10 degrees of freedom\nMultiple R-squared:  0.9275,    Adjusted R-squared:  0.9202 \nF-statistic: 127.8 on 1 and 10 DF,  p-value: 5.103e-07\n\n\n通过图形才能很好的反应他使用单条线的斜率和截距来计算的情况：\n\n\nCode\nwalker_ort[[2]]\n\n\n\n\n\nFigure 17.4: 图形方式查看 Walker 的测量方法\n\n\n\n\n数据的结果：\n\n\n\n\nTable 17.2: Walker 的方法测量的结果 \n\n\n\nGammaStar\nr_light\n\n\n\n\nSlope\n46.00427\n-0.152643\n\n\n\n\n\n\n就是这些内容了，属于比较使用的函数。\n\n\n\n\nBrooks, A., and G. D. Farquhar. 1985. “Effect of Temperature on the Co2/O2 Specificity of Ribulose-1,5-Bisphosphate Carboxylase/Oxygenase and the Rate of Respiration in the Light.” Planta 165 (3): 397–406. https://doi.org/10.1007/BF00392238.\n\n\nFarquhar, G. D., S. Von Caemmerer, and J. A. Berry. 1980. “A Biochemical Model of Photosynthetic CO_2 Assimilation in Leaves of C3 Species.” Planta 149 (1): 78–90.\n\n\nKok, Bessel. 1956. “On the Inhibition of Photosynthesis by Intense Light.” Biochimica Et Biophysica Acta 21 (2): 234–44. https://doi.org/10.1016/0006-3002(56)90003-8.\n\n\nWalker, Berkley J., and Donald R. Ort. 2015. “Improved Method for Measuring the Apparent Co2 Photocompensation Point Resolves the Impact of Multiple Internal Conductances to Co2 to Net Gas Exchange.” Plant, Cell & Environment 38 (11): 2462–74. https://doi.org/https://doi.org/10.1111/pce.12562.\n\n\nWay, Danielle A., Michael J. Aspinwall, John E. Drake, Kristine Y. Crous, Courtney E. Campany, Oula Ghannoum, David T. Tissue, and Mark G. Tjoelker. 2019. “Responses of Respiration in the Light to Warming in Field-Grown Trees: A Comparison of the Thermal Sensitivity of the Kok and Laisk Methods.” New Phytologist 222 (1): 132–43. https://doi.org/https://doi.org/10.1111/nph.15566.\n\n\nYin, Xinyou, Zhouping Sun, Paul C. Struik, and Junfei Gu. 2011. “Evaluating a New Method to Estimate the Rate of Leaf Respiration in the Light by Analysis of Combined Gas Exchange and Chlorophyll Fluorescence Measurements.” Journal of Experimental Botany 62 (10): 3489–99. https://doi.org/10.1093/jxb/err038.\n\n\nYin, X., and P. C. Struik. 2009. “C3 and C4 Photosynthesis Models: An Overview from the Perspective of Crop Modelling.” NJAS - Wageningen Journal of Life Sciences, Recent Advances in Crop Growth Modelling, 57 (1): 27–38. https://doi.org/10.1016/j.njas.2009.07.001."
  },
  {
    "objectID": "C4-related.html#c4_sim",
    "href": "C4-related.html#c4_sim",
    "title": "18  C4 植物光合模拟",
    "section": "18.1 C4 植物光合速率的计算",
    "text": "18.1 C4 植物光合速率的计算\n\n\nCode\n# 模拟 C4 植物的 Ci 值，计算光合速率并作图\nlibrary(plantecophys)\naci <- AciC4(Ci=seq(5,600, length=101))\nwith(aci, plot(Ci, ALEAF, type='l', ylim=c(0,max(ALEAF))))\n\n\n\n\n\nFigure 18.1: AciC4 模拟一定 Ci 梯度下光合速率的变化\n\n\n\n\n\n\n\n\n\n\n注意\n\n\n\n目前无法利用该函数来拟合观测到数据。\n\n\n\n\n\n\nCaemmerer, S. Von. 2000. “Biochemical Models of Leaf Photosynthesis.” Quarterly Review of Biology, 165."
  },
  {
    "objectID": "fluorescence.html",
    "href": "fluorescence.html",
    "title": "叶绿素荧光数据的处理",
    "section": "",
    "text": "todo"
  },
  {
    "objectID": "jiptest.html#sec-jiptest",
    "href": "jiptest.html#sec-jiptest",
    "title": "19  LI-6800 JIP test 分析",
    "section": "19.1 jip test 的实现",
    "text": "19.1 jip test 的实现\n分析依赖于我写的 jiptest 软件包，去年冬天（2020.11）我修改了一次，其中我希望大改的是求曲线下部面积的部分，因为曲线形状不规则，需要用到积分，我用的现成的软件包，而且印象里求面积没有使用标准化后的数据来进行计算，所以不太合适，这个我争取近期找时间来解决一下，这里先立一个 flag，安装可以按照下面的方式：\n\n\nCode\nremotes::install_github(\"zhujiedong/jiptest\")\n# 或\nremotes::install_git('https://gitee.com/zhu_jie_dong/jiptest')"
  },
  {
    "objectID": "jiptest.html#readfluor",
    "href": "jiptest.html#readfluor",
    "title": "19  LI-6800 JIP test 分析",
    "section": "19.2 read_files 及 read_dcfiles 函数",
    "text": "19.2 read_files 及 read_dcfiles 函数\nread_files 用于批量读取所有调制光测量数据，方便用于其他的数据分析。函数要求所有数据必须是 xlsx 格式，并且所有测量数据都保存在同一文件夹内。，如有其他文件或测量数据则会报错。 read_dcfiles 用于批量读取所有连续光测量数据，其他选项与 read_dcfiles 相同。例如在了 data文件夹下的 ojip 文件夹内，有五个数据文件。\n函数仅有一个参数，即保存数据文件夹的路径，使用如下：\n读取调制光测量数据：\n\n\nCode\nlibrary(jiptest)\njip_data<- read_files(\"data/ojip\")\n\n\n读取连续光数据：\n\n\nCode\njip_dcdata <- read_dcfiles(\"data/ojip\")\n\n\n调制光的信号前 10 行数据：\n\n\n\n\nTable 19.1: jiptest 批量导入数据后的样式 \n\n\nSECS\nMILLI_SEC\nFLUOR\nNORM_FLUOR\nSOURCE\n\n\n\n\n6.10e-06\n0.0060797\n621\n0.0005027\nINDUCTION-4188-20201116-10_53_39\n\n\n1.01e-05\n0.0101328\n620\n0.0000000\nINDUCTION-4188-20201116-10_53_39\n\n\n1.42e-05\n0.0141859\n649\n0.0145781\nINDUCTION-4188-20201116-10_53_39\n\n\n1.80e-05\n0.0180006\n629\n0.0045242\nINDUCTION-4188-20201116-10_53_39\n\n\n2.21e-05\n0.0220537\n674\n0.0271455\nINDUCTION-4188-20201116-10_53_39\n\n\n2.61e-05\n0.0261068\n736\n0.0583126\nINDUCTION-4188-20201116-10_53_39\n\n\n\n\n\n\n连续光的信号前 10 行数据：\n\n\n\n\nTable 19.2: jiptest DC 数据批量导入数据后的样式 \n\n\nSECS\nMILLI_SEC\nFLUOR\nNORM_FLUOR\nSOURCE\n\n\n\n\n6.10e-06\n0.0060797\n98161\n0.0000000\nINDUCTION-4188-20201116-10_53_39\n\n\n1.01e-05\n0.0101328\n100331\n0.0071347\nINDUCTION-4188-20201116-10_53_39\n\n\n1.42e-05\n0.0141859\n102577\n0.0145193\nINDUCTION-4188-20201116-10_53_39\n\n\n1.80e-05\n0.0180006\n104849\n0.0219894\nINDUCTION-4188-20201116-10_53_39\n\n\n2.21e-05\n0.0220537\n107214\n0.0297652\nINDUCTION-4188-20201116-10_53_39\n\n\n2.61e-05\n0.0261068\n109624\n0.0376890\nINDUCTION-4188-20201116-10_53_39\n\n\n\n\n\n\n\n\n\n\n\n\n注意\n\n\n\nNORM_FLUOR 是标准化后的荧光信号数据，其中标准化采用的方式是 Stirbet and Govindjee (2012) 所采用的：F = \\frac{F_t - F_o}{F_m - F_o}，而曲线上部的面积则采用 Stirbet and Govindjee (2011) 的方式进行标准化，以方便不同叶片之间的比较，具体为 area = \\frac{area}{F_m - F_o}"
  },
  {
    "objectID": "jiptest.html#sec-testfluor",
    "href": "jiptest.html#sec-testfluor",
    "title": "19  LI-6800 JIP test 分析",
    "section": "19.3 jip_test 及 jip_dctest 函数",
    "text": "19.3 jip_test 及 jip_dctest 函数\njiptest 是 jiptest 的核心函数，用于所有数据的 jiptest 分析，函数仅包一个参数，测量数据的保存文件夹路径。 jip_dctest 与 jip_test 相似，用于连续光测量数据的分析。\n\n\nCode\nactest <- jip_test(\"data/ojip\")\n\n\n\n\nCode\ndctest <- jip_dctest(\"data/ojip\")\n\n\n调制光信号的计算参数：\n\n\n\n\n\n\n连续光信号计算参数：\n\n\n\n\n\n\n可以看出，对于标准化之后的参数，二者基本一致，原始信号则无法一致，因为连续光信号强度更高（所以数据的比较要在相同的测量光内进行）。 。若需要将数据导出，可以使用相关命令：\n\n\nCode\nwrite.csv(actest, \"d:/data/jip_resluts.csv\")\nwrite.csv(dctest, \"d:/data/dcjip_resluts.csv\")"
  },
  {
    "objectID": "jiptest.html#sec-plotfluor",
    "href": "jiptest.html#sec-plotfluor",
    "title": "19  LI-6800 JIP test 分析",
    "section": "19.4 图像查看函数",
    "text": "19.4 图像查看函数\n如果仅仅是简单查看结果，那么我们直接用默认参数就好，作图的数据是之前导入的数据文件：\n默认使用标准化的荧光信号（也就是除以最大值，标准化到 0~1 之间，LI-6800 在 1.4 之后的版本也提供了仪器上查看的界面）。\n\n19.4.1 默认图形的方式\n\n默认调制光图形\n\n\n\nCode\nplot(jip_data)\n\n\n\n\n\nFigure 19.1: 默认调制光图形查看\n\n\n\n\n\n默认连续光图形\n\n\n\nCode\nplot(jip_dcdata)\n\n\n\n\n\nFigure 19.2: 默认连续光图形查看\n\n\n\n\n默认图形，仅仅查看结果是可以的，当然有些情况下需要进行调整才方便做展示用。\n\n\n19.4.2 定制化图形的方式\n这个是这次改动的重点之一，例如都使用原始信号分别做上面两幅图：\n\n定制调制光图形\n\n这里使用原始荧光信号，然后更改图例颜色等，主要是 add_leg = FALSE 不增加默认的图例，以及 normalized = FALSE 不使用信号标准化。其他请参考帮助 ?plot.jip。 我简单写了一下帮助文档，大家应该基本能看明白，我暂时一直没时间详细了写。\n\n\nCode\ncls <- palette.colors(n = 5,  \"set 2\", alpha = 0.8)\nplot(\n  jip_data,\n  ylab = 'Normalized fluorescence signals',\n  add_leg = FALSE,\n  def_pch = 14:18,\n  col = cls,\n  main = \"Demodulated signals\",\n  normalized = FALSE\n)\n\nlegend(\n  \"topleft\",\n  unique(jip_data$SOURCE),\n  col = cls,\n  pch = 14:18,\n  cex = 0.6,\n  pt.cex = 1.2,\n  bty = \"n\"\n)\n\n\n\n\n\nFigure 19.3: 定制调制光图形示例\n\n\n\n\n\n定制连续光图形\n\n连续光图形，例如修改图例的位置以及不显示标准化的数据。\n\n\nCode\nplot(jip_dcdata, legend_pos = \"bottomright\", normalized = FALSE)\n\n\n\n\n\nFigure 19.4: 定制连续光图形示例\n\n\n\n\n\n\n\n\n\n\n注意\n\n\n\n关于标准化和非标准化图形差异大的问题，这个比较简单，原始信号比较低的那条线，是不同物种的不同叶片，所以不具备比较价值，我只是程序测试。\n\n\n\n\n\n\n\n\n提示\n\n\n\n建议在开始分析数据前，使用作图查看数据质量，若使用调制光数据测量的荧光信号太弱，数据点太散，则可以使用连续光测量信号进行分析，对于归一化的荧光参数，二者几乎无差别。最好的方式当然是在测量时注意荧光信号强度，若基础荧光信号太弱，尝试增加测量叶片的面积，增强荧光信号强度，增大信噪比。"
  },
  {
    "objectID": "jiptest.html#sec-stdsm-area",
    "href": "jiptest.html#sec-stdsm-area",
    "title": "19  LI-6800 JIP test 分析",
    "section": "19.5 关于 Area 和 Sm 参数计算的说明",
    "text": "19.5 关于 Area 和 Sm 参数计算的说明\n具体参数的计算参考了 Tsimilli-Michael (2019) 和 Bussotti et al. (2010)，时间轴的单位是 ms。\n在最初的版本中，面积计算原本是用了了一个 三次项样条插值来将数据点拟合为一条曲线，然后对曲线进行计算，前几天有客户询问我计算报错，我只能看出来那是积分错误，但我不知道原因，因为积分的方法我是用的一个叫做 MASS 包来处理的，它有一些问题需要处理：\n\nMASS 有时候改动会导致计算面积不能使用，这个发生过一次，好在改动不是特别大，我修改了之后就能用了。但这就是个问题，依赖别人的软件包，作者我也不认识，人家更新不会通知我，也不会管我能不能用。\n样条插值尽管拟合效果不错，但总会因为 J 点和 I 点的拐点导致拟合不佳的情况出现，这样子会带来一定的误差来源。\n基本出错我很难定位具体原因。\n\n基于上面这些原因，我使用了下面的方式对面积计算进行修改，当然下面演示的是原理部分，所以我只计算曲线下部面积，反正上部面积是总面积减去下部面积，所以这个不影响最终计算，也能简化我对计算方式的描述。\n\n19.5.1 曲线下部面积的计算\n计算方法依据这里 Sotos 的回答来进行。\n基本思路是这样，既然一种积分的方式是将曲线划分为很多个梯形，然后求其总面积。因为我的数据点数量非常大（通常 250 kHz 的调制频率），那么实际上我已经在 1 s 的测量时间内，将曲线划分为 250 kHz - 1 个梯形了（理论上最大值，实际没这么多），那我干脆不用拟合来做曲线，就直接用线连接所有数据点，不久避免了拟合不准确的问题了吗？为简化流程，我将梯形看做矩形，长度使用 2 点滚动平均值来计算，减少误差。因此，下面的内容就是用连续光信号来验证这个观点。\n\n\nCode\n# 使用的软件包\nlibrary(zoo)\n# 导入依次 OJIP 测量整理好的数据\nac <- read.csv(\"data/dctest.csv\")\n\n# 将数据里的 s 转化为 ms\nac$SECS <- (ac$SECS)*1000\n\n# 使用对数的时间轴\nac$logs <- log(ac$SECS)\n\n# 找到 FO点，因为计算是 OJIP 时间段内的数据\nj <- which(ac$FLUOR == max(ac$FLUOR))\n# 只选择需要的数据\nac <- ac[1:j,]\n# 数据的行数\nn <- nrow(ac)\n\n# 使用上面叙述的原理来计算总面积\nauc <- with(ac, sum(diff(logs)*rollmean(FLUOR,2)))\nauc\n\n\n[1] 2543274\n\n\nCode\n# 滚动平均值使用的数据，也就是矩形的长\nroll <- with(ac, rollmean(FLUOR,2))\n\n# 按照相邻两点多最大值计算最大的误差\nauc_max_rect <- with(ac, sum(diff(logs)* FLUOR[2:n]))\n\n# 计算的 sm 参数的最大误差\nsm_error <- (auc_max_rect - auc)/(max(ac$FLUOR) - min(ac$FLUOR))\n\n\n这里 Area 误差从数值上看上去不小，但这是没有标准化后的荧光信号强度，实际并不大，而且没有标准化的数据在荧光参数里多数没有比较的价值，我们看一下标准化后的 Sm 参数：\n\n\nCode\nsm_error\n\n\n[1] 0.01855341\n\n\n这个数值是 0.0185534，也就是最大的误差是这个数据，但实际上我们按照梯形最高的边来作为矩形的长来计算的最大面积，这个面积对数据高估了，实际上的误差应该略大于 sm_error/2，也就是 0.0092767，相比于我们的实验来讲，这个小数点后第三位的误差可以忽略不计。\n通过图形我们可以直观的观察一下结果：\n\n\nCode\n#比较原来数据点的线与使用滚动平均值的线的差异\nplot(ac$logs, ac$FLUOR)\nfor (i in (1:(n-1))){\n  rect(ac$logs[i], 0, ac$logs[i+1], ac$FLUOR[i+1])\n  rect(ac$logs[i], 0, ac$logs[i+1], roll[i], border = 'red')\n}\n\n\n\n\n\nFigure 19.5: 比较使用简化方式计算面积与原来数据点连线之间的差异\n\n\n\n\n通过 fig. 19.5 我们能够看到，二者差异非常小(黑色是原始测量数据，红色为使用滚动平均值的数据)，即使是些微低估，也是所有的处理都存在这个情况，总比有的样条插值拟合曲线好，有的拟合不好要来得一致一些。而对于标准化之后的面积 Sm，那么小数点后第三位的误差，不会对结果造成明显影响，因为这个面积个位数或者十位数是普遍现象。\n\n\n\n\nBussotti, Filippo, Rosanna Desotgiu, Martina Pollastrini, and Chiara Cascio. 2010. “The JIP Test: A Tool to Screen the Capacity of Plant Adaptation to Climate Change.” Scandinavian Journal of Forest Research 25 (August): 1–8.\n\n\nStirbet, Alexandrina, and Govindjee. 2011. “On the Relation Between the Kautsky Effect (Chlorophyll a Fluorescence Induction) and Photosystem II: Basics and Applications of the OJIP Fluorescence Transient.” Journal of Photochemistry and Photobiology B: Biology, Special Issue on Recent Progress in the Studies of Structure and Function of Photosystem II, 104 (1): 236–57. https://doi.org/10.1016/j.jphotobiol.2010.12.010.\n\n\nStirbet, Alexandrina, and Govindjee. 2012. “Chlorophyll a Fluorescence Induction: A Personal Perspective of the Thermal Phase, the J–I–P Rise.” Photosynthesis Research 113 (1): 15–61. https://doi.org/10.1007/s11120-012-9754-5.\n\n\nTsimilli-Michael, Merope. 2019. “Revisiting JIP-Test: An Educative Review on Concepts, Assumptions, Approximations, Definitions and Terminology.” Photosynthetica 57 (December): 90–107. https://doi.org/10.32615/ps.2019.150."
  },
  {
    "objectID": "other-fluor.html",
    "href": "other-fluor.html",
    "title": "20  其他叶绿素荧光数据处理",
    "section": "",
    "text": "todo"
  },
  {
    "objectID": "gm-gs.html#sec-stamotal-related",
    "href": "gm-gs.html#sec-stamotal-related",
    "title": "叶肉与气孔导度",
    "section": "气孔导度相关",
    "text": "气孔导度相关\ntodo plantecophys 和 photosynthesis 使用的气孔导度模型\n\n气孔导度模型简介\n气孔导度模型的拟合是通过 fitBB 来实现的，可以拟合三个 Ball-Berry 类型的气孔导度模型，共有下面几个参数：\n\n气孔导度 (gs),\n光合 (A),\n外界 CO2 浓度 (Ca)\n水气压亏缺 (VPD).\n\n其三个模型的简介如下：\n\nBallBerry 模型\nJ. T. Ball, Woodrow, and Berry (1987) 发表的文章中的模型：\n\ng_s = g0 + g1(\\frac{A h_r}{C_a})\n \\qquad(1)\n其中 A 为净光合速率，g0 和 g1 为拟合参数，hr 为叶片表面的相对湿度，Ca 为叶片处CO2浓度。\n\n\n\nBBLeuning 模型\nR. Leuning (1995a) 发表的文章中的模型：\n\ng_s = g_0 + g_1(\\frac{A}{(C_a - \\Gamma)(1 + \\frac{D}{D_0})})\n \\qquad(2)\n其中 \\Gamma 为 CO2 补偿点，g0、g1 和 D0 为拟合参数。\n\n\nBBOptiFull 模型\nMedlyn et al. (2011) 发表的文章中的模型：\n\ng_s^* \\approx g_0 + g_1(1 + \\frac{g_1}{D}) \\frac{A}{C_a}\n \\qquad(3)\n额外的参数 gk 来自于 Duursma et al. (2013b)\n\ng_s = g_0 + 1.6(1 + \\frac{g_1}{D}(1-g_k)) \\frac{A}{C_a}\n \\qquad(4)\n\nMedlyn 模型 (Medlyn_partial)\nJ. Ball, Woodrow, and Berry (1987) 和 R. Leuning (1995b) 模型最为人批判的地方是他们都是经验模型，也就意味着对于他们参数的预测和解释并无理论依据。因而 Medlyn et al. (2011) 提出了基于最优气控模型的方法来解决这个问题。也就是根据：\n\n\\frac{\\partial E}{\\partial A} = \\lambda\n \\qquad(5)\n得到查看临界水分利用效率或者说植物损耗单位水分的碳生产量。然后将其考虑在模型内，两个基本的计算依据是：\n简化关系，使得 g0 等于零，确定胞间二氧化碳浓度和外界二氧化碳浓度的关系为：\n\n\\frac{C_i}{C_a} \\approx \\frac{g_1}{g_1 + \\sqrt{D}}\n \\qquad(6) 而 A 与 E 之间的关系（ITE）表示为：\n\n\\frac{A}{E} = \\frac{C_a P}{g_1\\sqrt{D}+D}\n \\qquad(7)\n最终得到的，考虑了最优气孔导度模型的模型为：\n\ng_s^* \\approx g_0 + 1.6 \\Bigg( 1 + \\frac{g_1}{\\sqrt{D}} \\Bigg) A/C_a\n \\qquad(8) 这里 P 为大气压，单位是 kPa。文献附加材料里有详细推导说明，需要的可以参考一下。\n\n\n\n\n\n\n注意\n\n\n\n不同的作者喜欢不同的参数名称，但本质上是一样的，例如 判的地方是他们都是经验模型，也就意味着对于他们参数的预测和解释并无理论依据。因而 Medlyn et al. (2011) 将 J. Ball, Woodrow, and Berry (1987) 的模型写为 eq. 9\n\n\n\ng_s = g_0 +g_1(A h_r/C_a)\n \\qquad(9)\n\n\nMedlyn 模型 (Medlyn_full)\nDuursma et al. (2013a) 考虑了同化速率对温度的响应，最终模型的形式（我们选择了 plantecophys 中 fitBB 函数的写法）：\n\ng_s = g_0 + 1.6(1+\\frac{g_1}{D}(1-g_k))\\frac{A}{C_a}\n \\qquad(10)\n\n\n\n\nBall, J. Timothy, Ian E. Woodrow, and Joseph A. Berry. 1987. A Model Predicting Stomatal Conductance and Its Contribution to the Control of Photosynthesis Under Different Environmental Conditions. Springer Netherlands.\n\n\nBall, John, Ian Woodrow, and Joseph Berry. 1987. “A Model Predicting Stomatal Conductance and Its Contribution to the Control of Photosynthesis Under Different Environmental Conditions.” Progress in Photosynthesis Research 4 (January): 221–24. https://doi.org/10.1007/978-94-017-0519-6_48.\n\n\nDuursma, Remko A., Paxton Payton, Michael P. Bange, Katrina J. Broughton, Renee A. Smith, Belinda E. Medlyn, and David T. Tissue. 2013a. “Near-Optimal Response of Instantaneous Transpiration Efficiency to Vapour Pressure Deficit, Temperature and [Co2] in Cotton (Gossypium Hirsutum L.).” Agricultural and Forest Meteorology 168: 168–76. https://doi.org/10.1016/j.agrformet.2012.09.005.\n\n\n———. 2013b. “Near-Optimal Response of Instantaneous Transpiration Efficiency to Vapour Pressure Deficit, Temperature and CO_2 in Cotton (Gossypium Hirsutum l.).” Agricultural & Forest Meteorology 168 (1): 168–76.\n\n\nLeuning, R. 1995a. “A Critical Appraisal of a Combined Stomatal‐photosynthesis Model for C3 Plants.” Plant Cell and Environment 18 (4): 339–55.\n\n\nLeuning, R. 1995b. “A Critical Appraisal of a Combined Stomatal-Photosynthesis Model for C3 Plants.” Plant, Cell & Environment 18 (4): 339–55. https://doi.org/https://doi.org/10.1111/j.1365-3040.1995.tb00370.x.\n\n\nMedlyn, Belinda E., Remko A. Duursma, Derek Eamus, David S. Ellsworth, I. Colin Prentice, Craig V. M. Barton, Kristine Y. Crous, Paolo De Angelis, Michael Freeman, and Lisa Wingate. 2011. “Reconciling the Optimal and Empirical Approaches to Modelling Stomatal Conductance.” Global Change Biology 17 (6): 2134–44."
  },
  {
    "objectID": "gs.html#sec-plantecophys-stamo",
    "href": "gs.html#sec-plantecophys-stamo",
    "title": "21  气孔导度模型的拟合",
    "section": "21.1 plantecophys 气孔导度相关函数",
    "text": "21.1 plantecophys 气孔导度相关函数\n\n21.1.1 fitBB 函数\n\n\nCode\nfitBB(\n  data,\n  varnames = list(\n    ALEAF = \"A\",\n    GS = \"gsw\",\n    VPD = \"VPDleaf\",\n    Ca = \"CO2_s\",\n    RH = \"RHcham\"\n  ),\n  gsmodel = c(\"BBOpti\", \"BBLeuning\", \"BallBerry\",\n              \"BBOptiFull\"),\n  fitg0 = FALSE\n)\n\n\n参数的意义:\n\ndata：待分析的数据文件。\nvarnames：注意，函数默认数据为 6400 格式，因此 6800 的数据文件要按照上文的参数修改。 相对湿度只有在使用 BallBerry 时才需要输入。\ngsmodel：上述三个模型之一。\nfitg0：默认不计算g0，若需要，改为TRUE。\n\n代码示例：\n\n\nCode\nlibrary(plantecophys)\n\naci <- read.csv(\"data/aci.csv\")\naci <- subset(aci, Obs > 0)\nfitBB(\n  aci,\n  varnames = list(\n    ALEAF = \"Photo\",\n    GS = \"Cond\",\n    VPD = \"VpdL\",\n    Ca = \"CO2S\",\n    RH = \"RH_S\"\n  ),\n  gsmodel = \"BBOpti\",\n  fitg0 = TRUE\n)\n\n\nResult of fitBB.\nModel :  BBOpti \nBoth g0 and g1 were estimated.\n\nCoefficients:\ng0  g1\n0.326 -0.992 \n\nFor more details of the fit, look at summary(myfit$fit)\nTo return coefficients, do coef(myfit).\n(where myfit is the name of the object returned by fitBB)\n\n\n\n\n21.1.2 fitBBs 函数\n如果我们有多个物种或分组的数据，那么使用 fitBBs 则可以快速拟合多条曲线的数据。我们先整合两次的数据，然后来查看一下运行结果：\n\n\nCode\naci01 <- read.csv(\"data/aci01.csv\")\naci01 <- subset(aci01, Obs > 0)\nmultiBB <- data.frame(\n  A = c(aci$Photo, aci01$Photo),\n  GS = c(aci$Cond, aci01$Cond),\n  CO2S = c(aci$CO2S, aci01$CO2S),\n  VPD = c(aci$VpdL, aci01$VpdL),\n  RH = c(aci$RH_S, aci01$RH_S),\n  species = c(rep(\"species1\", length(aci$Photo)),\n              rep(\"species2\", length(aci01$Photo)))\n)\n\nmod2 <- fitBBs(\n  multiBB,\n  group = \"species\",\n  varnames = list(\n    ALEAF = \"A\",\n    GS = \"GS\",\n    VPD = \"VPD\",\n    Ca = \"CO2S\",\n    RH = \"RH\"\n  ),\n  gsmodel = \"BallBerry\",\n  fitg0 = TRUE\n)\n\n\n结果为：\n\n\nCode\ncoef(mod2)\n\n\n\n\n\nfitBBs 的结果{#tbl-plt-eco-kab}\n\n\ngroup\ng0\ng1\n\n\n\n\nspecies1\n0.3263885\n-0.1734554\n\n\nspecies2\n0.0515873\n-0.0218842"
  },
  {
    "objectID": "gs.html#sec-photosynthesi-stamo",
    "href": "gs.html#sec-photosynthesi-stamo",
    "title": "21  气孔导度模型的拟合",
    "section": "21.2 photosynthesis 气孔导度相关函数",
    "text": "21.2 photosynthesis 气孔导度相关函数\n\n21.2.1 无分组模型的实现过程\n内容与上面 的重复，这里不在运行，仅列出代码。\n读取数据：\n\n\nCode\nlibrary(photosynthesis)\ndf <- read.csv(\"data/A_Ci_Q_data_1.csv\")\n\n\nBallBerry 模型需要相对湿度，而 LI-6800 的相对湿度数据实际上是转换为百分数后的数据，因此需要处理一下，然后这个函数的方便之处是，它可以一次拟合出所有的模型来：\n\n\nCode\ndf$RH <- df$RHcham / 100\n\nfits <- fit_gs_model(\n  data = df,\n  varnames = list(\n    A_net = \"A\",\n    C_air = \"Ca\",\n    g_sw = \"gsw\",\n    RH = \"RH\",\n    VPD = \"VPDleaf\"\n  ),\n  model = c(\"BallBerry\",\n            \"Leuning\",\n            \"Medlyn_partial\",\n            \"Medlyn_full\"),\n  D0 = 3\n)\n\n\n函数的参数其实都比较简单，如果对非线性拟合不满意，也可以传入 nlsLM 的参数。\n\n结果的查看\nfit_gs_model 结果有两个水平，第一层 list 是拟合模型，第二层则是模型相关的参数、图形等，可以通过位置查看：\n\n\nCode\nfits[[1]][1]\nfits[[1]][2]\nfits[[1]][3]\n\n\n也可以通过名称查看：\n\n\nCode\nfits$BallBerry$Parameters\nfits$Leuning$Graph\nfits$Medlyn_partial$Parameters\nfits$Medlyn_full$Parameters\n\n\n\n\n\n21.2.2 分组模型的实现\n分组数据处理起来也比较方便，例如下面以光强为分组，photosynthesis 提供了两个方便的函数，帮助进行分组数据的操作，fit_many 用于选择函数用于分组数据，compile_data 用于将 list 结果转为 dataframe：\n\n\nCode\ndf$Q_2 <- as.factor(round(df$Qin, digits = 0))\n\nfits <- fit_many(\n  df,\n  varnames = list(\n    A_net = \"A\",\n    C_air = \"Ca\",\n    g_sw = \"gsw\",\n    RH = \"RH\",\n    VPD = \"VPDleaf\"\n  ),\n  funct = fit_gs_model,\n  group = \"Q_2\"\n)\n\n\n数据的查看比之前又多了一个水平，例如 750 光强下的数据：\n\n\nCode\nfits[[\"750\"]][[\"Medlyn_partial\"]][[\"Parameters\"]]\n\n\n这里转换过程分两部，首先是将所有的参数转为 list 形式，转换对象是 1，也就是第一个模型 BallBerry。然后再将这个 list 进行一次转换，不同分组的参数 Parameters（顺序可参考未分组数据的结果）：\n\n\nCode\nbbmods <- compile_data(data = fits,\n                     output_type = \"list\",\n                     list_element = 1)\nbbpars <- compile_data(data = bbmods,\n                     output_type = \"dataframe\",\n                     list_element = 2)\n\nbbpars$ID <- as.numeric(bbpars$ID)\n\nplot(g0 ~ ID, bbpars)\n\n\n最后展示的图形是不同光强下，拟合的截距的差异。多个图形也可以使用这种方式转换，不过存储的类型最好是 list（存储的是 ggplot2 对象的类）。例如 vignette 使用下面的方式查看第三幅图的结果。\n\n\nCode\ngraphs <- compile_data(data = bbmods,\n                       output_type = \"list\",\n                       list_element = 3)\n\ngraphs[[3]]"
  },
  {
    "objectID": "gs.html#stomotal_couple",
    "href": "gs.html#stomotal_couple",
    "title": "21  气孔导度模型的拟合",
    "section": "21.3 光合最优气孔导度耦合模型",
    "text": "21.3 光合最优气孔导度耦合模型\nCowan and Farquhar (1977) 关于最优气孔导度的描述概括如下： 最优气孔行为理论认为气孔的最优化行为，指的是在某一时间段内， 最大化的进行光合碳固定的同时最小化的进行蒸腾作用，也就是说，对于一定的水分消耗，得到最大化的光合碳固定。即使得：\n\nA - \\lambda E\n \\qquad(21.1)\n最大化，其中 \\lambda 是临界水分利用效率，也即植物损耗单位水分的 C 生产量，单位一般为 mol \\: CO_2 \\cdot mol^{-1} H_2O，可通过光合速率和蒸腾速率的比值计算。plantecophys 包含了相关的函数来处理。\n\n21.3.1 FARAO 函数\nFARAO 函数用于找到最大化 A - \\lambda E 解的** Ci **值，这里是利用数值解的形式求解方程。\n\n\nCode\nFARAO(lambda = 0.002, Ca = 400, VPD = 1,\n      photo = c(\"BOTH\", \"VCMAX\",\"JMAX\"), \n      energybalance = FALSE, C4 = FALSE, \n      Tair = 25, Wind = 2, Wleaf = 0.02,\n      StomatalRatio = 1, LeafAbs = 0.86, ...)\n\nFARAO2(lambda = 0.002, Ca = 400, \n       energybalance = FALSE, ...)\n\n\n其参数同 fitaci 和 Photosyn，在此不多做介绍，FARAO 使用的是 Cowan and Farquhar (1977) 的方法得到最优化的 Ci 值, FARAO2 则更简单或可能更稳定，利用 Buckley et al. (2014) 的方法来计算, Medlyn et al. (2011) 的方法是这个数值解的近似值。"
  },
  {
    "objectID": "gs.html#sec-photo_stomo",
    "href": "gs.html#sec-photo_stomo",
    "title": "21  气孔导度模型的拟合",
    "section": "21.4 光合气孔导度耦合模型",
    "text": "21.4 光合气孔导度耦合模型\nRemko A. Duursma (2015) 对于气体交换耦合模型的简述如下：\n\n对于 FvCB 模型有：\n\n\nA_n = min(A_c, A_j)-R_d\n \\qquad(21.2)\n\n在假定 gm 为恒定的前提下：\n\n\nC_c = C_i - \\frac{A_n}{g_m}\n \\qquad(21.3)\n\n根据 Ficker 定理\n\n\nA_n = \\frac{g_s}{1.6}(C_a - C_i)\n \\qquad(21.4)\n以及 BallBerry 气孔导度模型 \ng_s = g_0 + g_1 \\frac{A_n}{C_a} f(D)\n \\qquad(21.5)\n整合公式 eq. 21.2, eq. 21.3, eq. 21.4 和 eq. 21.5 后得到气体交换的耦合模型，气体交换耦合模型有很多更大尺度上的应用，例如 R. A. Duursma and Medlyn (2012) 和 wang1998a，可用于预测 An，gs 和蒸腾速率对主要环境驱动因子的响应（除土壤水分），并包含了主要的叶片性状（g1，Vcmax, Jmax, Rd 以及他们的温度依赖性）。\n\n21.4.1 Photosyn 函数\nPhotosyn 为耦合的光合–气孔导度模型，基于 Farquhar 光合模型和 Ball-Berry 气孔导度模型。\n\n\nCode\nPhotosyn(VPD = 1.5, Ca = 400, PPFD = 1500,\n         Tleaf = 25, Patm = 100,RH = NULL,\n         gsmodel = c(\"BBOpti\", \"BBLeuning\", \n                     \"BallBerry\", \"BBdefine\"),\n         g1 = 4, g0 = 0, gk = 0.5, vpdmin = 0.5,\n         D0 = 5, GS = NULL, BBmult = NULL, \n         alpha = 0.24, theta = 0.85, Jmax = 100,\n         Vcmax = 50, gmeso = NULL, TPU = 1000, \n         alphag = 0, Rd0 = 0.92, Q10 = 1.92,\n         Rd = NULL, TrefR = 25, Rdayfrac = 1, \n         EaV = 82620.87, EdVC = 0, delsC = 645.1013, \n         EaJ = 39676.89, EdVJ = 2e+05, delsJ = 641.3615,\n         GammaStar = NULL, Km = NULL, Ci = NULL, \n         Tcorrect = TRUE,returnParsOnly = FALSE,\n         whichA = c(\"Ah\", \"Amin\", \"Ac\", \"Aj\"))\n\nAci(Ci, ...)\n\n\n因为是光合气孔导度模型的耦合，故而参数与之前的函数相同，参见 sec. 21.1.1 和 sec. 14 部分的内容。\n\nPhotosyn 使用举例\n\n\nCode\nlibrary(plantecophys)\n# 仅使用下面几个参数运行模型\n#（其他参数使用默认值）\n# 利用已测量或计算的参数\nPhotosyn(VPD=2, g1=4, Ca=500)\n\n\n        Ci    ALEAF        GS    ELEAF       Ac       Aj   Ap   Rd VPD Tleaf\n1 369.3981 14.19466 0.1706377 3.412753 15.12654 17.03685 1000 0.92   2    25\n   Ca       Cc PPFD Patm\n1 500 369.3981 1500  100\n\n\nCode\n# 部分参数相同，而某一参数或某几个参数不同时，\n# 可以将不同的参数设置为一个序列（vectors）\nr <- Photosyn(VPD=seq(0.5, 4, length=25), \n              Vcmax=50, Jmax=100)\nwith(r, plot(VPD, ALEAF, type='l'))\n\n\n\n\n\nFigure 21.1: VPD VS. An\n\n\n\n\n?fig-vpd 显示了不同 VPD 下的光合速率。\n\n\nCode\n# 设定叶肉导度的拟合\nrun1 <- Photosyn(PPFD=seq(50,1000,length=25), \n                 gmeso=0.15, Vcmax=40, Jmax=85)\nwith(run1, plot(PPFD, GS, type='l'))\n\n# 运行ACi曲线数据（提供Ci值而不是计算）\narun1 <- Aci(Ci=seq(50, 1200, length=101), \n             Vcmax=40, Jmax=85)\narun2 <- Aci(Ci=seq(50, 1200, length=101), \n             Vcmax=30, Jmax=70)\nwith(arun1, plot(Ci, ALEAF, type='l'))\nwith(arun2, points(Ci, ALEAF, type='l', lty=5))\n\n\n\n\n\nFigure 21.2: PPFD VS. GS\n\n\n\n\n\n\n\nFigure 21.3: PPFD VS. GS\n\n\n\n\nfig. 21.3 显示不同 Ci 下的光合速率。\n\n\nCode\n# 找出CO2需求和供给的交叉点\n# 设定部分参数\ngs <- 0.2 # 对水的气孔导度\nCa <- 400 # 外部CO2\ngctogw <- 1.57 # 转换系数\ngc <- gs / gctogw # 对 CO2 的气孔导度\n# 需求曲线\np <- Aci(seq(60,500,length=101), Ca=400)\n# 提供气孔导度及交叉点\ng <- Photosyn(GS=gs, Ca=Ca)\n# 交叉点可视化\npar(yaxs=\"i\")\nwith(p, plot(Ci, ALEAF, type='l', \n             ylim=c(0,max(ALEAF))))\nwith(g, points(Ci, ALEAF, pch=19, col=\"red\"))\nabline(gc * Ca, -gc, lty=5)\nlegend(\"topleft\", c(expression(\n  \"Demand:\"~~A==f(C[i])),\n   expression(\"Supply:\"~~A==g[c]*(C[a]-C[i])),\n              \"Operating point\"),\n   lty=c(1,5,-1),pch=c(-1,-1,19),\n   col=c(\"black\",\"black\",\"red\"),\n   bty='n', cex=0.9)\n\n\n\n\n\nFigure 21.4: supply VS. demand\n\n\n\n\nfig. 21.4 需求与供给的关系。\n\n\n\n21.4.2 PhotosynEB 函数\n使用同 Photosyn，只不过使用能量平衡法来计算叶温。\n\n\n\n\n\n\n警告\n\n\n\n目前版本尚存在bug，不能直接提供 GS 来计算，否则会出现未知错误。\n\n\n\n\n21.4.3 PhotosynTuzet 函数\n同样为光合气孔导度耦合模型，只不过基于 Tuzet, Perrier, and Leuning (2003) 的气孔导度模型，现将其描述如下：\n\ng_{co2} = g_0 + \\frac{a A}{C_i - \\Gamma} f_{\\Psi v}\n \\qquad(21.6)\n其中 gco2 为对 CO2 的气孔导度， g0 是残余导度（residual conductance）(在补偿点时限制 gCO2 的值）， A 为光合速率，Ci 为胞间二氧化碳浓度，\\Gamma 为 CO2 补偿点，a 是经验系数。\n一个根据经验的逻辑方程用于描述气孔对水势的敏感性：\n\nf_{\\Psi v} = \\frac{1 + exp(s_f \\Psi_f)}{1 + exp(s_f(\\Psi_f - \\Psi_v))}\n \\qquad(21.7)\n\\Psi_v 是指叶片水势，\\Psi_f 是参比势能， 该方程假设在水势接近于 0 时，气孔对叶片水势不敏感，并且气孔随着 \\Psi_v 的下降快速关闭。\\Psi_f 和 s_f (曲线形状参数) 依赖于不同物种的形态学适应以及生长过程中所处的环境。\n\nPhotosynTuzet 的参数\n除 Tuzet, Perrier, and Leuning (2003) 模型中使用的参数外，其他参数都继承了 Photosyn 的参数\n\n\nCode\nPhotosynTuzet(g1 = 8, Ca = 400, psis = 0,\n              kl = 2, sf = 3, psif = -2,\n...)\n\n\n\ng1：斜率参数，要远比 fitBB 中的大。\nCa：外界大气 CO2 浓度\npsis，土壤水势（Mpa）。\nkl：Leaf-speciﬁc hydraulic conductance（叶片导水参数 (mmol \\cdot m^{-2} \\cdot s^{-1} \\cdot MPa^{-1})，叶片蒸腾量、叶片面积及叶片水势计算）。\nsf：曲线形状参数。\n在气孔导度为最大值 50% 时的叶片水势。\n\n\n\n\n\nBuckley, T. N., S Martorell, A Diazespejo, M Tomàs, and H Medrano. 2014. “Is Stomatal Conductance Optimized over Both Time and Space in Plant Crowns? A Field Test in Grapevine Vitis Vinifera.” Plant Cell & Environment 37 (12): 2707.\n\n\nCowan, I. R., and G. D. Farquhar. 1977. “Stomatal Function in Relation to Leaf Metabolism and Environment.” Symposia of the Society for Experimental Biology 31 (23): 471.\n\n\nDuursma, R. A., and B. E. Medlyn. 2012. “MAESPA: A Model to Study Interactions Between Water Limitation, Environmental Drivers and Vegetation Function at Tree and Stand Levels, with an Example Application to CO_2 Drought Interactions.” Geoscientific Model Development Discussions 5 (4): 919–40.\n\n\nDuursma, Remko A. 2015. “Plantecophys-an r Package for Analysing and Modelling Leaf Gas Exchange Data.” Plos One 10 (11): e0143346.\n\n\nMedlyn, Belinda E., Remko A. Duursma, Derek Eamus, David S. Ellsworth, I. Colin Prentice, Craig V. M. Barton, Kristine Y. Crous, Paolo De Angelis, Michael Freeman, and Lisa Wingate. 2011. “Reconciling the Optimal and Empirical Approaches to Modelling Stomatal Conductance.” Global Change Biology 17 (6): 2134–44.\n\n\nTuzet, A, A Perrier, and R Leuning. 2003. “A Coupled Model of Stomatal Conductance, Photosynthesis and Transpiration.” Plant Cell and Environment 26 (7): 1097–1116."
  },
  {
    "objectID": "gm.html#sec-gm-theory",
    "href": "gm.html#sec-gm-theory",
    "title": "22  叶肉导度计算",
    "section": "22.1 理论",
    "text": "22.1 理论\n从大气中 CO2 扩散到叶绿体中分压的下降与每个步骤的导度成反比：\n\nA=(C_a - C_i) \\cdot g_s/P = (C_i - C_c) \\cdot g_m/P\n \\qquad(22.1)\n这里 P 指的是大气压。这个关于气体扩散的定理自然是后面计算所需的基石。之所以使用分压，是因为气体扩散经过叶肉细胞时，叶肉细胞内是液相空间，而根据 Henry’s law:\n\nP \\propto C (or) P = k_H \\cdot C\n \\qquad(22.2)\n也就是描述气体溶于水的量，与其分压成正比。\n而对于 FvCB 模型，我们一般都认为 RuBP 的羧化受到下面三个因子的限制：\n\nRubisco 的活性，\nRuBP 的再生（或者称为为 J 限制），\n磷酸丙糖代谢为淀粉或蔗糖时正磷酸盐的释放\n\n当 Rubisco 限制阶段，光合作用的描述是：\n\nA = \\frac{V_{cmax} \\cdot C_c}{C_c + K_c \\cdot (1+O/K_O)} \\cdot \\bigg(1-\\frac{\\Gamma^*}{C_c} \\bigg) - R_d\n \\qquad(22.3)\n根据 Henry’s law 替换 Cc：\n\nA = \\frac{V_{cmax} \\cdot (C_i - A/g_m)}{C_c + K_c \\cdot (1+O/K_O)} \\cdot \\bigg(1-\\frac{\\Gamma^*}{C_i - A/g_m)} \\bigg) - R_d\n \\qquad(22.4)\n当处于 RuBP 限制阶段时：\n\nA = J \\cdot \\frac{(C_i - A/g_m) - \\Gamma^*}{4 \\cdot ((C_i - A/g_m) +2\\Gamma^*)} - R_d\n \\qquad(22.5)\n而电子传递速率可以通过辐射的光量子密度来计算：\n\nJ = \\frac{0.24 \\quad PPFD}{(1+0.24^2 \\cdot PPFD^2 / J_{max})^{0.5}}\n \\qquad(22.6)\n而 RuBP 限制阶段的公式也可以用写为电子传递速率的形式：\n\nJ = (A+R_d) \\cdot\\frac{4 \\cdot ((C_i - A/g_m) + 2 \\Gamma^*)}{(C_i - A/g_m)-\\Gamma^*}\n \\qquad(22.7)\n观察上面的公式我们可以看到，这个公式的适用性很广。而计算叶肉导度的方法，不管是可变电子流还是恒定电子流，都与其密切相关。"
  },
  {
    "objectID": "gm.html#sec-constant-j",
    "href": "gm.html#sec-constant-j",
    "title": "22  叶肉导度计算",
    "section": "22.2 恒定电子流",
    "text": "22.2 恒定电子流\n恒定电子流的假设是 J 不随 CO2 的分压而改变。因而，需要一个荧光二氧化碳响应曲线来确定 J 不随 CO2 而变化的范围。一个共识是认为当 PPFD 和其他淬灭参数不变时， J 是恒定的，如果光强小于饱和的 PPFD，很容易得到更广范围的 CO2 分压下 J 是否恒定。该方法尽管存在限制，但是他的优势是可以基于多个气体交换的测量进行计算，从而降低单个测量的误差。"
  },
  {
    "objectID": "gm.html#sec-variale-j",
    "href": "gm.html#sec-variale-j",
    "title": "22  叶肉导度计算",
    "section": "22.3 可变电子流",
    "text": "22.3 可变电子流\n对于可变电子流，只是认为 J 是变化的，但是 J 可以通过叶绿素荧光测量直接获得。\n\ng_m = \\frac{A}{C_i - \\frac{\\Gamma^*[J+ 8 \\cdot(A+ R_d)]}{J - 4 \\cdot (A + R_d)}}\n \\qquad(22.8)\n该方法测量相比来说比较简单。\n\n22.3.1 可变电子流的限制因素\n恒定电子流可以在一系列大的 CO2 跨度下使用，但是要解决 CO2 对 gm 影响的问题，则需要可变电子流的方式。但是可变电子流中参数 Rd，\\Gamma^* 存在不确定性，而对 J 的计算错误则导致整个计算错误。因而作者确定了一个通过 Cc 对 (A+Rd) 斜率的阈值进行判定的计算叶肉导度是否合理的方法。因为：\n\nC_c = \\Gamma^*[J+8\\cdot(A+R_d)]/[J-4 \\cdot(A+R_d)]\n \\qquad(22.9)\n那么：\n\ndC_c/dA = 12 \\cdot \\Gamma^* \\cdot J/[J - 4 \\cdot(A+R_d)]^2\n \\qquad(22.10)\n最终确认的有限的计算数据必须满足 10 < dC_c/dA < 50。这是 fit_g_mc_variable 所采用的合理的叶肉导度相关列所必须满足的条件。"
  },
  {
    "objectID": "gm.html#sec-intro-gm-func",
    "href": "gm.html#sec-intro-gm-func",
    "title": "22  叶肉导度计算",
    "section": "22.4 函数介绍",
    "text": "22.4 函数介绍\n\n\nCode\nfit_g_mc_variableJ(\n  data,\n  varnames = list(A_net = \"A_net\", J_etr = \"J_etr\", C_i = \"C_i\", PPFD = \"PPFD\",\n    phi_PSII = \"phi_PSII\"),\n  usealpha_Q = FALSE,\n  alpha_Q = 0.84,\n  beta_Q = 0.5,\n  gamma_star,\n  R_d,\n  P = 100\n)\n\n\n函数本身参数都比较简单。函数有一个计算数据可靠性的检测，并只使用它检测有效的数据进行拟合进行取平均值，而且他计算的单位是按分压计算的：m^{-2} \\cdot s^{-1} \\cdot Pa^{-1}。\n我使用软件包自带的数据进行演示，当然了 LI-6400 也是可以的，但请参考开始的连接中的文章，来进行相应处理，首先是加载软件包，我们顺便看一下数据：\n\n\nCode\nlibrary(photosynthesis)\ngm_data <- read.csv(\"data/A_Ci_Q_data_1.csv\")\n\n\n然后进行拟合就可以了：\n\n\nCode\ndata <- fit_g_mc_variableJ(\n  gm_data,\n  varnames = list(\n    A_net = \"A\",\n    J_etr = \"ETR\",\n    C_i = \"Ci\",\n    PPFD = \"Qin\",\n    phi_PSII = \"PhiPS2\"\n  ),\n  gamma_star = 46,\n  R_d = 0.153,\n  usealpha_Q = TRUE,\n  alpha_Q = 0.84,\n  beta_Q = 0.5,\n  P = 84\n)\n\n\n我们可以看一下 data 前的数据，仅显示 gsw 和 g_mc(计算的叶肉导度)：\n\n\n\n叶肉导度拟合结果{#tbl-gmc-gs}\n\n\ngsw\ng_mc\n\n\n\n\n0.3458193\n1.1366292\n\n\n0.3409737\n1.0829398\n\n\n0.3460976\n1.1646861\n\n\n0.3666962\n1.0234578\n\n\n0.3977929\n-0.5338358\n\n\n0.4284309\n0.8689417\n\n\n\n\n\n可以看到，是有很多不合理值的，我们可以作图看一下合理的值：\n\n\nCode\nggplot(data, aes(x = CO2_s, y = g_mc, colour = reliable)) +\n  labs(x = expression(CO[2]~\"(\"*mu*mol~mol^{-1}*\")\"),\n       y = expression(g[m]~\"(mol\"~m^{-2}~s^{-1}~Pa^{-1}*\")\")) +\n  geom_point(size = 2) +\n  theme_bw() +\n  theme(legend.position = 'bottom')\n\n\n\n\n\nFigure 22.1: 使用默认作图查看合理值\n\n\n\n\n当然上面的作图来自于 vignette，如果与我一样还没赶上潮流，可以使用 base plot：\n\n\nCode\ncol_sep <- ifelse(data$reliable == TRUE, \"#56B4E9\", \"#CC79A7\")\nwith(data, {\n  plot(CO2_s, g_mc, col = col_sep, \n       xlab = expression(CO[2]~\"(\"*mu*mol~mol^{-1}*\")\"),\n       ylab = expression(g[m]~\"(mol\"~m^{-2}~s^{-1}~Pa^{-1}*\")\"),\n       pch =19, cex = 0.8)\n  legend('bottomright', legend = c('TRUE','FALSE'), pch = 19, col = c(\"#56B4E9\", \"#CC79A7\"))\n})\n\n\n\n\n\nFigure 22.2: 使用基础作图查看合理值\n\n\n\n\n查看前文所讲的斜率判定相关数据：\n\n\nCode\n#Plot QAQC graph according to Harley et al. 1992\nggplot(data, aes(x = CO2_s, y = dCcdA, colour = reliable)) +\n  labs(x = expression(CO[2]~\"(\"*mu*mol~mol^{-1}*\")\"),\n       y = expression(delta*C[c]*\"/\"*delta*A)) +\n  geom_hline(yintercept = 10) +\n  geom_point(size = 2) +\n  theme_bw() +\n  theme(legend.position = 'bottom')\n\n\n\n\n\nFigure 22.3: 外界二氧化碳浓度与判定用斜率作图\n\n\n\n\n\n\nCode\nggplot(data, aes(x = dCcdA, y = g_mc, colour = reliable)) +\n  labs(x = expression(delta*C[c]*'/'*delta*A),\n       y = expression(g[m]~'(mol'~m^{-2}~s^{-1}~Pa^{-1}*')')) +\n  geom_point(size = 2) +\n  theme_bw() +\n  theme(legend.position = 'bottom')\n\n\n\n\n\nFigure 22.4: 判定用斜率与叶肉导度作图\n\n\n\n\n这里数据都已经包含在拟合数据里，想怎么作图可以随意定制。\n\n\n\n\nHarley, Peter C., Francesco Loreto, Giorgio Di Marco, and Thomas D. Sharkey. 1992. “Theoretical Considerations When Estimating the Mesophyll Conductance to Co2 Flux by Analysis of the Response of Photosynthesis to Co2.” Plant Physiology 98: 1429–36."
  },
  {
    "objectID": "other-stat.html",
    "href": "other-stat.html",
    "title": "其他统计方法",
    "section": "",
    "text": "todo 其他常用统计方法记录"
  },
  {
    "objectID": "common-stat.html#sec-test-norm",
    "href": "common-stat.html#sec-test-norm",
    "title": "23  常用统计方法简介",
    "section": "23.1 正态分布检验",
    "text": "23.1 正态分布检验\n\n\n\n\n\n\n注意\n\n\n\n对于是否需要正态分布转换，或怎么判断是不是正态分布，有人提出异议，但这不是我一个不搞科研的人该考虑的，我只提供方法。\n\n\n在进行真正的检验之前，我们很多时候都忽略了进行正态分布的验证。验证是否是正态分布的方法分为两类：\n\n肉眼判断\n假设检验\n\n\n23.1.1 肉眼判断\n肉眼判断当然是一句玩笑话，我们不能只凭看两眼数据就认定是否符合正态分布了，我们是通过其与正太分布的数据相比较，并不是直接做个大仙，看上一眼就解决问题了。那么怎么和正态分布的数据做比较呢，所谓没有比较就没有伤害，在这里也是适用的，有正态分布数据比着，那就好判断了。\n\n直方图和密度曲线的比较\n第一种方法就是对数据做直方图和密度曲线的图，然后看数据是否基本符合正太分布的特征（也就是那个钟形曲线），这里网上关于 R 验证正态分布的时候使用直方图 hist，以及密度曲线要用的 density，其实二者是一回事，我们了解一下核密度估计。\n核密度估计是非参估计的一种，对我们最重要的是不需要先验知识，即可根据数据的本身特点和性质来进行拟合分布，查看数据分布的特点，例如对 iris 的数据的萼片长度的分布进行直方图查看：\n\n\n\niris 数据集{#tbl-kable-iris-norm}\n\n\nSepal.Length\nSepal.Width\nPetal.Length\nPetal.Width\nSpecies\n\n\n\n\n5.1\n3.5\n1.4\n0.2\nsetosa\n\n\n4.9\n3.0\n1.4\n0.2\nsetosa\n\n\n4.7\n3.2\n1.3\n0.2\nsetosa\n\n\n4.6\n3.1\n1.5\n0.2\nsetosa\n\n\n5.0\n3.6\n1.4\n0.2\nsetosa\n\n\n5.4\n3.9\n1.7\n0.4\nsetosa\n\n\n\n\n\n\n\nCode\nhist(\n  iris$Sepal.Length,\n  freq = FALSE,\n  breaks = c(seq(4, 8, 0.05)),\n  main = \"breaks = 0.05\",\n  xlab = NULL\n)\nhist(\n  iris$Sepal.Length,\n  freq = FALSE,\n  breaks = c(seq(4, 8, 0.3)),\n  main = \"breaks = 0.3\",\n  xlab = NULL,\n  ylab = NULL\n)\nhist(\n  iris$Sepal.Length,\n  freq = FALSE,\n  breaks = c(seq(4, 8, 0.5)),\n  main = \"breaks = 0.5\",\n  xlab = \"Sepal Length\"\n)\nhist(\n  iris$Sepal.Length,\n  freq = FALSE,\n  breaks = c(seq(4, 8, 0.8)),\n  main = \"breaks = 0.8\",\n  xlab = \"Sepal Length\",\n  ylab = NULL\n)\n\n\n\n\n\n\n\n\n(a) 0.05 的 bin 长度\n\n\n\n\n\n\n\n(b) 0.3 的 bin 长度\n\n\n\n\n\n\n\n\n\n(c) 0.5 的 bin 长度\n\n\n\n\n\n\n\n(d) 0.8 的 bin 长度\n\n\n\n\nFigure 23.1: iris 数据集花萼长度使用不同分隔长度的直方图\n\n\n\n也就是说，我们划分每组长度的标准（bin 的宽度）不同，肉眼看上去，直方图的形状是有变化的。而且 bin 的宽度不管怎么变化，显示的分布并非是连续的变化，要避免这些问题，就需要引入核密度估计，核密度估计的曲线根据所有点在某个特定位置的权重来计算其在整个分布曲线上的距离，当在某一区域点的数量增加时，估计的概率就会增大。\n\n\nCode\nhist(\n  iris$Sepal.Length,\n  freq = FALSE,\n  xlab = \"Sepal Length\",\n  main = \"Histogram and density of iris sepal length\"\n)\nlines(density(iris$Sepal.Length), col = 2, lwd = 2)\n\n\n\n\n\nFigure 23.2: 添加密度曲线的直方图\n\n\n\n\n需要注意的是，不管怎样，我们很难得到非常完美的，或者理论上的分布曲线，只要曲线有一个峰值并且大致两侧对称，我们就认为是正太分布了。\n\n\n\n23.1.2 Q-Q plot\n相比密度直方图，Q-Q 图可能是更常见更容易理解的一种方式，Q 表示分位点，例如标准的正太分布曲线，0.5 的分位点是零，0.95 的分位点是 1.64。\n它的实现就是使用测量数据和理论分布的数据进行作图，如果测量数据是正态分布，那么很明显，它和理论正态分布所成的散点图应该在一条直线上。\n在 R 里，base plot 可以直接使用 qqnorm 和 qqline 来实现，但 car 包里 qqPlot 的实际上更贴心\n\n\nCode\nlibrary(car)\nqqnorm(iris$Sepal.Length, pch = 21, col = 'blue', main = 'qqplot in base plot')\nqqline(iris$Sepal.Length, col = \"red\", lwd = 3)\n\nqqPlot(iris$Sepal.Length, main=\"qqplot in car package\", col=\"blue\", col.lines=\"red\")\n\n\n\n\n\n[1] 132 118\n\n\n\n\n\n(a) base R 的 qqplot\n\n\n\n\n\n\n\n(b) car 的 qqplot\n\n\n\n\nFigure 23.3: 两种 qqplot 的对比\n\n\n\ncar 会贴心的画出 95% 置信区间，以及 outlier（原始数据）。这个与上面提到的一样，不可能完全在一条直线上，大致是在一起就可以了。\n\n\n23.1.3 假设检验\n上面的肉眼判断毕竟太过主观，要客观的评价，还是需要通过假设检验，用的很多，非常有名的方法为：Shapiro-Wilk 检验，它的零假设是样本来自正态分布的母本，这样的话，我们需要 p 值大于 0.05。\n还是上面的数据：\n\n\nCode\nshapiro.test(iris$Sepal.Length)\n\n\n\n    Shapiro-Wilk normality test\n\ndata:  iris$Sepal.Length\nW = 0.97609, p-value = 0.01018\n\n\n非常简单，一行代码搞定，结果让我们非常失望，数据不是正态分布。事实证明，上面的肉眼判断，我的看法是错误的。\n尽管值略有差别，充分体现了主观的判断的不靠谱。那我们只能试试怎么将数据转换为正态分布的方法了。\n\n\n23.1.4 常用的正态转换方法\n如果样本量超过了30，或者50更好，正态分布的检验并非十分重要。转换为正态分布的方法比较多，下面的一幅图即可概括：\n\n方法这么多，其实也没太多特别的，就是将数据转换一下，例如我们使用最简单的对数转换看一下：\n\n\nCode\nshapiro.test(log10(iris$Sepal.Length))\n\n\n\n    Shapiro-Wilk normality test\n\ndata:  log10(iris$Sepal.Length)\nW = 0.98253, p-value = 0.05388\n\n\n其他方法有需要的可以尝试一下。"
  },
  {
    "objectID": "common-stat.html#sec-t-test-start",
    "href": "common-stat.html#sec-t-test-start",
    "title": "23  常用统计方法简介",
    "section": "23.2 t 检验",
    "text": "23.2 t 检验\n关于t 检验，有的资料上特意强调主要用于样本含量较小（n<30）这一点，实际上 t 检验并非特意需要降低样本量，来自于我多年前本科时候的印象里，样本量小是不得以的选择，好像是啤酒酿造的时候的检验，样本量低，并非是特意控制到较低的数量，我查了一下网上的资料，并没有找到他起源的具体说法，但我已经没有读书时的生物统计课本了，因此只好做罢，各位有来源的可以告知。实际上 t 检验并没有限制样本的数量，资料上反而讲到，t分布是接近标准正态分布的钟型分布，当样本量大于 30 时，通常使用正态分布。也就是说只要是正态分布或近似正态分布，就可以使用 t 检验。\nt检验是用 t 分布理论来推论差异发生的概率，他的检验有三种类型：\n\none-sample t-test，用来比较单个样本平均值和一个给定的平均值（理论值）的差异\n\n例如，假设我们调查了一组男学生的身高，看看他们的平均值是否等于 170 cm。\n\nindependent samples t-test（ unpaired two sample t-test），完全随机设计 (两组独立样本) 两样本均数比较的差异\n\n例如，我要检查某有机肥是否有促进小麦品质的作用，我选了一组小麦施用该肥料，另一组施用常规化肥，最后我检查某指标之间，二者是否有差异。两组不同的小麦，他们之间是没有关系的，独立的\n\npaired t-test，用于表两个相关的样本组之间的差异（与 0 比较）\n\n例如，我要检验某杀虫剂是否有效果，我随机抽取一定样本，记录杀虫前后虫子的量。二者来自同一样本，是密切相关的。\n下面的内容我们就用胡诌的例子和数据来演示相关的分析。\n\n23.2.1 单样本 t 检验\n例如，我们制定了一个标准，对于针对某虫害的杀虫剂，以一定的量喷洒 2 h 后，虫子的数量应减少 70%，下面我们来瞎编 16 个样本 2 h 后虫子数据降低量的数据：\n\n\nCode\nset.seed(321)\npct_pesticide <- sample(seq(0.6, 0.8, by = 0.02), 16, replace = TRUE)\n\n\n为了满足条件，我们可以用 Q-Q 图看一下数据是否基本符合正态分布 (当然可以使用正态分布的随机数，但是那样有点太假了，我尽量把数据造的接近真实点)：\n\n\nCode\nqqnorm(pct_pesticide)\nqqline(pct_pesticide)\n\n\n\n\n\nFigure 23.4: 检验造假数据是否符合正态分布\n\n\n\n\n从图上看，尽管有点散乱，但还是满足我们正态分布的要求的。这里仅作为演示，后面的内容，为节省篇幅，不在针对造的数据验证了。\n下面我们就是来进行检验了，那我们的 0 假设是二者相等，那么备择假设呢，我们可以选择这个药结果比较好，效果大于 0.7：\n\n\nCode\nt.test(pct_pesticide, mu = 0.7, alternative = 'greater')\n\n\n\n    One Sample t-test\n\ndata:  pct_pesticide\nt = 0, df = 15, p-value = 0.5\nalternative hypothesis: true mean is greater than 0.7\n95 percent confidence interval:\n 0.6684776       Inf\nsample estimates:\nmean of x \n      0.7 \n\n\n上面的结果是 p 值比较大，我们接受零假设，说明该杀虫剂合格，但他仅仅是刚刚合格，没有接受备择假设。\n那如果我们的备择假设是该药品不合格，低于 0.7，会有差别吗？\n\n\nCode\nt.test(pct_pesticide, mu = 0.7, alternative = 'less')\n\n\n\n    One Sample t-test\n\ndata:  pct_pesticide\nt = 0, df = 15, p-value = 0.5\nalternative hypothesis: true mean is less than 0.7\n95 percent confidence interval:\n      -Inf 0.7315224\nsample estimates:\nmean of x \n      0.7 \n\n\n其实看 p 值我们就明白了，备择假设没有影响我们的这个结果，那我们的备择假设如果选择 two.side，也就是默认选项呢？\n\n\nCode\nt.test(pct_pesticide, mu = 0.7)\n\n\n\n    One Sample t-test\n\ndata:  pct_pesticide\nt = 0, df = 15, p-value = 1\nalternative hypothesis: true mean is not equal to 0.7\n95 percent confidence interval:\n 0.6616734 0.7383266\nsample estimates:\nmean of x \n      0.7 \n\n\n对于这个实验，没有影响结果，结论是接受 H0，但我们可以看一下另外的一组数据：\n\n\nCode\npct_high <- sample(seq(0.8, 0.96, by = 0.02), 16, replace = TRUE)\nt.test(pct_high, mu = 0.7)\n\n\n\n    One Sample t-test\n\ndata:  pct_high\nt = 13.027, df = 15, p-value = 1.396e-09\nalternative hypothesis: true mean is not equal to 0.7\n95 percent confidence interval:\n 0.8547314 0.9152686\nsample estimates:\nmean of x \n    0.885 \n\n\nCode\nt.test(pct_high, mu = 0.7, alternative = 'less')\n\n\n\n    One Sample t-test\n\ndata:  pct_high\nt = 13.027, df = 15, p-value = 1\nalternative hypothesis: true mean is less than 0.7\n95 percent confidence interval:\n     -Inf 0.909895\nsample estimates:\nmean of x \n    0.885 \n\n\nCode\nt.test(pct_high, mu = 0.7, alternative = 'greater')\n\n\n\n    One Sample t-test\n\ndata:  pct_high\nt = 13.027, df = 15, p-value = 6.979e-10\nalternative hypothesis: true mean is greater than 0.7\n95 percent confidence interval:\n 0.860105      Inf\nsample estimates:\nmean of x \n    0.885 \n\n\n可以看到如果是双尾的检验，那么对我们这个例子是不合适的，我们不知道杀虫剂是否合格，对于单尾的检验，备择假设是杀虫剂不合格，它的 p 值是 1，也就意味着我们 100% 不可能选择备择假设，杀虫率不能低于 70%，尽管看上去奇怪，但也能判断结果，最后一个备择假设则是看上去最正常的，说明杀虫剂效果高于我们制定的标准。所以，备择假设是不能随便假设的，以免增加工作量。\n\n\n23.2.2 独立样本 t 检验\n独立样本的检验就不造数据了，还是 iris 吧，我们这次改为花萼宽度，看两个种之间有没有明显差别。\n\n\nCode\nlibrary(data.table)\niris <- data.table(iris)\nt.test(iris[Species == \"setosa\", Sepal.Width], iris[Species == \"versicolor\", Sepal.Width])\n\n\n\n    Welch Two Sample t-test\n\ndata:  iris[Species == \"setosa\", Sepal.Width] and iris[Species == \"versicolor\", Sepal.Width]\nt = 9.455, df = 94.698, p-value = 2.484e-15\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n 0.5198348 0.7961652\nsample estimates:\nmean of x mean of y \n    3.428     2.770 \n\n\np 值太小，也就是接受备择假设，这两个之间的差异不为 0。\n\n\n23.2.3 配对样本的 t 检验\n配对样本和独立样本，最大的区别就是二者是否独立，配对当然是不独立，上个样本有现成的数据，这个我觉得还是再造点看上去真实的数据吧，为了省事，我提高样本量，不检测是不是近似正态分布了：\n假设我在测量高温短时间内对植物光合的影响，我想知道 35 摄氏度和 40 摄氏度对光合速率影响有没有显著差别，为避免其他效应的影响，我控制其他参数不变，植物处于饱和光照射下已经达到稳定状态，我在两个温度下连续测量了两个稳定的光合速率：\n\n\nCode\nset.seed(123)\nA35 <- sample(seq(10, 13, by = 0.1), 50, replace = TRUE)\nA40 <- sample(seq(7, 10, by = 0.1), 50, replace = TRUE)\nwrite.csv(data.frame(a35= A35, a40 = A40), \"data/photosyn_temp.csv\")\n\n\n还是用第一次的数据，到处后供 python 继续使用。\n\n\nCode\npair_data <- read.csv(\"data/photosyn_temp.csv\")\nt.test(pair_data$a35, pair_data$a40, paired = TRUE)\n\n\n\n    Paired t-test\n\ndata:  pair_data$a35 and pair_data$a40\nt = 16.747, df = 49, p-value < 2.2e-16\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n 2.569619 3.270381\nsample estimates:\nmean of the differences \n                   2.92 \n\n\n结论符合我故意让他们有差距的目的。"
  },
  {
    "objectID": "pca.html#sec-geom-pca",
    "href": "pca.html#sec-geom-pca",
    "title": "24  大话 PCA",
    "section": "24.1 几何解释",
    "text": "24.1 几何解释\nPCA 通常能够反映我们复杂数据集的一些分布特征，例如典型的 iris 数据集，我们看到了三个鸢尾种的四个性状：花萼的长宽、花瓣的长宽，如果给我们这么一个数据，我们肉眼很难看出他们的特征来，如果作图也很难表达，因为这是一个四维的数据，假设我们只对前两组也就是花萼的长宽作图，先看一下二维的数据情况：\n\n\nCode\nplot(log(iris$Sepal.Length), log(iris$Sepal.Width))\n\n\n\n\n\nFigure 24.1: 二维数据的关系\n\n\n\n\n看上去一言难尽，此时的缺点非常明显，图中的每个点均代表了某个植株的两个性状，这个性状类似于我们说的电子云，杂乱而无规律。这还只是二维数据，如果我们将所有四个轴的数据都显示也就是四维的数据，那么对于我等肉眼凡胎来讲，还是不看为妙。\n我在看到上面留的两个网址之前，对主成份分析的疑惑一直没断过，什么是主成份，一直说是主轴旋转，到底是怎么旋转的，我们看一下主成份的 PC1 是怎么来做的:\n\n\n\nFigure 24.2: 数据的中心化\n\n\nfig. 24.2 假设有三维的数据，可以理解为 iris 数据中前三列的观测值，每个点分别代表了一个植株的前三个性状，PCA 第一步便是中心化，将坐标轴由左边转移到右边的中心点位置作为原点，这就是所谓的平均值中心化的过程，这样就消除了测量时的偏差 1，同时一般还要对数据进行缩放，以消除不同单位的影响 2， 例如有光合速率，有叶片面积的数据，这样能够消除不同单位的影响，通常的缩放例如对数化。\n\n\n\nFigure 24.3: PC1 的诞生\n\n\n移动坐标系后，因为进行了缩放，所有的数据具有相同的比例。我们这时做一条最佳的拟合线 fig. 24.3，此时发生了两件重要的事情：\n\n所有的点投影到这条拟合线上，投影后的点之间的距离是最大的，该方向代表了所有变异最大，也就是最大化的区分所有的数据点，因为我们的目的就是要区分数据点之间的差异。如果在读的各位有跟我一样空间想象力有限的，可以根据图 fig. 24.4 的极端情况来理解，蓝色线为最佳拟合线，红色的数据点投影到其上的距离之和当然大于投影到蓝色的拟合线上。\n\n\n\nCode\nplot(1:5, col=\"red\")\nlines(1:5, col=\"blue\")\nabline(3,0,col=\"green\")\n\n\n\n\n\nFigure 24.4: 变异最大的极端情况\n\n\n\n\n\n所有点和他们相对应的点之间的距离是最小的（也就是残差最小，最佳拟合当然是残差最小），这保证了这些投影的点和原来的数据点尽可能接近，也就是变化后损失的信息最少。\n\n以上变化的最终结果是将变异放到最大而误差降低到最小，我们研究的最终目的无非就是这样。这个最佳拟合的线我们将其称之为 PC1，主成份1。\n\n\n\nFigure 24.5: PC2 的诞生\n\n\n如果我们做一条通过中心点并与 PC1 垂直的线，并不断旋转这条线使其满足：所有投影于其上的点，他们的距离最大，也就是变异最大，这样就做出了第二个主成份，PC2，如图 fig. 24.5。就这样不断的变换，一般情况下，我们可以使用 2~3 个主成份来解释绝大部分数据所展示的信息（所有数据都尽可能少的损失信息投影于其上）。\n以上为基本变换，如果我们使用 R 计算 PCA (这里推荐两个包 factoextra 和 FactoMineR)，查看其结果：\n\n\nCode\nlibrary(\"FactoMineR\")\nlibrary(\"factoextra\")\n\nir <- iris[, 1:4]\nir_pca <- PCA(ir, graph = FALSE)\n\nfviz_eig(ir_pca, addlabels = TRUE)\n\n\n\n\n\nFigure 24.6: iris 碎石图\n\n\n\n\n我们可以看到，前两个成分可以解释数据 95% 以上的变异，所以我们可以只使用主成份 1 和主成份 2 对我们的结果进行解释。\n既然我们使用两个主成份解释整个数据，那么我们怎么把四个性状都放在这个图上呢？这就需要载荷图来展示了，如图 fig. 24.7\n\n\nCode\nfviz_pca_var(ir_pca)\n\n\n\n\n\nFigure 24.7: iris 载荷图\n\n\n\n\n因为原始的数据点相当于在坐标轴上，这几个性状分布的产生类似于原始的数据点在拉拽某个性状，影响强的偏向某一方向，换句话说，这些性状决定主成份时有不同的权重，也就是对主成份影响的权重大小。同时他们是有方向的，如果两个性状方向接近，也就是夹角非常小，说明他们有较强的正相关性，例如图中的花瓣的长宽，如果他们互相垂直，那说明他们无相关性，例如图中花萼的长宽，如果夹角非常大，例如他们几乎在一条直线上，说明具有显著的负相关。其本质还是所有的单位向量（本例有四个性状，各个性状中心化后形成的轴，也就是向量）在现在的这个二维平面的位置。\n而如果我想通过这些性状来对鸢尾分类，怎么看呢？那就需要得分图来展示了，如图 fig. 24.8 ，得分图本质是各个品种的每个观测值在各个轴上的长度，也就是得分，所以其值都是每个物种性状的加权，每个点代表了每个物种的观测值。\n\n\nCode\nfviz_pca_ind(ir_pca, repel = TRUE, col.ind= iris$Species)\n\n\n\n\n\nFigure 24.8: iris 得分图\n\n\n\n\n我们明显看出来，PC1 方向，三个种的鸢尾分成了两大部分，其中 Setosa 延 PC1 同其他两个明显有区别，另外两个在 PC1 上也有较明显的区别，但二者有一定的重合，延 PC2 方向上，三者差别不大。或者反过来讲也可以，品种的差别对 PC1 影响比较显著，这也和我们的碎石图相匹配。"
  },
  {
    "objectID": "pca.html#sec-alge-pca",
    "href": "pca.html#sec-alge-pca",
    "title": "24  大话 PCA",
    "section": "24.2 线性代数解释",
    "text": "24.2 线性代数解释\n\n24.2.1 特征向量与特征值\n特征向量和特征值的数学描述为：\n\nA \\vec{x} = \\lambda \\vec{x}\n \\qquad(24.1)\n其中 A 为 n \\times n 的矩阵，\\vec{x} 为非零 n \\times 1 列向量，\\lambda 是标量，那么 \\vec{x} 为 A 的特征向量，\\lambda 为 A 的特征值。\n如果仅从数学描述上看，是十分不适合我这样没基础的人来理解的，但我们可以这么理解：\nA 为我们观测值（也即我们生态学上测量的数据）组成的 n \\times n 矩阵，每行的数据代表了一个观测值，例如光合速率是其中的一行，我们有n 个， 那么 \\vec{x} 和 \\lambda 意味着什么呢？再看一眼上面的 eq. 24.1，这是一个等式，而 \\vec{x} 是 n \\times 1 维度，原来的数据是 n \\times n 维度，这就是主轴分析是降维分析的意义了，一个一维的特征向量和特征值与我们多维的观测值之间有一个相等的关系。当然，也有很多人在描述时喜欢用坐标轴旋转或这投影来形容的，如果你觉得这样好理解也没问题，不过我脑袋不擅长想象这种多维的空间。这样描述并不十分准确，只是我觉得便于理解，更正确描述应为我们下面所述的例子 (Smith (2002)) ，但降维的原理即来自此处：\n\nfinaldata = rowfeaturevector \\times rowdataajust\n \\qquad(24.2)\nfinaldata 很好理解，我们用于 PCA 的最终数据，rowfeature vector 则是我们根据协相关矩阵求得的特征向量的转置，最大的特征向量再最上面， rowdataadjust 则为原始数据减去标准值。\n因为我手头没有相关的数据，想来想去，我们在 R 里见到最多的与生态学相关的数据也就是 iris，一个关于不同 iris 品种的叶片性状相关的数据，非常生态，我们还是继续使用：\n数据并不复杂，但是想要得出一些规律性的东西确不那么容易，因为数据量太大了。R 语言里面很多函数可以直接实现 PCA，例如 sec. 24.1 内容。这里按照最原始的方法实现一下，加深对原理的理解：\n\n\n24.2.2 手动实现过程\n\n均值的计算\n\n\nCode\niris_mean <- apply(iris[, 1:4], 2, function(x) x - mean(x))\n\n\n我只使用了前四列的性状数据，仅仅是方便结果的展示。\n\n\n计算协方差矩阵\n\n\nCode\niris_cov <- cov(iris_mean)\n\n\n\n\n计算特征值和特征向量\n\n\nCode\niris_eigen <- eigen(iris_cov)\n\n\n这里就可以看到之前提到的，特征值和特征向量是根据协方差矩阵计算的。我们选取特征值最大的两个，他们的特征值之和已经占所有的特征值之和相当大的比例：\n\n\nCode\nsum(iris_eigen$values[1:2])/sum(iris_eigen$values)\n\n\n[1] 0.9776852\n\n\n也就是说特征值对应的前两项是我们最终降维所需要的，即最终的两个主轴为 150 \\times 2 维矩阵，即我们原来的 150 \\times 4 的矩阵乘以我们选取的前两个特征值对应的 4 \\times 2 组成的矩阵。\n实际应用中我们不需要这么做了，因为太浪费时间了，我们直接用函数来得到结果即可。\n\n\n\n24.2.3 prcomp 的实现\n我们用 prcomp 来简化实现过程，注意，根据 Kemp (2003)，我们把 iris 数据对数化一下，并提取所有物种名字：\n\n\nCode\ndata(\"iris\")\niris_pca <- log(iris[, 1:4])\niris_species <- iris$Species\n\n\n需要注意，我们处理时使用特征中心化。即每一维的数据都减去该维的均值。这里的“维”指的就是一个特征（或属性），变换之后每一维的均值都变成了0 (参考 eq. 24.2 )。\n\n\nCode\nvalue_pca <- prcomp(iris_pca, center = TRUE, scale. = TRUE)\n## 查看结果\nsummary(value_pca)\n\n\nImportance of components:\n                          PC1    PC2     PC3     PC4\nStandard deviation     1.7125 0.9524 0.36470 0.16568\nProportion of Variance 0.7331 0.2268 0.03325 0.00686\nCumulative Proportion  0.7331 0.9599 0.99314 1.00000\n\n\n可以看到结果同我们最开始的计算相似，不同的是我们进行了对数化，而且根据 Kemp (2003)， 这个结果更合适。\n\n\n\n\nKemp, Freda. 2003. “Modern Applied Statistics with s.” Journal of The Royal Statistical Society Series D-the Statistician 52 (4): 704–5.\n\n\nSmith, Lindsay I. 2002. “A Tutorial on Principal Component Analysis.”"
  },
  {
    "objectID": "smatr.html#sec-sma-func",
    "href": "smatr.html#sec-sma-func",
    "title": "25  标准主轴分析介绍",
    "section": "25.1 sma 函数的参数介绍",
    "text": "25.1 sma 函数的参数介绍\n我还是使用软件包自带的数据，然后结合 Warton et al. (2012) 文章的内容，在尽量详细解释一下参数的意思和返回的结果，期望能使得各位不会的能够看懂。\n这个软件包的最重要的函数为 sma，\n\n\nCode\nsma(\n  formula,\n  data,\n  subset,\n  na.action,\n  log = \"\",\n  method = c(\"SMA\", \"MA\", \"OLS\"),\n  type = c(\"elevation\", \"shift\"),\n  alpha = 0.05,\n  slope.test = NA,\n  elev.test = NA,\n  multcomp = FALSE,\n  multcompmethod = c(\"default\", \"adjusted\"),\n  robust = FALSE,\n  V = matrix(0, 2, 2),\n  n_min = 3,\n  quiet = FALSE,\n  ...\n)\n\n\n其参数的意义下面就分开详细解释\n\n25.1.1 formula\nR 中的 formula 对象，通过不同的写法可以得到不同的目的，具体如下面的叙述。\n\n单样本检验\n这里但从名字上即可以看出，这应该属于上图 A 的检验，这里使用的 formula 的形式为：\n\nsma(y~x)，拟合 SMA 并构造真正斜率和截距的的置信区间。\nsma(y~x, slope.test = B)，检验 SMA 的斜率是否为 B。\nsma(y~x, elev.test = A)，检验 SMA 的截距是否为 A\nsma(y~x, robust = T)，使用 Huber 的 M 估计进行拟合，我对这种回归不了解，不过应该属于稳健回归的范畴，也就是帮助文档里所讲的，对野点的处理比较好。\nsma(y~x-1)， 强制从原点通过的拟合。也就是这时候没有截距的差异，或者对截距的差异不感兴趣。\n\n\n\n多个样本检验\n也就是对多个直线进行比较，有多种分组的方式：\n\nsma(y~x*groups)，也就是检验所有的分组有没有共同斜率。\nsma(y~x+groups, type = \"elevation\")，检验具有共同斜率的分组有无共同截距。\nsma(y~x*groups, type = \"shift\")，检验斜率是否沿着主轴方向有漂移。\nsma(y~x+groups, slope.test = \"B\")，检验共同斜率是否为 B。\nsma(y~x+groups, elev.test = \"A\")，建议共同截距是否为 A。\nsma(y~x*groups-1)，同单个样本的检验，也可以检验主轴方向的漂移。\n\n\n\n多重比较\n当 multcomp = TRUE 时，会进行各个水平间的多重比较，包括斜率、截距和沿着主轴的漂移（取决于使用的 formula）。\n\n\n拟合结果\n讲到这里应该继续讲函数的参数，不过我觉有必要在这里趁热打铁了，因为我觉得讲完了 formula 的几种形式，SMA 就讲完了，我们有必要把拟合结果顺带解释一下：\n\ncoef：拟合的参数，如果有多个样品的比较，将返回模型的参数，例如检验共同斜率时各个样品或者分组的斜率\nnullcoef：零假设的参数。\nalpha：见下文的参数解释\nmethod：拟合使用的方法， ’MA’ 或 ’SMA’。\nintercept：拟合的线是否强制通过原点。\ncall：调用 ma 或 sma 函数。\ndata: 见下文的参数\nlog： 见下文的参数\nvariables： SMA 的线使用的变量\norigvariables：如有在拟合前有转换，转换前的变量列表\ngroups：分组变量的水平\ngt：grouptest 缩写，表示分组测试的类型\ngtr：分组测试的结果\nslopetest：斜率假设检验的结果，以列表形式输出，包括 p 值、 检验统计、共同斜率 b 和置信区间 ci。\nelevtest：截距假设检验的结果，返回 p 值、t检验统计、共同截距和它的置信区间。\nslopetestdone：是否进行斜率检验\nevevtestdone：是否进行斜率的检验\nn：样品的大小\nr2：决定系数\npval：统计结果的 p 值\nfrom， to：在作图 plot.sma 作图时使用的拟合线的的端点\ngroupsummary：以数据框整理的分组参数\n\n\n\n无需详细解释的参数\nsma 中其他无需详细解释的参数：\n\ndata： 包含 x 和 y 变量的数据框\nsubset：用于拟合的数据框的子集，非必须选项。\nna.action: R 中对 na 值处理的方式，例如删除等。\nlog：对变量使用以 10 为底的对数转换。\nmethod：如果等于 SMA 为标准主轴分析，MA 为主轴分析，或者选择 OLS，最小二乘法。\ntype：如果多条线进行比较，我们应该选择的选项，如 elevation 或 shift。\nalpha：我们置信区间里使用的 \\alpha，默认 0.05。\nslope.test: 假设检验使用的值，也就是与某一个值差异是否显著时使用。\nelev.test：与 slope.test 类似，只不过是检验截距。\nrobust：如果为 TRUE，使用文件回归分析，目前仅针对单样本检验。\nV：测量误差的变异矩阵，默认无。\nn_min：一个分组最小的样品数量\nquiet：如果为 TRUE，不提示任何信息\nmultcomp：如果为 TRUE，则进行多重比较\nmultcompmethod： 多重比较 p 值的方法。"
  },
  {
    "objectID": "smatr.html#sec-sma-example",
    "href": "smatr.html#sec-sma-example",
    "title": "25  标准主轴分析介绍",
    "section": "25.2 自带数据的例子",
    "text": "25.2 自带数据的例子\n安装从 CRAN 上进行即可：\n\n\nCode\ninstall.packages('smatr')\n\n\n我们来使用自带的数据进行分析示例，先加载需要的软件包和数据：\n\n\nCode\nlibrary(smatr)\ndata(leaflife)\n\n\n对于我们生态学人来说，数据浅显易懂，地点，降雨量，土壤 P 含量，叶片寿命、比叶面积几个数据：\n\n\nCode\nkable(head(leaflife), caption = \"示例数据{#tbl-sma-data}\")\n\n\n\n示例数据{#tbl-sma-data}\n\n\nsite\nrain\nsoilp\nlongev\nlma\n\n\n\n\n1\nhigh\nhigh\n1.1145511\n125.48736\n\n\n1\nhigh\nhigh\n0.5161786\n82.28108\n\n\n1\nhigh\nhigh\n0.9718517\n71.02316\n\n\n1\nhigh\nhigh\n0.6722023\n94.66730\n\n\n1\nhigh\nhigh\n1.0947123\n119.70161\n\n\n1\nhigh\nhigh\n2.0606299\n205.82589\n\n\n\n\n\n\n25.2.1 单个样品的分析\n我感觉单个样品的分析用的比较少，但不排除有些情况适用，我们看一下下面的结果\n\n\nCode\n# 单个样品分析 --------------------------------------------------------\n# 仅使用降雨和营养都是低的数据\nleaf_low <- subset(leaflife, soilp == 'low' & rain == 'low')\n# 仅拟合 SMA 的斜率和截距，实际很少单独用\nsma(longev ~ lma, log='xy', data=leaflife)\n\n\nCall: sma(formula = longev ~ lma, data = leaflife, log = \"xy\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nCoefficients:\n            elevation    slope\nestimate    -2.698800 1.315031\nlower limit -3.224305 1.096261\nupper limit -2.173295 1.577457\n\nH0 : variables uncorrelated\nR-squared : 0.4544809 \nP-value : 4.0171e-10 \n\n\nCode\n# 检验斜率是否与 1 差异显著\nma_test <- ma(longev ~ lma, log='xy', slope.test=1, data=leaflife)\nsummary(ma_test)\n\n\nCall: sma(formula = ..1, data = ..4, log = \"xy\", method = \"MA\", slope.test = 1) \n\nFit using Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nCoefficients:\n            elevation    slope\nestimate    -3.085214 1.492616\nlower limit -3.968020 1.146777\nupper limit -2.202407 2.001084\n\nH0 : variables uncorrelated\nR-squared : 0.4544809 \nP-value : 4.0171e-10 \n\n------------------------------------------------------------\nH0 : slope not different from 1 \nTest statistic : r= 0.3515 with 65 degrees of freedom under H0\nP-value : 0.0035393 \n\n\n上面的结果 H0 的 p 值仅为 0.003，也就是发生的概率太小，我们拒绝 H0，有显著差异，实际上斜率为 1.49，也很明显。\n\n\n25.2.2 多个样品的分析\n我们先对降雨量低的数据的性状进行分析：\n\n\nCode\nlow_rain <- subset(leaflife, rain == 'low') \n\n# SMA 单独拟合不同降雨区的数据，检验其有无共同斜率\ndiff_rain <- sma(longev~lma*soilp, log=\"xy\", data = low_rain)\nsummary(diff_rain)\n\n\nCall: sma(formula = longev ~ lma * soilp, data = low_rain, log = \"xy\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 3.943 with 1 degrees of freedom\nP-value : 0.047076 \n------------------------------------------------------------\n\nCoefficients by group in variable \"soilp\"\n\nGroup: high \n            elevation     slope\nestimate    -2.523634 1.1825381\nlower limit -3.135266 0.9398479\nupper limit -1.912003 1.4878965\n\nH0 : variables uncorrelated.\nR-squared : 0.7392636 \nP-value : 1.462e-07 \n\nGroup: low \n            elevation    slope\nestimate    -3.837710 1.786551\nlower limit -5.291926 1.257257\nupper limit -2.383495 2.538672\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n\n\n我们看到 H0 : slopes are equal 的概率是 0.047，也就是无共同斜率，图形也佐证了该点：\n\n\nCode\nplot(diff_rain)\n\n\n\n\n\nFigure 25.3: 多个分组无共同斜率\n\n\n\n\n我们就无需在检验截距和延主轴的漂移了，差异足够明显。\n\n\n25.2.3 多个样品无共同斜率\n下面的数据时无共同斜率的情况，我就不一一解释了：\n\n\nCode\n# 检查共同斜率 --------------------------------------\n# 查看低土壤营养的数据\nlow_soilp <- subset(leaflife, soilp == 'low')\n\n# 以降雨的高低为分组，分别拟合，检验是否有共同斜率\ncom_test <- sma(longev~lma*rain, log=\"xy\", data=low_soilp )\nsummary(com_test)\n\n\nCall: sma(formula = longev ~ lma * rain, data = low_soilp, log = \"xy\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation     slope\nestimate    -2.321737 1.1768878\nlower limit -3.475559 0.7631512\nupper limit -1.167915 1.8149286\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nGroup: low \n            elevation    slope\nestimate    -3.837710 1.786551\nlower limit -5.291926 1.257257\nupper limit -2.383495 2.538672\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n\n\n\n\nCode\nplot(com_test)\n\n\n\n\n\nFigure 25.4: 具有共同斜率的图形\n\n\n\n\n结论: H0 : slopes are equal. P 为 0.13，也就是接受 h0\n\n\nCode\n# 检查斜率与 1 是否差异显著 -------------------------------------------------------------\nlow_soilp_b <- sma(longev~lma*rain, log=\"xy\", slope.test=1, data=low_soilp)\nsummary(low_soilp_b)\n\n\nCall: sma(formula = longev ~ lma * rain, data = low_soilp, log = \"xy\", \n    slope.test = 1) \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nH0 : common slope not different from 1 \nLikelihood ratio statistic = 8.677 with 2 degrees of freedom under H0\nP-value : 0.013057 \n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation     slope\nestimate    -2.321737 1.1768878\nlower limit -3.475559 0.7631512\nupper limit -1.167915 1.8149286\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nH0 : slope not different from 1 \nTest statistic: r= 0.1975 with 15 degrees of freedom under H0\nP-value : 0.44733 \n\nGroup: low \n            elevation    slope\nestimate    -3.837710 1.786551\nlower limit -5.291926 1.257257\nupper limit -2.383495 2.538672\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n\nH0 : slope not different from 1 \nTest statistic: r= 0.8126 with 8 degrees of freedom under H0\nP-value : 0.0042704 \n\n\nCode\n# 结论： H0 : slope not different from 1 ，p 为 0.004，拒绝 h0\n\n\n# 检查共同截距 -------------------------------------------------------------\nlow_soilp_elev <- sma(longev~lma+rain, log=\"xy\", type = \"elevation\", data=low_soilp)\nsummary(low_soilp_elev)\n\n\nCall: sma(formula = longev ~ lma + rain, data = low_soilp, log = \"xy\", \n    type = \"elevation\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nH0 : no difference in elevation.\nWald statistic: 6.566 with 1 degrees of freedom\nP-value : 0.010393 \n------------------------------------------------------------\n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation    slope\nestimate    -3.140896 1.551400\nlower limit -4.079825 1.109374\nupper limit -2.201966 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nGroup: low \n            elevation    slope\nestimate    -3.304865 1.551400\nlower limit -4.353328 1.109374\nupper limit -2.256403 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n\n\n\n\nCode\nplot(low_soilp_elev)\n\n\n\n\n\nFigure 25.5: 共同截距差异显著的图形\n\n\n\n\n结论： H0 : no difference in elevation. p 为 0.01 共同截距有显著差异\n\n\nCode\n# 检查延主轴有无漂移 -------------------------------------------------------------\nlow_soilp_shift <-  sma(longev~lma+rain, log=\"xy\", type=\"shift\", data=low_soilp)\nsummary(low_soilp_shift)\n\n\nCall: sma(formula = longev ~ lma + rain, data = low_soilp, log = \"xy\", \n    type = \"shift\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nH0 : no shift along common axis.\nWald statistic: 0.2091 with 1 degrees of freedom\nP-value : 0.64745 \n------------------------------------------------------------\n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation    slope\nestimate    -3.140896 1.551400\nlower limit -3.475559 1.109374\nupper limit -1.167915 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nGroup: low \n            elevation    slope\nestimate    -3.304865 1.551400\nlower limit -5.291926 1.109374\nupper limit -2.383495 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n\n\n结论： H0 : no shift along common axis. p 为 0.64，接受 h0，无延主轴方向的漂移。\n\n\n\n\nWarton, David I, Remko A Duursma, Daniel S Falster, and Sara Taskinen. 2012. “Smatr 3– an r Package for Estimation and Inference about Allometric Lines.” Methods in Ecology and Evolution 3 (2): 257–59.\n\n\nWarton, David I, Ian J Wright, Daniel S Falster, and Mark Westoby. 2006. “Bivariate Line‐fitting Methods for Allometry.” Biological Reviews 81 (2): 259–91."
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "26  参考文献",
    "section": "",
    "text": "Aganchich, B, S Wahbi, F Loreto, and M Centritto. 2009. “Partial Root Zone Drying: Regulation of Photosynthetic Limitations and Antioxidant Enzymatic Activities in Young Olive (Olea Europaea) Saplings.” Tree Physiology 29 (5): 685.\n\n\nBall, J. Timothy, Ian E. Woodrow, and Joseph A. Berry. 1987. A Model Predicting Stomatal Conductance and Its Contribution to the Control of Photosynthesis Under Different Environmental Conditions. Springer Netherlands.\n\n\nBall, John, Ian Woodrow, and Joseph Berry. 1987. “A Model Predicting Stomatal Conductance and Its Contribution to the Control of Photosynthesis Under Different Environmental Conditions.” Progress in Photosynthesis Research 4 (January): 221–24. https://doi.org/10.1007/978-94-017-0519-6_48.\n\n\nBaly, EC. 1935. “The Kinetics of Photosynthesis.” Proceedings of the Royal Society of London Series B (Biological Sciences), no. 117: 218–39.\n\n\nBernacchi, Carl J., Archie R. Portis, Hiromi Nakano, Susanne von Caemmerer, and Stephen P. Long. 2002. “Temperature Response of Mesophyll Conductance. Implications for the Determination of Rubisco Enzyme Kinetics and for Limitations to Photosynthesis in Vivo.” Plant Physiology 130 (4): 1992–98. https://doi.org/10.1104/pp.008250.\n\n\nBouvier, Annie, and Sylvie Huet. 1994. “Nls2 Nonlinear Regression by s PLUS Functions.” Computational Statistics & Data Analysis 18 (1): 187–90.\n\n\nBrooks, A., and G. D. Farquhar. 1985. “Effect of Temperature on the Co2/O2 Specificity of Ribulose-1,5-Bisphosphate Carboxylase/Oxygenase and the Rate of Respiration in the Light.” Planta 165 (3): 397–406. https://doi.org/10.1007/BF00392238.\n\n\nBuckley, T. N., S Martorell, A Diazespejo, M Tomàs, and H Medrano. 2014. “Is Stomatal Conductance Optimized over Both Time and Space in Plant Crowns? A Field Test in Grapevine Vitis Vinifera.” Plant Cell & Environment 37 (12): 2707.\n\n\nBussotti, Filippo, Rosanna Desotgiu, Martina Pollastrini, and Chiara Cascio. 2010. “The JIP Test: A Tool to Screen the Capacity of Plant Adaptation to Climate Change.” Scandinavian Journal of Forest Research 25 (August): 1–8.\n\n\nCaemmerer, S. Von. 2000. “Biochemical Models of Leaf Photosynthesis.” Quarterly Review of Biology, 165.\n\n\nCentritto, M, F Loreto, and K Chartzoulakis. 2003. “The Use of Low Co2 to Estimate Diffusional and Non-Diffusional Limitations of Photosynthetic Capacity of Salt-Stressed Olive Saplings.” Plant Cell and Environment 26 (4): 585–94.\n\n\nCoursolle, Carole, Guillaume O. Prud’homme, Manuel Lamothe1, and Nathalie Isabel1. 2019. “Measuring Rapid a–Ci Curves in Boreal Conifers: Black Spruce and Balsam Fir.” Frontiers in Plant Science. https://doi.org/10.3389/fpls.2019.01276.\n\n\nCowan, I. R., and G. D. Farquhar. 1977. “Stomatal Function in Relation to Leaf Metabolism and Environment.” Symposia of the Society for Experimental Biology 31 (23): 471.\n\n\nDe Kauwe, Martin G, Yan Shih Lin, Ian J Wright, Belinda E Medlyn, Kristine Y Crous, David S Ellsworth, Vincent Maire, I Colin Prentice, Owen K Atkin, and Alistair Rogers. 2016. “A Test of the One Point Method for Estimating Maximum Carboxlation Capacity from Field Measured, Light Saturated Photosynthesis.” New Phytologist 210 (3): 1130.\n\n\nDuursma, R. A., and B. E. Medlyn. 2012. “MAESPA: A Model to Study Interactions Between Water Limitation, Environmental Drivers and Vegetation Function at Tree and Stand Levels, with an Example Application to CO2 Drought Interactions.” Geoscientific Model Development Discussions 5 (4): 919–40.\n\n\nDuursma, Remko A. 2015. “Plantecophys-an r Package for Analysing and Modelling Leaf Gas Exchange Data.” Plos One 10 (11): e0143346.\n\n\nDuursma, Remko A., Paxton Payton, Michael P. Bange, Katrina J. Broughton, Renee A. Smith, Belinda E. Medlyn, and David T. Tissue. 2013a. “Near-Optimal Response of Instantaneous Transpiration Efficiency to Vapour Pressure Deficit, Temperature and [Co2] in Cotton (Gossypium Hirsutum L.).” Agricultural and Forest Meteorology 168: 168–76. https://doi.org/10.1016/j.agrformet.2012.09.005.\n\n\n———. 2013b. “Near-Optimal Response of Instantaneous Transpiration Efficiency to Vapour Pressure Deficit, Temperature and CO2 in Cotton (Gossypium Hirsutum l.).” Agricultural & Forest Meteorology 168 (1): 168–76.\n\n\nEllsworth, David S, Kristine Y Crous, Hans Lambers, and Julia Cooke. 2015. “Phosphorus Recycling in Photorespiration Maintains High Photosynthetic Capacity in Woody Species.” Plant Cell and Environment 38 (6): 1142–56.\n\n\nElzhov, Timur V., Katharine M. Mullen, Andrej Nikolai Spiess, and Ben Bolker. 2016. “Minpack.lm: R Interface to the Levenberg-Marquardt Nonlinear Least-Squares Algorithm Found in MINPACK, Plus Support for Bounds.”\n\n\nFabozzi, Frank J., Sergio M. Focardi, Svetlozar T. Rachev, and Bala G. Arshanapalli. 2014. The Basics of Financial Econometrics: Tools, Concepts, and Asset Management Applications. 1st edition. Wiley.\n\n\nFarquhar, G. D., S. Von Caemmerer, and J. A. Berry. 1980. “A Biochemical Model of Photosynthetic CO2 Assimilation in Leaves of C3 Species.” Planta 149 (1): 78–90.\n\n\nFlexas J, Azespejo A, and Berry J A. 2007. “Analysis of Leakage in IRGA’s Leaf Chambers of Open Gas Exchange Systems: Quantification and Its Effects in Photosynthesis Parameterization.” Journal of Experimental Botany 58 (6): 1533.\n\n\nGu, Lianhong, Stephen G Pallardy, Kevin Tu, Beverly E Law, and Stan D Wullschleger. 2010. “Reliable Estimation of Biochemical Parameters from c-3 Leaf Photosynthesis-Intercellular Carbon Dioxide Response Curves.” Plant Cell & Environment 33 (11): 1852–74.\n\n\nHarley, Peter C., Francesco Loreto, Giorgio Di Marco, and Thomas D. Sharkey. 1992. “Theoretical Considerations When Estimating the Mesophyll Conductance to Co2 Flux by Analysis of the Response of Photosynthesis to Co2.” Plant Physiology 98: 1429–36.\n\n\nHaworth, Matthew, Dilek Killi, Alessandro Materassi, and Antonio Raschi. 2015. “Coordination of Stomatal Physiological Behavior and Morphology with Carbon Dioxide Determines Stomatal Control.” American Journal of Botany 102 (5): 677–88.\n\n\nHaworth, Matthew, Giovanni Marino, and Mauro Centritto. 2018. “An Introductory Guide to Gas Exchange Analysis of Photosynthesis and Its Application to Plant Phenotyping and Precision Irrigation to Enhance Water Use Efficiency.” Journal of Water and Climate Change. https://doi.org/https://doi.org/10.2166/wcc.2018.152.\n\n\nHeath, James R, Edward Ayres, Malcolm Possell, Richard D Bardgett, Helaina I J Black, Helen Grant, Phil Ineson, and Gerhard Kerstiens. 2005. “Rising Atmospheric Co2 Reduces Sequestration of Root-Derived Soil Carbon.” Science 309 (5741): 1711–13.\n\n\nHikosaka, K, K Ishikawa, A Borjigidai, O Muller, and Y Onoda. 2006. “Temperature Acclimation of Photosynthesis: Mechanisms Involved in the Changes in Temperature Dependence of Photosynthetic Rate.” Journal of Experimental Botany 57 (2): 291.\n\n\nHuang, HY, XY Dou, PY Sun, B Deng, GJ Wu, and CL Peng. 2009. “Comparison of Photosynthetic Characteristics in Two Ecotypes of Jatropha Curcas in Summer.” Acta Ecologica Sinica, no. 29: 2861–67.\n\n\nJoseph R., Stinziano, Adamson Rachael K., and Hanson David T. 2019. “Using Multirate Rapid ACi Curves as a Tool to Explore New Questions in the Photosynthetic Physiology of Plants.” New Phytologist. https://doi.org/10.1111/nph.15657.\n\n\nKemp, Freda. 2003. “Modern Applied Statistics with s.” Journal of The Royal Statistical Society Series D-the Statistician 52 (4): 704–5.\n\n\nKnauer, Jürgen, Tarek S. El-Madany, Sönke Zaehle, and Mirco Migliavacca. 2018. “Bigleaf—An R Package for the Calculation of Physical and Physiological Ecosystem Properties from Eddy Covariance Data.” PLOS ONE 13 (8): e0201114. https://doi.org/10.1371/journal.pone.0201114.\n\n\nKok, Bessel. 1956. “On the Inhibition of Photosynthesis by Intense Light.” Biochimica Et Biophysica Acta 21 (2): 234–44. https://doi.org/10.1016/0006-3002(56)90003-8.\n\n\nLauteri, Marco, Matthew Haworth, Rachid Serraj, Maria Cristina Monteverdi, and Mauro Centritto. 2014. “Photosynthetic Diffusional Constraints Affect Yield in Drought Stressed Rice Cultivars During Flowering.” PLOS ONE 9 (10).\n\n\nLeuning, R. 1995a. “A Critical Appraisal of a Combined Stomatal‐photosynthesis Model for C3 Plants.” Plant Cell and Environment 18 (4): 339–55.\n\n\nLeuning, R. 1995b. “A Critical Appraisal of a Combined Stomatal-Photosynthesis Model for C3 Plants.” Plant, Cell & Environment 18 (4): 339–55. https://doi.org/https://doi.org/10.1111/j.1365-3040.1995.tb00370.x.\n\n\nLiu, Yasi, Xiangping Wang, Dayong Fan, Jiangshan Lai, Alonso Zavafer, Yasi Liu, Xiangping Wang, Dayong Fan, Jiangshan Lai, and Alonso Zavafer. 2021. “The Use of R in Photosynthesis Research.” Functional Plant Biology, October. https://doi.org/10.1071/FP21102.\n\n\nLobo, F. A. de, M. P. de Barros, H. J. Dalmagro, Â. C. Dalmolin, W. E. Pereira, É. C. de Souza, G. L. Vourlitis, and C. E. Ortíz. 2013. “Fitting Net Photosynthetic Light-Response Curves with Microsoft Excel - a Critical Look at the Models.” Photosynthetica 51 (3): 445–56. https://doi.org/10.1007/s11099-013-0045-y.\n\n\nLobo, F. De A., M. P. De Barros, H. J. Dalmagro, Â. C. Dalmolin, W. E. Pereira, É. C. de Souza, G. L. Vourlitis, and C. E. Rodríguez Ortíz. 2013. “Fitting Net Photosynthetic Light-Response Curves with Microsoft Excel a Critical Look at the Models.” Photosynthetica 51 (3): 445–56.\n\n\nLong, S. P., and C. J. Bernacchi. 2003. “Gas Exchange Measurements, What Can They Tell Us about the Underlying Limitations to Photosynthesis? Procedures and Sources of Error.” Journal of Experimental Botany 54 (392): 2393.\n\n\nMarshall, B, and P V Biscoe. 1980. “A Model for C3 Leaves Describing the Dependence of Net Photosynthesis on Irradiance.” Journal of Experimental Botany 31 (1): 29–39.\n\n\nMedlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. “Temperature Response of Parameters of a Biochemically Based Model of Photosynthesis. II. A Review of Experimental Data.” Plant, Cell & Environment 25 (9): 1167–79. https://doi.org/https://doi.org/10.1046/j.1365-3040.2002.00891.x.\n\n\nMedlyn, Belinda E., Remko A. Duursma, Derek Eamus, David S. Ellsworth, I. Colin Prentice, Craig V. M. Barton, Kristine Y. Crous, Paolo De Angelis, Michael Freeman, and Lisa Wingate. 2011. “Reconciling the Optimal and Empirical Approaches to Modelling Stomatal Conductance.” Global Change Biology 17 (6): 2134–44.\n\n\nMejdová, Markéta, Jiří Dušek, Lenka Foltýnová, Lenka Macálková, and Hana Čížková. 2021. “Photosynthetic Parameters of a Sedge-Grass Marsh as a Big-Leaf: Effect of Plant Species Composition.” Scientific Reports 11 (1): 3723. https://doi.org/10.1038/s41598-021-82382-2.\n\n\nOgren, E. 1993. “Convexity of the Photosynthetic Light-Response Curve in Relation to Intensity and Direction of Light During Growth.” Plant Physiology 101 (3): 1013–19. https://www.ncbi.nlm.nih.gov/pmc/articles/PMC158720/.\n\n\nPrado, C. H., and J. A. P. V. De Moraes. 1997. “Photosynthetic Capacity and Specific Leaf Mass in Twenty Woody Species of Cerrado Vegetation Under Field Conditions.” Photosynthetica 33 (1): 103–12.\n\n\nR Core Team. 2021. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nSaathoff, Aaron J., and Jon Welles. 2021. “Gas Exchange Measurements in the Unsteady State.” Plant, Cell & Environment 44 (11): 3509–23. https://doi.org/10.1111/pce.14178.\n\n\nSmith, Lindsay I. 2002. “A Tutorial on Principal Component Analysis.”\n\n\nStinziano, J. R., P. B. Morgan, D. J. Lynch, A. J. Saathoff, D. K. Mcdermitt, and D. T. Hanson. 2017. “The Rapid a-Ci Response: Photosynthesis in the Phenomic Era.” Plant Cell & Environment 40.\n\n\nStinziano, Joseph R, Dayle K Mcdermitt, Douglas J Lynch, Aaron J Saathoff, Patrick B Morgan, and David T Hanson. 2018. “The Rapid a/Ci Response: A Guide to Best Practices.” New Phytologist.\n\n\nStinziano, Joseph R, Cassaundra Roback, Demi Gamble, Bridget Murphy, Patrick Hudson, and Christopher D Muir. 2020. “Photosynthesis: Tools for Plant Ecophysiology & Modeling.” https://CRAN.R-project.org/package=photosynthesis.\n\n\nStirbet, Alexandrina, and Govindjee. 2011. “On the Relation Between the Kautsky Effect (Chlorophyll a Fluorescence Induction) and Photosystem II: Basics and Applications of the OJIP Fluorescence Transient.” Journal of Photochemistry and Photobiology B: Biology, Special Issue on Recent Progress in the Studies of Structure and Function of Photosystem II, 104 (1): 236–57. https://doi.org/10.1016/j.jphotobiol.2010.12.010.\n\n\nStirbet, Alexandrina, and Govindjee. 2012. “Chlorophyll a Fluorescence Induction: A Personal Perspective of the Thermal Phase, the J–I–P Rise.” Photosynthesis Research 113 (1): 15–61. https://doi.org/10.1007/s11120-012-9754-5.\n\n\nThornley, J H M. 1976. “Mathematical Models in Plant Physiology.” London: Academic Press.\n\n\nTsimilli-Michael, Merope. 2019. “Revisiting JIP-Test: An Educative Review on Concepts, Assumptions, Approximations, Definitions and Terminology.” Photosynthetica 57 (December): 90–107. https://doi.org/10.32615/ps.2019.150.\n\n\nTuzet, A, A Perrier, and R Leuning. 2003. “A Coupled Model of Stomatal Conductance, Photosynthesis and Transpiration.” Plant Cell and Environment 26 (7): 1097–1116.\n\n\nWalker, Berkley J., and Donald R. Ort. 2015. “Improved Method for Measuring the Apparent Co2 Photocompensation Point Resolves the Impact of Multiple Internal Conductances to Co2 to Net Gas Exchange.” Plant, Cell & Environment 38 (11): 2462–74. https://doi.org/https://doi.org/10.1111/pce.12562.\n\n\nWarton, David I, Remko A Duursma, Daniel S Falster, and Sara Taskinen. 2012. “Smatr 3– an r Package for Estimation and Inference about Allometric Lines.” Methods in Ecology and Evolution 3 (2): 257–59.\n\n\nWarton, David I, Ian J Wright, Daniel S Falster, and Mark Westoby. 2006. “Bivariate Line‐fitting Methods for Allometry.” Biological Reviews 81 (2): 259–91.\n\n\nWay, Danielle A., Michael J. Aspinwall, John E. Drake, Kristine Y. Crous, Courtney E. Campany, Oula Ghannoum, David T. Tissue, and Mark G. Tjoelker. 2019. “Responses of Respiration in the Light to Warming in Field-Grown Trees: A Comparison of the Thermal Sensitivity of the Kok and Laisk Methods.” New Phytologist 222 (1): 132–43. https://doi.org/https://doi.org/10.1111/nph.15566.\n\n\nWullschleger, Stan D. 1993. “Biochemical Limitations to Carbon Assimilation in C3 Plants—a Retrospective Analysis of the a-Ci Curves from 109 Species.” Journal of Experimental Botany 44 (262): 907–20.\n\n\nYin, Xinyou, P C Struik, Pascual Romero, Jeremy Harbinson, Jochem B Evers, Peter E L Van Der Putten, and J Vos. 2009. “Using Combined Measurements of Gas Exchange and Chlorophyll Fluorescence to Estimate Parameters of a Biochemical C3 Photosynthesis Model: A Critical Appraisal and a New Integrated Approach Applied to Leaves in a Wheat (Triticum Aestivum) Canopy.” Plant Cell and Environment 32 (5): 448–64.\n\n\nYin, Xinyou, Zhouping Sun, Paul C. Struik, and Junfei Gu. 2011. “Evaluating a New Method to Estimate the Rate of Leaf Respiration in the Light by Analysis of Combined Gas Exchange and Chlorophyll Fluorescence Measurements.” Journal of Experimental Botany 62 (10): 3489–99. https://doi.org/10.1093/jxb/err038.\n\n\nYin, X., and P. C. Struik. 2009. “C3 and C4 Photosynthesis Models: An Overview from the Perspective of Crop Modelling.” NJAS - Wageningen Journal of Life Sciences, Recent Advances in Crop Growth Modelling, 57 (1): 27–38. https://doi.org/10.1016/j.njas.2009.07.001.\n\n\nZhang, XS, SH Shen, and J Song. 2009. “The Vertical Distribution of Cotton Leaf Nitrogen Content and Photosynthetic Characteristics in the North China Plain.” Acta Ecologica Sinica, no. 29: 1893–98.\n\n\nZiPiao, YE. 2010. “A Review on Modeling of Responses of Photosynthesis to Light and CO2.” Chinese Journal of Plant Ecology, no. 06."
  },
  {
    "objectID": "a1-run-environment.html",
    "href": "a1-run-environment.html",
    "title": "Appendix A — 运行环境",
    "section": "",
    "text": "本文的运行环境为：\n\n\nCode\nxfun::session_info()\n\n\nR version 4.1.2 (2021-11-01)\nPlatform: x86_64-w64-mingw32/x64 (64-bit)\nRunning under: Windows 10 x64 (build 19042)\n\nLocale:\n  LC_COLLATE=Chinese (Simplified)_China.936 \n  LC_CTYPE=Chinese (Simplified)_China.936   \n  LC_MONETARY=Chinese (Simplified)_China.936\n  LC_NUMERIC=C                              \n  LC_TIME=Chinese (Simplified)_China.936    \n\nPackage version:\n  base64enc_0.1.3   compiler_4.1.2    crosstalk_1.2.0   digest_0.6.28    \n  DT_0.20           evaluate_0.14     fastmap_1.1.0     glue_1.5.0       \n  graphics_4.1.2    grDevices_4.1.2   highr_0.9         htmltools_0.5.2  \n  htmlwidgets_1.5.4 jquerylib_0.1.4   jsonlite_1.7.2    knitr_1.36       \n  later_1.3.0       lazyeval_0.2.2    magrittr_2.0.1    methods_4.1.2    \n  promises_1.2.0.1  R6_2.5.1          Rcpp_1.0.7        rlang_0.4.12     \n  rmarkdown_2.11    stats_4.1.2       stringi_1.7.5     stringr_1.4.0    \n  tinytex_0.35      tools_4.1.2       utils_4.1.2       xfun_0.28        \n  yaml_2.2.1"
  }
]