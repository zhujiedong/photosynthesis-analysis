{
  "hash": "4b18fb8697e469d8872abde5afea5ce8",
  "result": {
    "engine": "knitr",
    "markdown": "# 直角双曲线模型 {#sec-rec_mod}\n\n光响应曲线模型有很多，主要分为四大类，直角双曲线，非直角双曲线，指数以及直角双曲线修正模型，我们分别从直角双曲线模型开始介绍。\n\n@BalyEC1935 提出了直角双曲线模型，它的表达式为：\n\n$$\nP_{n}  = \\frac{\\alpha I\\ P_{nmax}}{\\alpha I + P_{nmax}}- R_{d}\n$$ {#eq-rec}\n\n*   其中，$P_{n}$ 为净光合速率；\n*   I 为光强；\n*   $\\alpha$ 为光响应曲线在光强为 0 时的斜率，即光响应曲线的初始斜率，也称之为初始量子效率；\n*   $P_{nmax}$ 为最大净光合速率；\n*  $R_{d}$：为暗呼吸速率。\n\n对 @eq-rec 求导可知其导数大于 0，也就是直角双曲线是一个没有极值的渐近线，因此，**无法**由 @eq-rec 求得饱和光强^[直角双曲线和非直角双曲线模型类似，如果测量时饱和光强之后光合速率不下降，则计算的P$_{nmax}$则远大于实测值。]。\n\n\n因此就需要使用弱光条件下 ($\\leq$ 200 $\\mu mol\\cdot m^{-2}\\cdot s^{-1}$) 的数据得到表观量子效率（apparent quantum efficiency，AQE），利用非线性最小二乘法估算 P$_{nmax}$ ，然后利用 @YEZiPiao2010 的式 @eq-aqe 求解 $I_{sat}$，\n\n$$\nP_{nmax}= AQE \\times I_{sat} - R_{d}\n$$ {#eq-aqe}\n\n但此方法测得的光饱和点远小于实测值，我们人为光强达到最大光合速率的一定比例时值计算光强，人为此时的光强为饱和光强，例如 $0.7P_{nmax}$ @ZhangXS2009、$0.9P_{nmax}$ @HuangHY2009、或其他设定的值来的来估算 $I_{sat}$。\n\n## 直角双曲线模型的实现 {#sec-rec_fit}\n\n若没有安装 `minpack.lm`, 则需要首先：\n\n```{.r}\ninstall.packages(\"minpack.lm\")\n```\n\n具体实现过程如下：\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 调用非线性拟合包minpack.lm，也可以直接使用nls\nlibrary(minpack.lm)\n# 读取数据，同fitaci数据格式\nlrc <- read.csv(\"data/lrc.csv\")\nlrc <- subset(lrc, Obs > 0)\n\n# 光响应曲线没有太多参数，\n# 直接调出相应的光强和光合速率\n# 方便后面调用\nlrc_Q <- lrc$PARi\nlrc_A <- lrc$Photo \n\n# 采用非线性拟合进行数据的拟合\nlrcnls <- nlsLM(lrc_A ~ (alpha * lrc_Q * Am) * \n                (1/(alpha * lrc_Q + Am)) - Rd,  \n              start=list(Am=(max(lrc_A)-min(lrc_A)),\n              alpha=0.05,Rd=-min(lrc_A))\n)\nfitlrc_rec <- summary(lrcnls)\n\n# 补偿点时净光合速率为0，\n# 据此利用uniroot求解方程的根\nIc <- function(Ic){(fitlrc_rec$coef[2,1] * Ic *\n    fitlrc_rec$coef[1,1]) * (1/(fitlrc_rec$coef[2,1] * \n    Ic + fitlrc_rec$coef[1,1])) - fitlrc_rec$coef[3,1] \n}\n\nuniroot(Ic, c(0,50))$root\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3.650053\n```\n\n\n:::\n\n```{.r .cell-code}\n# 根据饱和点定义，0.75最大光合速率为饱和点，\n# 也可以是其他比例\n# 据此利用uniroot求解方程的根\n\nIsat <- function(Isat){(fitlrc_rec$coef[2,1] * \n        Isat * fitlrc_rec$coef[1,1]) * \n    (1/(fitlrc_rec$coef[2,1] * Isat + \n          fitlrc_rec$coef[1,1])) - fitlrc_rec$coef[3,1] -\n    0.75 * fitlrc_rec$coef[1,1]\n}\n# 求值区间根据具体实验确定\n\nuniroot(Isat, c(0,2500))$root\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 700.0946\n```\n\n\n:::\n\n```{.r .cell-code}\n# 使用ggplot2进行作图并拟合曲线\nlibrary(ggplot2)\n\nlight <- data.frame(lrc_Q = lrc$PARi, lrc_A = lrc$Photo)\n\nrec_form <- y ~ (alpha * x * Am) * (1/(alpha * x + Am)) - Rd\n\n\nggplot(light, aes(x = lrc_Q, y = lrc_A)) + \n  geom_point(shape = 16, size = 3, color = \"green\") + \n  geom_smooth(method=\"nls\", formula = rec_form, se = FALSE,\n  method.args = list(start = c(\n  Am = (max(lrc_A) - min(lrc_A)),\n  alpha = 0.05,\n  Rd = -min(lrc_A)),\n  aes(x =lrc_Q, y = lrc_A, \n  color='blue', size = 1.2))\n  ) +\n  labs(y=expression(paste(\"photosynthetic rate  \", \n       \"(\", mu, mol%.%m^-2%.%s^-1, \")\")), \n       x=expression(paste(\"PAR \", \n       \"(\", mu, mol%.%m^-2%.%s^-1, \")\"))\n       )+\n  theme_light()\n```\n\n::: {.cell-output-display}\n![直角双曲线模型拟合](hyp_files/figure-html/fig-recr-1.png){#fig-recr width=672}\n:::\n:::\n\n\n代码目的见注释，其实现过程主要分三步：\n\n*   光响应曲线的拟合，使用到了非线性模型 nlsLM，也可以使用 nls，具体实现方法请查看参考文档。\n\n*   求饱和点和补偿点，补偿点的计算根据其定义，净光合速率为 0，求解模型在一定区间的根来计算，而饱和点则较为麻烦，若使用 @eq-aqe 计算，那么饱和点远远低于我们实际需求的，因此，我们使用了 $0.75P_{nmax}$ 来计算，求得目标区间的根。当然也可以采用其他比例来作为饱和点光合速率。\n\n\n::: {#tbl-rectable .cell tbl-cap='直角双曲线结果'}\n::: {.cell-output-display}\n\n\n|      |   Estimate| Std. Error|    t value| Pr(>&#124;t&#124;)|\n|:-----|----------:|----------:|----------:|------------------:|\n|Am    | 16.6721752|  0.1522849| 109.480151|          0.0000000|\n|alpha |  0.0783312|  0.0026774|  29.256870|          0.0000000|\n|Rd    |  0.2810926|  0.0789338|   3.561117|          0.0051716|\n\n\n:::\n:::\n\n\n最终的数据拟结果如 @fig-recr 所示，拟合的参数及结果见 @tbl-rectable。\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}