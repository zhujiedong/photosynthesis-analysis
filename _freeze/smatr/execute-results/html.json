{
  "hash": "8229becad467a1f41f9d5b8ed476ebeb",
  "result": {
    "engine": "knitr",
    "markdown": "# 标准主轴分析介绍 {#sec-sma-intr}\n\n本部分主要来自于对 @warton2012smatr 和 @warton2006smatr 内容的理解。我姑妄言之，各位也就姑妄听之，从一个取巧的角度来讲，我觉得可以从下面的角度理解标准主轴分析：\n\n1. 我们要比较差异，如果没有分组，我们要比较我们数据的斜率或截距是否等于一个值，例如，要研究异速生长关系，那么斜率肯定不能等于 1 吧，不然 y 和 x 是相等的生长速度，哪里来的异速生长？虽然我的文章我应该有 9 年不看了，我记忆里，是否为异速生长，就是拿斜率和 1 来比较，看其是否差异显著，当然，显著差异是我需要的。\n\n2. 我们要分析几个分组的数据，单纯的采用线性回归是没法比较的，他们肯定是斜率和解决不同，相同那不就是同一组数据了，这样我们就要检验通过一个主轴的斜率和截距来比较，如果存在共同的斜率，那我们只能在比较截距，如果截距存在差异，某一个要高，就接着分析这个差异可能的因素就行了，这个让我毕业的文章里是用的什么，我就记不清楚了，反正就分析了什么海拔生境之类的得出的结论，我也懒得再看了，反正我用不到了。\n\n\n根据我多年前的记忆，SMA 的用途可以用下图进行表达：\n\n![图示 SMATR 比较差异的方面](img/smatr.png){#fig-sma-app}\n\n\n- 单个分组的检验，分为斜率和截距的两种：\n  - 单个分组的斜率：为检验斜率是否等于**某个值 b**，一个简单的方法来检验就是当使用 b 作为斜率时，检验残差和轴的得分是否无关。\n  - 拟合的直线经过样品的中心点 ($\\bar x, \\bar y$)，计算的截距接近正态分布，使用 t 检验来验证真正的截距是否**等于某个特定值 a**。\n\n- 多个分组（多条直线）检验，是否存在共同斜率和共同截距\n\n  - 共同斜率：共同斜率检验是检验解决是否有偏移的前提，也就是说，根据我的理解，结果存在共同斜率，我们写文章是要找差异的，找不到差异了，我们只能退而求其次，来找其截距的不同。当然，没有共同斜率，比截距也没意义。\n  \n  - 共同截距：如果存在共同斜率，我们接着要比较其是否存在共同截距。\n  \n  - 如果上面两个都相同怎么办？那还有一个检验可以来做，那就是其会沿着主轴的方向发生偏移， @warton2006smatr 解释了这种情况，两个物种的叶片性状在主轴方向上偏移，原因是不同营养状况下他们的叶片寿命的差异。\n  \n虽然 @warton2012smatr (@fig-sma-app) 的图是彩图，但这个 @warton2006smatr 分开的图形更直观的解释了上面的几种情况：\n\n- A: 检验斜率是否等于特定值\n- B：检验斜率是否不同\n- C：检验截距是否不同\n- D：检验是否沿着主轴方向有偏移\n\n![分开展示 SMATR 的不同检验](img/smatr4.png){#fig-smatr2006}\n  \n\n## `sma` 函数的参数介绍 {#sec-sma-func}\n\n我还是使用软件包自带的数据，然后结合 @warton2012smatr 文章的内容，在尽量详细解释一下参数的意思和返回的结果，期望能使得各位不会的能够看懂。\n\n这个软件包的最重要的函数为 `sma`，\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsma(\n  formula,\n  data,\n  subset,\n  na.action,\n  log = \"\",\n  method = c(\"SMA\", \"MA\", \"OLS\"),\n  type = c(\"elevation\", \"shift\"),\n  alpha = 0.05,\n  slope.test = NA,\n  elev.test = NA,\n  multcomp = FALSE,\n  multcompmethod = c(\"default\", \"adjusted\"),\n  robust = FALSE,\n  V = matrix(0, 2, 2),\n  n_min = 3,\n  quiet = FALSE,\n  ...\n)\n```\n:::\n\n\n其参数的意义下面就分开详细解释\n\n### formula {#sec-sma-formula}\n\nR 中的 formula 对象，通过不同的写法可以得到不同的目的，具体如下面的叙述。\n\n#### 单样本检验 {#sec-single-sample}\n\n这里但从名字上即可以看出，这应该属于上图 A 的检验，这里使用的 formula 的形式为：\n\n- `sma(y~x)`，拟合 SMA 并构造真正斜率和截距的的置信区间。\n\n- `sma(y~x, slope.test = B)`，检验 SMA 的斜率是否为 B。\n\n- `sma(y~x, elev.test = A)`，检验 SMA 的截距是否为 A\n\n- `sma(y~x, robust = T)`，使用 Huber 的 M 估计进行拟合，我对这种回归不了解，不过应该属于稳健回归的范畴，也就是帮助文档里所讲的，对野点的处理比较好。\n\n- `sma(y~x-1)`， 强制从原点通过的拟合。也就是这时候没有截距的差异，或者对截距的差异不感兴趣。\n\n#### 多个样本检验 {#sec-multi-sample}\n\n也就是对多个直线进行比较，有多种分组的方式：\n\n- `sma(y~x*groups)`，也就是检验所有的分组有没有共同斜率。\n\n\n- `sma(y~x+groups, type = \"elevation\")`，检验具有共同斜率的分组有无共同截距。\n\n\n- `sma(y~x*groups, type = \"shift\")`，检验斜率是否沿着主轴方向有漂移。\n\n- `sma(y~x+groups, slope.test = \"B\")`，检验共同斜率是否为 B。\n\n- `sma(y~x+groups, elev.test = \"A\")`，建议共同截距是否为 A。\n\n- `sma(y~x*groups-1)`，同单个样本的检验，也可以检验主轴方向的漂移。\n\n#### 多重比较 {#sec-muti-comp-sma}\n\n当 `multcomp = TRUE` 时，会进行各个水平间的多重比较，包括斜率、截距和沿着主轴的漂移（取决于使用的 formula）。\n\n#### 拟合结果 {#sec-sma-fit-result-para}\n\n讲到这里应该继续讲函数的参数，不过我觉有必要在这里趁热打铁了，因为我觉得讲完了 formula 的几种形式，SMA 就讲完了，我们有必要把拟合结果顺带解释一下：\n\n- coef：拟合的参数，如果有多个样品的比较，将返回模型的参数，例如检验共同斜率时各个样品或者分组的斜率\n\n- nullcoef：零假设的参数。\n\n- alpha：见下文的参数解释\n\n- method：拟合使用的方法， ’MA’ 或 ’SMA’。\n\n- intercept：拟合的线是否强制通过原点。\n\n- call：调用 ma 或 sma 函数。\n\n- data: 见下文的参数\n\n- log： 见下文的参数\n\n- variables： SMA 的线使用的变量\n\n- origvariables：如有在拟合前有转换，转换前的变量列表\n\n- groups：分组变量的水平\n\n- gt：grouptest 缩写，表示分组测试的类型\n\n- gtr：分组测试的结果\n\n- slopetest：斜率假设检验的结果，以列表形式输出，包括 p 值、 检验统计、共同斜率 b 和置信区间 ci。\n\n- elevtest：截距假设检验的结果，返回 p 值、t检验统计、共同截距和它的置信区间。\n\n- slopetestdone：是否进行斜率检验\n\n- evevtestdone：是否进行斜率的检验\n\n- n：样品的大小\n\n- r2：决定系数\n\n- pval：统计结果的 p 值\n\n- from， to：在作图 `plot.sma` 作图时使用的拟合线的的端点\n\n- groupsummary：以数据框整理的分组参数\n\n#### 无需详细解释的参数 {#sec-simple-sma-para}\n\n`sma` 中其他无需详细解释的参数：\n\n- data： 包含 x 和 y 变量的数据框\n\n- subset：用于拟合的数据框的子集，非必须选项。\n\n- na.action: R 中对 na 值处理的方式，例如删除等。\n\n- log：对变量使用以 10 为底的对数转换。\n\n- method：如果等于 SMA 为标准主轴分析，MA 为主轴分析，或者选择 OLS，最小二乘法。\n\n- type：如果多条线进行比较，我们应该选择的选项，如 elevation 或 shift。\n\n- alpha：我们置信区间里使用的 $\\alpha$，默认 0.05。\n\n- slope.test: 假设检验使用的值，也就是与某一个值差异是否显著时使用。\n\n- elev.test：与 slope.test 类似，只不过是检验截距。\n\n- robust：如果为 TRUE，使用文件回归分析，目前仅针对单样本检验。\n\n- V：测量误差的变异矩阵，默认无。\n\n- n_min：一个分组最小的样品数量\n\n- quiet：如果为 TRUE，不提示任何信息\n\n- multcomp：如果为 TRUE，则进行多重比较\n\n- multcompmethod： 多重比较 p 值的方法。\n\n\n## 自带数据的例子 {#sec-sma-example}\n\n安装从 CRAN 上进行即可：\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages('smatr')\n```\n:::\n\n\n我们来使用自带的数据进行分析示例，先加载需要的软件包和数据：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(smatr)\ndata(leaflife)\n```\n:::\n\n\n对于我们生态学人来说，数据浅显易懂，地点，降雨量，土壤 P 含量，叶片寿命、比叶面积几个数据：\n\n\n::: {.cell tbl-cap='{}'}\n\n```{.r .cell-code}\nkable(head(leaflife), caption = \"示例数据{#tbl-sma-data}\")\n```\n\n::: {.cell-output-display}\n\n\nTable: 示例数据{#tbl-sma-data}\n\n|site |rain |soilp |    longev|       lma|\n|:----|:----|:-----|---------:|---------:|\n|1    |high |high  | 1.1145511| 125.48736|\n|1    |high |high  | 0.5161786|  82.28108|\n|1    |high |high  | 0.9718517|  71.02316|\n|1    |high |high  | 0.6722023|  94.66730|\n|1    |high |high  | 1.0947123| 119.70161|\n|1    |high |high  | 2.0606299| 205.82589|\n\n\n:::\n:::\n\n\n\n### 单个样品的分析 {#sec-sma-example-single}\n\n我感觉单个样品的分析用的比较少，但不排除有些情况适用，我们看一下下面的结果\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 单个样品分析 --------------------------------------------------------\n# 仅使用降雨和营养都是低的数据\nleaf_low <- subset(leaflife, soilp == 'low' & rain == 'low')\n# 仅拟合 SMA 的斜率和截距，实际很少单独用\nsma(longev ~ lma, log='xy', data=leaflife)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: sma(formula = longev ~ lma, data = leaflife, log = \"xy\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nCoefficients:\n            elevation    slope\nestimate    -2.698800 1.315031\nlower limit -3.224305 1.096261\nupper limit -2.173295 1.577457\n\nH0 : variables uncorrelated\nR-squared : 0.4544809 \nP-value : 4.0171e-10 \n```\n\n\n:::\n\n```{.r .cell-code}\n# 检验斜率是否与 1 差异显著\nma_test <- ma(longev ~ lma, log='xy', slope.test=1, data=leaflife)\nsummary(ma_test)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: sma(formula = ..1, data = ..4, log = \"xy\", method = \"MA\", slope.test = 1) \n\nFit using Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nCoefficients:\n            elevation    slope\nestimate    -3.085214 1.492616\nlower limit -3.968020 1.146777\nupper limit -2.202407 2.001084\n\nH0 : variables uncorrelated\nR-squared : 0.4544809 \nP-value : 4.0171e-10 \n\n------------------------------------------------------------\nH0 : slope not different from 1 \nTest statistic : r= 0.3515 with 65 degrees of freedom under H0\nP-value : 0.0035393 \n```\n\n\n:::\n:::\n\n上面的结果 H0 的 p 值仅为 0.003，也就是发生的概率太小，我们拒绝 H0，有显著差异，实际上斜率为 1.49，也很明显。\n\n\n### 多个样品的分析 {#sec-multi-sma-data}\n\n我们先对降雨量低的数据的性状进行分析：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlow_rain <- subset(leaflife, rain == 'low') \n\n# SMA 单独拟合不同降雨区的数据，检验其有无共同斜率\ndiff_rain <- sma(longev~lma*soilp, log=\"xy\", data = low_rain)\nsummary(diff_rain)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: sma(formula = longev ~ lma * soilp, data = low_rain, log = \"xy\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 3.943 with 1 degrees of freedom\nP-value : 0.047076 \n------------------------------------------------------------\n\nCoefficients by group in variable \"soilp\"\n\nGroup: high \n            elevation     slope\nestimate    -2.523634 1.1825381\nlower limit -3.135266 0.9398479\nupper limit -1.912003 1.4878965\n\nH0 : variables uncorrelated.\nR-squared : 0.7392636 \nP-value : 1.462e-07 \n\nGroup: low \n            elevation    slope\nestimate    -3.837710 1.786551\nlower limit -5.291926 1.257257\nupper limit -2.383495 2.538672\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n```\n\n\n:::\n:::\n\n\n我们看到 H0 : slopes are equal 的概率是 0.047，也就是无共同斜率，图形也佐证了该点：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(diff_rain)\n```\n\n::: {.cell-output-display}\n![多个分组无共同斜率](smatr_files/figure-html/fig-multi-sma-plot-1.png){#fig-multi-sma-plot width=672}\n:::\n:::\n\n\n我们就无需在检验截距和延主轴的漂移了，差异足够明显。\n\n\n### 多个样品无共同斜率 {#sec-multi-no-coslope}\n\n下面的数据时无共同斜率的情况，我就不一一解释了：\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 检查共同斜率 --------------------------------------\n# 查看低土壤营养的数据\nlow_soilp <- subset(leaflife, soilp == 'low')\n\n# 以降雨的高低为分组，分别拟合，检验是否有共同斜率\ncom_test <- sma(longev~lma*rain, log=\"xy\", data=low_soilp )\nsummary(com_test)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: sma(formula = longev ~ lma * rain, data = low_soilp, log = \"xy\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation     slope\nestimate    -2.321737 1.1768878\nlower limit -3.475559 0.7631512\nupper limit -1.167915 1.8149286\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nGroup: low \n            elevation    slope\nestimate    -3.837710 1.786551\nlower limit -5.291926 1.257257\nupper limit -2.383495 2.538672\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(com_test)\n```\n\n::: {.cell-output-display}\n![具有共同斜率的图形](smatr_files/figure-html/fig-with-com-slop-1.png){#fig-with-com-slop width=672}\n:::\n:::\n\n\n结论: H0 : slopes are equal. P 为 0.13，也就是接受 h0\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 检查斜率与 1 是否差异显著 -------------------------------------------------------------\nlow_soilp_b <- sma(longev~lma*rain, log=\"xy\", slope.test=1, data=low_soilp)\nsummary(low_soilp_b)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: sma(formula = longev ~ lma * rain, data = low_soilp, log = \"xy\", \n    slope.test = 1) \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nH0 : common slope not different from 1 \nLikelihood ratio statistic = 8.677 with 2 degrees of freedom under H0\nP-value : 0.013057 \n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation     slope\nestimate    -2.321737 1.1768878\nlower limit -3.475559 0.7631512\nupper limit -1.167915 1.8149286\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nH0 : slope not different from 1 \nTest statistic: r= 0.1975 with 15 degrees of freedom under H0\nP-value : 0.44733 \n\nGroup: low \n            elevation    slope\nestimate    -3.837710 1.786551\nlower limit -5.291926 1.257257\nupper limit -2.383495 2.538672\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n\nH0 : slope not different from 1 \nTest statistic: r= 0.8126 with 8 degrees of freedom under H0\nP-value : 0.0042704 \n```\n\n\n:::\n\n```{.r .cell-code}\n# 结论： H0 : slope not different from 1 ，p 为 0.004，拒绝 h0\n\n\n# 检查共同截距 -------------------------------------------------------------\nlow_soilp_elev <- sma(longev~lma+rain, log=\"xy\", type = \"elevation\", data=low_soilp)\nsummary(low_soilp_elev)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: sma(formula = longev ~ lma + rain, data = low_soilp, log = \"xy\", \n    type = \"elevation\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nH0 : no difference in elevation.\nWald statistic: 6.566 with 1 degrees of freedom\nP-value : 0.010393 \n------------------------------------------------------------\n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation    slope\nestimate    -3.140896 1.551400\nlower limit -4.079825 1.109374\nupper limit -2.201966 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nGroup: low \n            elevation    slope\nestimate    -3.304865 1.551400\nlower limit -4.353328 1.109374\nupper limit -2.256403 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(low_soilp_elev)\n```\n\n::: {.cell-output-display}\n![共同截距差异显著的图形](smatr_files/figure-html/fig-no-com-inter-1.png){#fig-no-com-inter width=672}\n:::\n:::\n\n\n结论： H0 : no difference in elevation. p 为 0.01 共同截距有显著差异\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 检查延主轴有无漂移 -------------------------------------------------------------\nlow_soilp_shift <-  sma(longev~lma+rain, log=\"xy\", type=\"shift\", data=low_soilp)\nsummary(low_soilp_shift)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: sma(formula = longev ~ lma + rain, data = low_soilp, log = \"xy\", \n    type = \"shift\") \n\nFit using Standardized Major Axis \n\nThese variables were log-transformed before fitting: xy \n\nConfidence intervals (CI) are at 95%\n\n------------------------------------------------------------\nResults of comparing lines among groups.\n\nH0 : slopes are equal.\nLikelihood ratio statistic : 2.367 with 1 degrees of freedom\nP-value : 0.12395 \n------------------------------------------------------------\n\nH0 : no shift along common axis.\nWald statistic: 0.2091 with 1 degrees of freedom\nP-value : 0.64745 \n------------------------------------------------------------\n\nCoefficients by group in variable \"rain\"\n\nGroup: high \n            elevation    slope\nestimate    -3.140896 1.551400\nlower limit -3.475559 1.109374\nupper limit -1.167915 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.3407371 \nP-value : 0.013891 \n\nGroup: low \n            elevation    slope\nestimate    -3.304865 1.551400\nlower limit -5.291926 1.109374\nupper limit -2.383495 2.011726\n\nH0 : variables uncorrelated.\nR-squared : 0.80651 \nP-value : 0.00041709 \n```\n\n\n:::\n:::\n\n\n结论： H0 : no shift along common axis. p 为 0.64，接受 h0，无延主轴方向的漂移。",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}